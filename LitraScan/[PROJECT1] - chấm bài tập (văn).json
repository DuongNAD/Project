{
  "name": "[PROJECT1] - ch·∫•m b√†i t·∫≠p (vƒÉn)",
  "nodes": [
    {
      "parameters": {
        "pollTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        },
        "simple": false,
        "filters": {
          "labelIds": [
            "Label_9060861085489593330"
          ],
          "readStatus": "unread"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.gmailTrigger",
      "typeVersion": 1.3,
      "position": [
        16,
        208
      ],
      "id": "7171cf98-cb09-43c4-8e82-bf8937afccea",
      "name": "Gmail Trigger",
      "credentials": {
        "gmailOAuth2": {
          "id": "qNXnwDJCjJF60qrq",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·ªêI C·∫¢NH: B·∫°n l√† m·ªôt tr·ª£ l√Ω ph√¢n t√≠ch ng√¥n ng·ªØ chuy√™n nghi·ªáp, ƒë∆∞·ª£c ƒë√†o t·∫°o ƒë·ªÉ ho·∫°t ƒë·ªông nh∆∞ m·ªôt gi√°o vi√™n Ng·ªØ vƒÉn c·ª±c k·ª≥ c·∫©n th·∫≠n v√† chi ti·∫øt. Nhi·ªám v·ª• c·ªßa b·∫°n l√† ph√¢n t√≠ch m·ªôt b√†i vƒÉn ƒë∆∞·ª£c cung c·∫•p, t√¨m ra t·∫•t c·∫£ c√°c l·ªói v√† nh·∫≠n x√©t v·ªÅ b·ªë c·ª•c, sau ƒë√≥ tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ vƒÉn b·∫£n n√†o kh√°c k√®m theo.\n\nƒê·∫¶U V√ÄO:\n\nbaiVan: M·ªôt chu·ªói vƒÉn b·∫£n (string) ch·ª©a to√†n b·ªô b√†i vƒÉn c·ªßa h·ªçc sinh, v√≠ d·ª•: {{ $node[\"HTTP Request1\"].json.extractedText }}.\n\nQUY TR√åNH TH·ª∞C HI·ªÜN: B·∫°n B·∫ÆT BU·ªòC ph·∫£i th·ª±c hi·ªán theo ƒë√∫ng c√°c b∆∞·ªõc sau:\n\nB∆∞·ªõc 1: T√°i c·∫•u tr√∫c vƒÉn b·∫£n: X·ª≠ l√Ω chu·ªói baiVan ƒë·ªÉ t·∫°o m·ªôt phi√™n b·∫£n s·∫°ch s·∫Ω, d·ªÖ ph√¢n t√≠ch. √Åp d·ª•ng quy t·∫Øc sau:\n\nN·∫øu m·ªôt d√≤ng m·ªõi b·∫Øt ƒë·∫ßu b·∫±ng m·ªôt ch·ªØ c√°i vi·∫øt th∆∞·ªùng, h√£y t·ª± ƒë·ªông n·ªëi n√≥ v√†o d√≤ng tr∆∞·ªõc ƒë√≥.\n\nCh·ªâ coi l√† b·∫Øt ƒë·∫ßu m·ªôt ƒëo·∫°n vƒÉn m·ªõi khi d√≤ng ƒë√≥ b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ vi·∫øt hoa ho·∫∑c d·∫•u g·∫°ch ƒë·∫ßu d√≤ng (-).\n\nB∆∞·ªõc 2: Ph√¢n t√≠ch to√†n di·ªán: D·ª±a tr√™n vƒÉn b·∫£n s·∫°ch s·∫Ω t·ª´ B∆∞·ªõc 1, h√£y t√¨m v√† li·ªát k√™ T·∫§T C·∫¢ c√°c l·ªói v√† nh·∫≠n x√©t thu·ªôc 5 lo·∫°i sau:\n\nL·ªói Ch√≠nh T·∫£: C√°c l·ªói v·ªÅ d·∫•u c√¢u, vi·∫øt hoa kh√¥ng ƒë√∫ng quy t·∫Øc, sai ph·ª• √¢m (l/n, ch/tr, x/s, r/d/gi), sai v·∫ßn, sai d·∫•u thanh (h·ªèi/ng√£).\n\nL·ªói D√πng T·ª´: L·∫∑p t·ª´ kh√¥ng c·∫ßn thi·∫øt, d√πng t·ª´ sai ng·ªØ c·∫£nh, t·ª´ ng·ªØ ngh√®o n√†n, di·ªÖn ƒë·∫°t t·ªëi nghƒ©a.\n\nL·ªói Ng·ªØ Ph√°p: C√¢u c·ª•t, c√¢u thi·∫øu th√†nh ph·∫ßn ch√≠nh (ch·ªß ng·ªØ/v·ªã ng·ªØ), c·∫•u tr√∫c c√¢u l·ªßng c·ªßng, kh√¥ng m·∫°ch l·∫°c.\n\nL·ªói Tr√¨nh B√†y: C√°c l·ªói xu·ªëng d√≤ng kh√¥ng h·ª£p l√Ω (v√≠ d·ª•: xu·ªëng d√≤ng gi·ªØa c√¢u).\n\nPh√¢n t√≠ch B·ªë c·ª•c: Ph√¢n t√≠ch xem b√†i vƒÉn ƒë√£ c√≥ c·∫•u tr√∫c 3 ph·∫ßn (M·ªü b√†i, Th√¢n b√†i, K·∫øt b√†i) r√µ r√†ng ch∆∞a. ƒê√°nh gi√° s∆° b·ªô v·ªÅ m·ª©c ƒë·ªô ho√†n thi·ªán v√† s·ª± li√™n k·∫øt c·ªßa m·ªói ph·∫ßn.\n\nƒê·ªäNH D·∫†NG K·∫æT QU·∫¢ ƒê·∫¶U RA:\n\nY√™u c·∫ßu: K·∫øt qu·∫£ tr·∫£ v·ªÅ B·∫ÆT BU·ªòC ph·∫£i l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t.\n\nR√†ng bu·ªôc: TUY·ªÜT ƒê·ªêI KH√îNG th√™m b·∫•t k·ª≥ vƒÉn b·∫£n, l·ªùi gi·∫£i th√≠ch, hay k√Ω t·ª± n√†o kh√°c b√™n ngo√†i c·∫∑p d·∫•u {} c·ªßa ƒë·ªëi t∆∞·ª£ng JSON.\n\nC·∫•u tr√∫c JSON:\n\nJSON\n\n{\n  \"loiChinhTa\": [\n    {\n      \"tuSai\": \"t·ª´ vi·∫øt sai\",\n      \"tuDung\": \"g·ª£i √Ω s·ª≠a ƒë√∫ng\"\n    }\n  ],\n  \"loiDungTu\": [\n    {\n      \"tuBiLoi\": \"t·ª´ ho·∫∑c c·ª•m t·ª´ b·ªã d√πng sai\",\n      \"phanTich\": \"ph√¢n t√≠ch t·∫°i sao sai v√† g·ª£i √Ω thay th·∫ø\"\n    }\n  ],\n  \"loiNguPhap\": [\n    {\n      \"cauBiLoi\": \"tr√≠ch d·∫´n nguy√™n vƒÉn c√¢u b·ªã l·ªói ng·ªØ ph√°p\",\n      \"phanTich\": \"ph√¢n t√≠ch l·ªói v√† g·ª£i √Ω c√°ch vi·∫øt l·∫°i c√¢u cho ƒë√∫ng\"\n    }\n  ],\n  \"loiTrinhBay\": [\n    {\n      \"viTriLoi\": \"m√¥ t·∫£ v·ªã tr√≠ ho·∫∑c tr√≠ch d·∫´n ƒëo·∫°n b·ªã xu·ªëng d√≤ng sai\",\n      \"phanTich\": \"ph√¢n t√≠ch l·ªói, v√≠ d·ª•: 'xu·ªëng d√≤ng gi·ªØa c√¢u kh√¥ng h·ª£p l√Ω'\"\n    }\n  ],\n  \"nhanXetBoCuc\": {\n    \"moBai\": \"Ph√¢n t√≠ch ph·∫ßn m·ªü b√†i, ƒë√°nh gi√° ƒë√£ ƒë·ªß √Ω v√† h·∫•p d·∫´n ch∆∞a.\",\n    \"thanBai\": \"Ph√¢n t√≠ch ph·∫ßn th√¢n b√†i, ƒë√°nh gi√° c√°ch s·∫Øp x·∫øp √Ω, s·ª± li√™n k·∫øt v√† ƒë·ªô chi ti·∫øt.\",\n    \"ketBai\": \"Ph√¢n t√≠ch ph·∫ßn k·∫øt b√†i, ƒë√°nh gi√° ƒë√£ t√≥m l∆∞·ª£c ƒë∆∞·ª£c v·∫•n ƒë·ªÅ v√† n√™u c·∫£m nghƒ© ch∆∞a.\",\n    \"nhanXetChung\": \"Nh·∫≠n x√©t t·ªïng quan v·ªÅ b·ªë c·ª•c, m·ª©c ƒë·ªô r√µ r√†ng v√† c√¢n ƒë·ªëi gi·ªØa c√°c ph·∫ßn.\"\n  }\n}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1488,
        224
      ],
      "id": "f443f83e-eb13-4257-8e2b-cda4ace4585f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1488,
        352
      ],
      "id": "0784adf4-be56-42b6-8ba2-fa44d5b4042f",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://script.google.com/macros/s/AKfycbwi1WyEiIqX8DfkVJtsbOsoM8tlqEfTsn0dB5yPxvqE_-UiZ1jFGcPqpEYujs1kJEaH/exec",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"messageId\": \"{{ $('Edit Fields').item.json.messageId }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1280,
        224
      ],
      "id": "6477d01d-43b1-4d18-96fb-e77b3d817c5b",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "jsCode": "// L·∫∑p qua t·∫•t c·∫£ c√°c item ƒë·∫ßu v√†o (th∆∞·ªùng ch·ªâ c√≥ 1)\nfor (const item of $input.all()) {\n  \n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ ƒë·∫ßu ra c·ªßa node AI Agent\n  const rawOutputString = item.json.output;\n\n  // 2. \"L√†m s·∫°ch\" chu·ªói: G·ª° b·ªè c√°c k√Ω t·ª± markdown\n  // S·ª≠ d·ª•ng bi·ªÉu th·ª©c ch√≠nh quy (regex) ƒë·ªÉ l·∫•y n·ªôi dung b√™n trong ```json ... ```\n  const match = rawOutputString.match(/```json\\n([\\s\\S]*?)\\n```/);\n  \n  let cleanString;\n  if (match && match[1]) {\n    cleanString = match[1];\n  } else {\n    // N·∫øu kh√¥ng c√≥ markdown, gi·∫£ s·ª≠ n√≥ l√† JSON (nh∆∞ng c√≥ th·ªÉ b·∫©n)\n    cleanString = rawOutputString.trim();\n  }\n\n  // 3. Chuy·ªÉn ƒë·ªïi (parse) chu·ªói ƒë√£ l√†m s·∫°ch th√†nh ƒë·ªëi t∆∞·ª£ng JSON\n  try {\n    const parsedData = JSON.parse(cleanString);\n    \n    // 4. G√°n c√°c lo·∫°i l·ªói ra th√†nh c√°c tr∆∞·ªùng JSON c·∫•p cao\n    // ƒêi·ªÅu n√†y gi√∫p Anh d·ªÖ d√†ng g·ªçi ch√∫ng ·ªü node sau\n    item.json.loiChinhTa = parsedData.loiChinhTa;\n    item.json.loiDungTu = parsedData.loiDungTu;\n    item.json.loiNguPhap = parsedData.loiNguPhap;\n    item.json.loiTrinhBay = parsedData.loiTrinhBay;\n    // B·ªî SUNG D√íNG N√ÄY\n    item.json.nhanXetBoCuc = parsedData.nhanXetBoCuc;\n\n  } catch (error) {\n    // N·∫øu c√≥ l·ªói, ghi l·∫°i ƒë·ªÉ g·ª° l·ªói\n    item.json.parsingError = error.message;\n    item.json.rawStringForDebug = cleanString;\n  }\n}\n\n// Tr·∫£ v·ªÅ d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c b·ªï sung\nreturn $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1824,
        224
      ],
      "id": "fa796211-542f-4cf5-9dc8-473ca4881da7",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Edit Fields').first().json.studentEmail }}",
        "subject": "=[Th√¥ng b√°o] Email c·ªßa b·∫°n ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω th√¥ng tin h·ªçc sinh",
        "message": "=<p>Ch√†o b·∫°n,</p>\n<p>Email <strong>{{ $('Gmail Trigger').item.json.from.value[0].address }}</strong> m√† b·∫°n d√πng ƒë·ªÉ g·ª≠i b√†i ch∆∞a ƒë∆∞·ª£c t√¨m th·∫•y trong h·ªá th·ªëng c·ªßa ch√∫ng t√¥i.</p>\n<p>Vui l√≤ng ki·ªÉm tra l·∫°i v√† s·ª≠ d·ª•ng ƒë√∫ng email ƒë√£ ƒëƒÉng k√Ω v·ªõi l·ªõp h·ªçc ƒë·ªÉ n·ªôp b√†i.</p>\n<p>N·∫øu b·∫°n cho r·∫±ng ƒë√¢y l√† m·ªôt s·ª± nh·∫ßm l·∫´n, vui l√≤ng li√™n h·ªá v·ªõi gi√°o vi√™n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£.</p>\n<p>Tr√¢n tr·ªçng.</p>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        1280,
        80
      ],
      "id": "d3130fde-b58e-4166-aca7-0d2343c07fa0",
      "name": "Send a message",
      "webhookId": "1de50e9e-ee22-4101-a33f-e4dba28c0545",
      "credentials": {
        "gmailOAuth2": {
          "id": "qNXnwDJCjJF60qrq",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- B∆Ø·ªöC 1: L·∫§Y D·ªÆ LI·ªÜU T·ª™ NODE TR∆Ø·ªöC ---\n\nconst duLieuLoi = $('Code in JavaScript').first().json;\n\n// --- B∆Ø·ªöC 2: X√ÇY D·ª∞NG N·ªòI DUNG EMAIL D·∫†NG HTML ---\n\nlet message = `\n  <style>\n    body { font-family: Arial, sans-serif; line-height: 1.6; }\n    h3 { color: #2c3e50; }\n    h4 { color: #34495e; border-bottom: 1px solid #ccc; padding-bottom: 5px; margin-top: 20px;}\n    ul { list-style-type: none; padding-left: 0; }\n    li { background-color: #f8f9f9; border: 1px solid #e1e4e8; border-radius: 5px; padding: 10px; margin-bottom: 10px; }\n    b { color: #c0392b; }\n    i { color: #7f8c8d; }\n    .nhanxet-box { background-color: #eaf2f8; padding: 15px; border-left: 4px solid #3498db; margin-bottom: 20px; border-radius: 5px;}\n    .nhanxet-box p { margin: 5px 0; }\n  </style>\n  <h3>üìù B√°o c√°o Ph√¢n t√≠ch B√†i vƒÉn c·ªßa H·ªçc sinh</h3>\n`;\n\n// --- PH·∫¶N M·ªöI: Nh·∫≠n x√©t chi ti·∫øt v·ªÅ B·ªë c·ª•c ---\nif (duLieuLoi.nhanXetBoCuc) {\n    message += `<div class=\"nhanxet-box\">`;\n    message += `<h4>Nh·∫≠n x√©t v·ªÅ B·ªë c·ª•c</h4>`;\n    if (duLieuLoi.nhanXetBoCuc.moBai) {\n        message += `<p><b>M·ªü b√†i:</b> ${duLieuLoi.nhanXetBoCuc.moBai}</p>`;\n    }\n    if (duLieuLoi.nhanXetBoCuc.thanBai) {\n        message += `<p><b>Th√¢n b√†i:</b> ${duLieuLoi.nhanXetBoCuc.thanBai}</p>`;\n    }\n    if (duLieuLoi.nhanXetBoCuc.ketBai) {\n        message += `<p><b>K·∫øt b√†i:</b> ${duLieuLoi.nhanXetBoCuc.ketBai}</p>`;\n    }\n    if (duLieuLoi.nhanXetBoCuc.nhanXetChung) {\n        message += `<p><b>Nh·∫≠n x√©t chung:</b> ${duLieuLoi.nhanXetBoCuc.nhanXetChung}</p>`;\n    }\n    message += `</div>`;\n}\n\n\n// ƒê·ªãnh d·∫°ng ph·∫ßn l·ªói ch√≠nh t·∫£\nif (duLieuLoi.loiChinhTa && duLieuLoi.loiChinhTa.length > 0) {\n    message += \"<h4>1. L·ªói Ch√≠nh t·∫£</h4><ul>\";\n    for (const loi of duLieuLoi.loiChinhTa) {\n        message += `<li>T·ª´ sai: \"<b>${loi.tuSai}</b>\" ‚Üí S·ª≠a l·∫°i: \"<b>${loi.tuDung}</b>\"</li>`;\n    }\n    message += \"</ul>\";\n}\n\n// ƒê·ªãnh d·∫°ng ph·∫ßn l·ªói d√πng t·ª´\nif (duLieuLoi.loiDungTu && duLieuLoi.loiDungTu.length > 0) {\n    message += \"<h4>2. L·ªói D√πng t·ª´</h4><ul>\";\n    for (const loi of duLieuLoi.loiDungTu) {\n        message += `<li>L·ªói: \"<b>${loi.tuBiLoi}</b>\"<br><i>&nbsp;&nbsp;‚Ü≥ Ph√¢n t√≠ch: ${loi.phanTich}</i></li>`;\n    }\n    message += \"</ul>\";\n}\n\n// --- PH·∫¶N M·ªöI: L·ªói Ng·ªØ ph√°p & Tr√¨nh b√†y ---\n// Gi·∫£ s·ª≠ l·ªói ng·ªØ ph√°p v√† tr√¨nh b√†y l√† m·ªôt m·∫£ng c√°c object c√≥ tr∆∞·ªùng 'phanTich'\nif (duLieuLoi.loiNguPhap && duLieuLoi.loiNguPhap.length > 0) {\n    message += \"<h4>3. L·ªói Ng·ªØ ph√°p</h4><ul>\";\n    for (const loi of duLieuLoi.loiNguPhap) {\n        // Thay 'loi.phanTich' b·∫±ng tr∆∞·ªùng d·ªØ li·ªáu th·ª±c t·∫ø n·∫øu kh√°c\n        message += `<li>${loi.phanTich}</li>`;\n    }\n    message += \"</ul>\";\n}\n\nif (duLieuLoi.loiTrinhBay && duLieuLoi.loiTrinhBay.length > 0) {\n    message += \"<h4>4. L·ªói Tr√¨nh b√†y</h4><ul>\";\n    for (const loi of duLieuLoi.loiTrinhBay) {\n        // Thay 'loi.phanTich' b·∫±ng tr∆∞·ªùng d·ªØ li·ªáu th·ª±c t·∫ø n·∫øu kh√°c\n        message += `<li>${loi.phanTich}</li>`;\n    }\n    message += \"</ul>\";\n}\n\n\n// --- B∆Ø·ªöC 3: TR·∫¢ V·ªÄ K·∫æT QU·∫¢ CU·ªêI C√ôNG ---\n\nreturn [{\n    json: {\n        messageContent: message\n    }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3424,
        224
      ],
      "id": "54b2ef7a-d787-4fc7-80a2-8304a9f610a7",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "operation": "get",
        "messageId": "={{ $('Edit Fields').first().json.messageId }}",
        "simple": false,
        "options": {
          "downloadAttachments": true
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3632,
        224
      ],
      "id": "75aa1663-8eab-40a3-aae6-feb573130321",
      "name": "Get a message",
      "webhookId": "5874ad89-87ca-491e-a365-d4aee2207122",
      "credentials": {
        "gmailOAuth2": {
          "id": "qNXnwDJCjJF60qrq",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a0311829-89be-4269-b79f-79e74744d051",
              "name": "messageId",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "fb053986-d87a-4b69-82f8-e9193f6026d8",
              "name": "studentEmail",
              "value": "={{ $json.from.value[0].address }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        224,
        208
      ],
      "id": "b7c7f3fc-b234-47a5-af12-d3dfb76c8abb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "C√¥ gi√°o Mini",
        "filter": {
          "folderId": {
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        432,
        208
      ],
      "id": "4fda4263-ed2e-4e3f-b42c-7f040af9f9d8",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Th√¥ng tin h·ªçc sinh",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        624,
        208
      ],
      "id": "12b8150d-c57a-43d0-89bd-848b67466ad6",
      "name": "Search files and folders1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ac56af62-cba8-4694-bf93-ce6c2317e562",
              "leftValue": "={{ $json['H·ªç v√† t√™n h·ªçc sinh'] }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1040,
        208
      ],
      "id": "0c98b4d8-5bb6-4866-9e8e-f31c213cf8bb",
      "name": "If"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Code in JavaScript3').first().json.Gmail }}",
        "subject": "=[T·ª± ƒë·ªông] ƒê√£ ch·∫•m xong b√†i cho h·ªçc sinh: {{ $('GetStudentInfo').first().json['H·ªç v√† t√™n h·ªçc sinh'] }} - {{ $('Edit Fields').first().json.messageId }}",
        "message": "={{ $('Code in JavaScript1').item.json.messageContent }}",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {
                "property": "attachment_0"
              }
            ]
          }
        }
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        3856,
        224
      ],
      "id": "f621b2fa-88e8-4b4c-9097-3ede4daf658d",
      "name": "Send a message1",
      "webhookId": "1de50e9e-ee22-4101-a33f-e4dba28c0545",
      "credentials": {
        "gmailOAuth2": {
          "id": "qNXnwDJCjJF60qrq",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "C√¥ gi√°o Mini - Gi√°o vi√™n",
        "filter": {
          "folderId": {
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2032,
        224
      ],
      "id": "82ebfa06-75f5-49a9-95a7-eae700c0144e",
      "name": "Search files and folders2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/12Ne-u1vzB_YdbyPt7IFc0o_eYvqMQukSrZC6lEbdOZw/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        2448,
        224
      ],
      "id": "25294452-9656-436c-a114-c5089fe34829",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2cXkUqIFSIHamxSV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Th√¥ng tin gi√°o vi√™n",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2240,
        224
      ],
      "id": "7b3c674d-27d5-4022-ab7d-55152c8f42b5",
      "name": "Search files and folders3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "C√¥ gi√°o Mini - Gi√°o vi√™n",
        "filter": {
          "folderId": {
            "mode": "list",
            "value": "root",
            "cachedResultName": "/ (Root folder)"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        240,
        -192
      ],
      "id": "10e653af-3e61-4ad3-84e1-da637e9ed611",
      "name": "Search files and folders4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Th√¥ng tin gi√°o vi√™n",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        448,
        -192
      ],
      "id": "e3335a18-2898-4cc2-bc2d-d4ac554a266c",
      "name": "Search files and folders5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "zLDXn0hJUcHCmClV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- B∆Ø·ªöC 1: L·∫§Y D·ªÆ LI·ªÜU T·ª™ C√ÅC NODE TR∆Ø·ªöC ---\n\n// L·∫•y th√¥ng tin c·ªßa h·ªçc sinh t·ª´ node \"GetStudentInfo\".\n// ‚ö†Ô∏è ƒê·∫£m b·∫£o t√™n node n√†y kh·ªõp ch√≠nh x√°c v·ªõi t√™n Anh ƒë√£ ƒë·∫∑t.\nconst studentItem = $('GetStudentInfo').item;\n\n// L·∫•y to√†n b·ªô danh s√°ch gi√°o vi√™n t·ª´ ƒë·∫ßu v√†o tr·ª±c ti·∫øp c·ªßa node Code n√†y.\nconst allTeachers = $input.all();\n\n// --- B∆Ø·ªöC 2: TR√çCH XU·∫§T TH√îNG TIN C·∫¶N THI·∫æT ---\n\n// L·∫•y t√™n l·ªõp c·ªßa h·ªçc sinh, v√≠ d·ª•: \"5A\".\nconst studentClass = studentItem.json['L·ªõp'];\n\n// --- B∆Ø·ªöC 3: KI·ªÇM TRA V√Ä L·ªåC D·ªÆ LI·ªÜU ---\n\n// Ki·ªÉm tra xem c√≥ l·∫•y ƒë∆∞·ª£c t√™n l·ªõp c·ªßa h·ªçc sinh kh√¥ng.\nif (!studentClass) {\n  console.log(\"L·ªói: Kh√¥ng t√¨m th·∫•y th√¥ng tin 'L·ªõp' c·ªßa h·ªçc sinh.\");\n  return []; // D·ª´ng th·ª±c thi n·∫øu kh√¥ng c√≥ l·ªõp ƒë·ªÉ t√¨m ki·∫øm.\n}\n\n// Chu·∫©n b·ªã m·ªôt m·∫£ng r·ªóng ƒë·ªÉ ch·ª©a k·∫øt qu·∫£.\nconst foundTeachers = [];\n\n// Duy·ªát qua t·ª´ng gi√°o vi√™n trong danh s√°ch.\nfor (const teacherItem of allTeachers) {\n  \n  // L·∫•y chu·ªói c√°c l·ªõp m√† gi√°o vi√™n d·∫°y, v√≠ d·ª•: \"5A, 5B\".\n  const teacherClasses = teacherItem.json['L·ªõp'];\n\n  // Ki·ªÉm tra xem gi√°o vi√™n c√≥ d·∫°y l·ªõp n√†o kh√¥ng V√Ä chu·ªói l·ªõp ƒë√≥ c√≥ ch·ª©a l·ªõp c·ªßa h·ªçc sinh kh√¥ng.\n  if (teacherClasses && teacherClasses.includes(studentClass)) {\n    \n    // N·∫øu ƒë√∫ng, th√™m gi√°o vi√™n n√†y v√†o danh s√°ch k·∫øt qu·∫£.\n    foundTeachers.push(teacherItem);\n  }\n}\n\n// In ra console ƒë·ªÉ g·ª° l·ªói (c√≥ th·ªÉ xem trong Browser Console c·ªßa n8n).\nconsole.log(`ƒê√£ t√¨m th·∫•y ${foundTeachers.length} gi√°o vi√™n d·∫°y l·ªõp ${studentClass}.`);\n\n// --- B∆Ø·ªöC 4: T√ÅI C·∫§U TR√öC V√Ä TR·∫¢ V·ªÄ K·∫æT QU·∫¢ ---\n\n// Ki·ªÉm tra xem c√≥ t√¨m th·∫•y gi√°o vi√™n n√†o kh√¥ng.\nif (foundTeachers.length === 0) {\n  // N·∫øu kh√¥ng c√≥, tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t v·ªõi danh s√°ch r·ªóng.\n  return [{\n    json: {\n      danhSachGiaoVien: [],\n      soLuong: 0\n    }\n  }];\n}\n\n// L·∫•y d·ªØ li·ªáu json s·∫°ch t·ª´ c√°c item gi√°o vi√™n t√¨m ƒë∆∞·ª£c.\nconst teacherList = foundTeachers.map(item => item.json);\n\n// Tr·∫£ v·ªÅ m·ªôt M·∫¢NG ch·ª©a M·ªòT ƒê·ªêI T∆Ø·ª¢NG DUY NH·∫§T.\n// ƒê·ªëi t∆∞·ª£ng n√†y ch·ª©a to√†n b·ªô danh s√°ch gi√°o vi√™n ƒë√£ ƒë∆∞·ª£c l·ªçc.\nreturn [{\n  json: {\n    danhSachGiaoVien: teacherList,\n    soLuong: teacherList.length\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2656,
        224
      ],
      "id": "a45e24aa-147a-4d9c-9108-0382b62ea9f6",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1VO6phWsT8Plz_1Cu05pIoOEGyfAGO3Jx--fAVpfLWBA/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Gmail",
              "lookupValue": "={{ $('Gmail Trigger').item.json.from.value[0].address }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        832,
        208
      ],
      "id": "cf44d1ec-f579-4d94-b497-622445537abc",
      "name": "GetStudentInfo",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "2cXkUqIFSIHamxSV",
          "name": "Phan Ng·ªçc H√¢n"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·ªëi c·∫£nh: Anh l√† m·ªôt AI chuy√™n gia logic v√† x·ª≠ l√Ω d·ªØ li·ªáu, ho·∫°t ƒë·ªông nh∆∞ m·ªôt ƒëi·ªÅu ph·ªëi vi√™n h·ªçc v·ª• th√¥ng minh. Nhi·ªám v·ª• c·ªßa Anh l√† t√¨m ra gi√°o vi√™n ph√π h·ª£p nh·∫•t cho m·ªôt b√†i t·∫≠p d·ª±a tr√™n n·ªôi dung vƒÉn b·∫£n c·ªßa b√†i t·∫≠p ƒë√≥ v√† danh s√°ch c√°c gi√°o vi√™n c√≥ s·∫µn.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o: Anh s·∫Ω nh·∫≠n ƒë∆∞·ª£c 2 m·∫©u th√¥ng tin:\n\nvanBan: M·ªôt chu·ªói vƒÉn b·∫£n ƒë∆∞·ª£c tr√≠ch xu·∫•t t·ª´ h√¨nh ·∫£nh, ch·ª©a n·ªôi dung li√™n quan ƒë·∫øn m·ªôt b√†i t·∫≠p: {{ $('HTTP Request1').first().json.extractedText }}.\n\ndanhSachGiaoVien: M·ªôt m·∫£ng (array) c√°c ƒë·ªëi t∆∞·ª£ng (object) JSON, m·ªói ƒë·ªëi t∆∞·ª£ng ƒë·∫°i di·ªán cho m·ªôt gi√°o vi√™n v√† c√≥ ch·ª©a m·ªôt tr∆∞·ªùng quan tr·ªçng l√† M√¥n d·∫°y ch√≠nh: {{ JSON.stringify($json.danhSachGiaoVien) }}.\n\nNhi·ªám v·ª• ch√≠nh: T·ª´ vanBan v√† danhSachGiaoVien, Anh ph·∫£i t√¨m ra m·ªôt v√† ch·ªâ m·ªôt gi√°o vi√™n ph√π h·ª£p nh·∫•t. ƒê·ªÉ l√†m ƒëi·ªÅu n√†y, Anh ph·∫£i tu√¢n th·ªß nghi√™m ng·∫∑t quy tr√¨nh suy lu·∫≠n theo t·ª´ng b∆∞·ªõc sau ƒë√¢y. ƒê√¢y l√† m·ªôt quy tr√¨nh ∆∞u ti√™n, nghƒ©a l√† n·∫øu t√¨m th·∫•y k·∫øt qu·∫£ ·ªü b∆∞·ªõc n√†o th√¨ ph·∫£i d·ª´ng l·∫°i v√† tr·∫£ v·ªÅ k·∫øt qu·∫£ ƒë√≥ ngay l·∫≠p t·ª©c.\n\nQUY TR√åNH SUY LU·∫¨N B·∫ÆT BU·ªòC:\n\nB∆∞·ªõc 0: Ph√¢n t√≠ch v√† Chu·∫©n b·ªã\n\nƒê·ªçc k·ªπ vanBan ƒë·ªÉ x√°c ƒë·ªãnh m√¥n h·ªçc c·ªßa b√†i t·∫≠p. G·ªçi ƒë√¢y l√† assignmentSubject.\n\nT·∫°o phi√™n b·∫£n ƒë√£ ƒë∆∞·ª£c chu·∫©n h√≥a c·ªßa m√¥n h·ªçc n√†y b·∫±ng c√°ch: chuy·ªÉn th√†nh ch·ªØ th∆∞·ªùng, b·ªè h·∫øt d·∫•u ti·∫øng Vi·ªát. G·ªçi ƒë√¢y l√† cleanAssignmentSubject.\n\nL·∫∑p qua danhSachGiaoVien, v·ªõi m·ªói gi√°o vi√™n, l·∫•y ra m√¥n d·∫°y c·ªßa h·ªç (teacherSubject) v√† c≈©ng t·∫°o m·ªôt phi√™n b·∫£n chu·∫©n h√≥a t∆∞∆°ng ·ª©ng (cleanTeacherSubject).\n\nB∆∞·ªõc 1: Ki·ªÉm tra Tr√πng kh·ªõp tuy·ªát ƒë·ªëi (∆Øu ti√™n cao nh·∫•t)\n\nSo s√°nh cleanAssignmentSubject v·ªõi cleanTeacherSubject c·ªßa t·ª´ng gi√°o vi√™n.\n\nN·∫øu t√¨m th·∫•y m·ªôt gi√°o vi√™n c√≥ cleanTeacherSubject GI·ªêNG H·ªÜT cleanAssignmentSubject, h√£y ch·ªçn ngay gi√°o vi√™n ƒë√≥ v√† chuy·ªÉn ƒë·∫øn B∆∞·ªõc 6 ƒë·ªÉ tr·∫£ v·ªÅ k·∫øt qu·∫£.\n\nB∆∞·ªõc 2: Ki·ªÉm tra Bao h√†m\n\nN·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ ·ªü B∆∞·ªõc 1, h√£y ki·ªÉm tra ti·∫øp.\n\nV·ªõi m·ªói gi√°o vi√™n, xem cleanTeacherSubject c√≥ ch·ª©a cleanAssignmentSubject kh√¥ng, HO·∫∂C ng∆∞·ª£c l·∫°i.\n\nN·∫øu t√¨m th·∫•y, h√£y ch·ªçn gi√°o vi√™n ƒë√≥ v√† chuy·ªÉn ƒë·∫øn B∆∞·ªõc 6.\n\nB∆∞·ªõc 3: Ki·ªÉm tra ƒê·ªìng nghƒ©a v√† Vi·∫øt t·∫Øt\n\nN·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ ·ªü B∆∞·ªõc 2, h√£y s·ª≠ d·ª•ng danh s√°ch ƒë·ªìng nghƒ©a sau:\n\nNh√≥m 1: ['c√¥ng ngh·ªá th√¥ng tin', 'tin h·ªçc', 'it']\n\nNh√≥m 2: ['gdcd', 'gi√°o d·ª•c c√¥ng d√¢n']\n\nNh√≥m 3: ['th·ªÉ d·ª•c', 'gi√°o d·ª•c th·ªÉ ch·∫•t']\n\nNh√≥m 4: ['ng·ªØ vƒÉn', 'ti·∫øng vi·ªát']\n\nKi·ªÉm tra xem cleanAssignmentSubject v√† cleanTeacherSubject c√≥ c√πng thu·ªôc m·ªôt nh√≥m hay kh√¥ng.\n\nN·∫øu c√≥, ch·ªçn gi√°o vi√™n ƒë√≥ v√† chuy·ªÉn ƒë·∫øn B∆∞·ªõc 6.\n\nB∆∞·ªõc 4: Ki·ªÉm tra M√¥n t·ªï h·ª£p\n\nN·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ ·ªü B∆∞·ªõc 3, h√£y d√πng teacherSubject G·ªêC (ch∆∞a chu·∫©n h√≥a) c·ªßa gi√°o vi√™n v√† cleanAssignmentSubject.\n\nKi·ªÉm tra xem teacherSubject c√≥ ph·∫£i l√† m√¥n t·ªï h·ª£p ch·ª©a cleanAssignmentSubject kh√¥ng, d·ª±a theo danh s√°ch:\n\n'l·ªãch s·ª≠ v√† ƒë·ªãa l√Ω' ch·ª©a: 'l·ªãch s·ª≠', 'ƒë·ªãa l√Ω'.\n\n'khoa h·ªçc t·ª± nhi√™n' ch·ª©a: 'v·∫≠t l√Ω', 'h√≥a h·ªçc', 'sinh h·ªçc'.\n\n't·ª± nhi√™n v√† x√£ h·ªôi' ch·ª©a: 'sinh h·ªçc', 'l·ªãch s·ª≠', 'ƒë·ªãa l√Ω', 'khoa h·ªçc'.\n\n'ngh·ªá thu·∫≠t' ch·ª©a: '√¢m nh·∫°c', 'm·ªπ thu·∫≠t'.\n\n'tin h·ªçc v√† c√¥ng ngh·ªá' ch·ª©a: 'tin h·ªçc', 'c√¥ng ngh·ªá'.\n\n'khoa h·ªçc c∆° b·∫£n' ch·ª©a: 'to√°n cao c·∫•p', 'v·∫≠t l√Ω ƒë·∫°i c∆∞∆°ng', 'to√°n', 'l√Ω', 'h√≥a'.\n\n'khoa h·ªçc x√£ h·ªôi & nh√¢n vƒÉn' ch·ª©a: 'l·ªãch s·ª≠', 'ƒë·ªãa l√Ω', 'gi√°o d·ª•c c√¥ng d√¢n', 'vƒÉn h·ªçc'.\n\nN·∫øu c√≥, ch·ªçn gi√°o vi√™n ƒë√≥ v√† chuy·ªÉn ƒë·∫øn B∆∞·ªõc 6.\n\nB∆∞·ªõc 5: Ki·ªÉm tra Gi√°o vi√™n ch·ªß nhi·ªám (∆Øu ti√™n th·∫•p nh·∫•t)\n\nN·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ ·ªü B∆∞·ªõc 4, h√£y d√πng teacherSubject G·ªêC.\n\nKi·ªÉm tra 2 ƒëi·ªÅu ki·ªán ƒê·ªíNG TH·ªúI:\n\nteacherSubject c√≥ ch·ª©a \"gi√°o vi√™n ch·ªß nhi·ªám\" ho·∫∑c \"gvcn\" KH√îNG?\n\nV√Ä cleanAssignmentSubject c√≥ n·∫±m trong danh s√°ch c√°c m√¥n c·∫•p 1 n√†y KH√îNG: [to√°n, ti·∫øng vi·ªát, t·ª± nhi√™n v√† x√£ h·ªôi, ƒë·∫°o ƒë·ª©c, tin h·ªçc v√† c√¥ng ngh·ªá, gi√°o d·ª•c th·ªÉ ch·∫•t, ngh·ªá thu·∫≠t, √¢m nh·∫°c, m·ªπ thu·∫≠t, ho·∫°t ƒë·ªông tr·∫£i nghi·ªám, tin h·ªçc, c√¥ng ngh·ªá].\n\nN·∫øu c·∫£ hai ƒëi·ªÅu ki·ªán ƒë·ªÅu ƒë√∫ng, ch·ªçn gi√°o vi√™n ƒë√≥ v√† chuy·ªÉn ƒë·∫øn B∆∞·ªõc 6.\n\nB∆∞·ªõc 6: Tr·∫£ v·ªÅ k·∫øt qu·∫£\n\nTO√ÄN B·ªò PH·∫¢N H·ªíI C·ª¶A ANH PH·∫¢I L√Ä ƒê·ªêI T∆Ø·ª¢NG JSON C·ª¶A GI√ÅO VI√äN ƒê√É T√åM TH·∫§Y.\n\nKH√îNG GI·∫¢I TH√çCH. KH√îNG TH√äM B·∫§T K·ª≤ D·ªÆ LI·ªÜU N√ÄO KH√ÅC.\n\nV√≠ d·ª• n·∫øu t√¨m th·∫•y: {\"row_number\": 2, \"T√™n tr∆∞·ªùng\": \"TH Ng·ªçc Th·ª•y\", \"M√¥n d·∫°y ch√≠nh\": \"Gi√°o vi√™n ch·ªß nhi·ªám (C·∫•p 1)\", ...}\n\nN·∫øu kh√¥ng t√¨m th·∫•y, tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng JSON r·ªóng: {}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2864,
        224
      ],
      "id": "9a84eaa1-6703-4a4f-be50-daf93df93792",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2864,
        352
      ],
      "id": "34d80fa3-ac01-4718-9ea1-d50ffd57f505",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "VgBRYCD6qxvsAUYe",
          "name": "ki·ªÉm tra"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y item ƒë·∫ßu v√†o\nconst item = $input.item;\n\n// L·∫•y to√†n b·ªô chu·ªói vƒÉn b·∫£n th√¥ t·ª´ AI\nconst rawOutput = item.json.output;\n\n// --- B∆Ø·ªöC M·ªöI: D·ªçn d·∫πp v√† tr√≠ch xu·∫•t chu·ªói JSON s·∫°ch ---\n// S·ª≠ d·ª•ng bi·ªÉu th·ª©c ch√≠nh quy (Regular Expression) ƒë·ªÉ t√¨m chu·ªói b·∫Øt ƒë·∫ßu b·∫±ng { v√† k·∫øt th√∫c b·∫±ng }\n// C·ªù 's' cho ph√©p d·∫•u '.' kh·ªõp v·ªõi c·∫£ k√Ω t·ª± xu·ªëng d√≤ng\nconst match = rawOutput.match(/{.*}/s);\n\n// Ki·ªÉm tra xem c√≥ t√¨m th·∫•y chu·ªói JSON h·ª£p l·ªá trong output c·ªßa AI kh√¥ng\nif (!match || !match[0]) {\n  console.log(\"Kh√¥ng t√¨m th·∫•y chu·ªói JSON h·ª£p l·ªá trong output c·ªßa AI.\");\n  return []; // D·ª´ng l·∫°i n·∫øu kh√¥ng t√¨m th·∫•y\n}\n\n// L·∫•y chu·ªói JSON s·∫°ch ƒë√£ ƒë∆∞·ª£c tr√≠ch xu·∫•t\nconst cleanJsonString = match[0];\n// --- K·∫æT TH√öC B∆Ø·ªöC M·ªöI ---\n\n// S·ª≠ d·ª•ng try...catch ƒë·ªÉ x·ª≠ l√Ω l·ªói n·∫øu chu·ªói JSON v·∫´n b·ªã sai c·∫•u tr√∫c\ntry {\n  // Parse chu·ªói JSON S·∫†CH\n  const parsedData = JSON.parse(cleanJsonString);\n\n  // Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ƒë∆∞·ª£c parse n·∫øu th√†nh c√¥ng\n  return [{\n    json: parsedData\n  }];\n} catch (error) {\n  // N·∫øu c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh parse, ghi l·∫°i l·ªói v√† tr·∫£ v·ªÅ th√¥ng b√°o l·ªói\n  console.error(\"L·ªói khi parse chu·ªói JSON ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp:\", error);\n  console.error(\"Chu·ªói g√¢y l·ªói:\", cleanJsonString);\n  // Tr·∫£ v·ªÅ m·ªôt item ch·ª©a l·ªói ƒë·ªÉ c√°c b∆∞·ªõc sau c√≥ th·ªÉ x·ª≠ l√Ω\n  return [{ \n    json: { \n      error: \"Kh√¥ng th·ªÉ parse chu·ªói JSON t·ª´ AI\", \n      errorDetails: error.message,\n      rawData: cleanJsonString \n    } \n  }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3216,
        224
      ],
      "id": "52c88d8c-7b74-4ca6-a08c-b666a1a26668",
      "name": "Code in JavaScript3"
    }
  ],
  "pinData": {},
  "connections": {
    "Gmail Trigger": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "Search files and folders2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Get a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get a message": {
      "main": [
        [
          {
            "node": "Send a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Search files and folders",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "Search files and folders1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders1": {
      "main": [
        [
          {
            "node": "GetStudentInfo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Send a message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders2": {
      "main": [
        [
          {
            "node": "Search files and folders3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders3": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders4": {
      "main": [
        [
          {
            "node": "Search files and folders5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetStudentInfo": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "d7efaea8-9948-4d58-be5c-40d8ada47c00",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "df75f6d19da9532b87ea5a84541b4ccc1d0dd5baf896242962b0dfcbc492bcf4"
  },
  "id": "1qMAzqgdpLlO91sC",
  "tags": []
}