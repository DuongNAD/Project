{
  "name": "monday",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -480,
        1120
      ],
      "id": "3133c159-d9d6-4805-afd8-900a13a40cad",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "2L5SggYtM77iWle3",
          "name": "h·ªèi ƒë√°p 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Quy t·∫Øc Ng√¥n ng·ªØ Ch√≠nh:\nCh·ªâ d·∫´n ch√≠nh v√† quan tr·ªçng nh·∫•t c·ªßa b·∫°n l√† x√°c ƒë·ªãnh ng√¥n ng·ªØ c·ªßa c√¢u h·ªèi ƒë·∫ßu v√†o t·ª´ ng∆∞·ªùi d√πng \"{{ JSON.stringify($json.ten_cau_hoi) }}\" v√† t·∫°o to√†n b·ªô c√¢u tr·∫£ l·ªùi CH·ªà b·∫±ng ng√¥n ng·ªØ ƒë√≥. Quy t·∫Øc n√†y ghi ƒë√® l√™n t·∫•t c·∫£ c√°c b·ªëi c·∫£nh kh√°c.\n\nB·ªëi c·∫£nh:\nB·∫°n l√† m·ªôt Gia s∆∞ AI chuy√™n nghi·ªáp, ƒë∆∞·ª£c t√≠ch h·ª£p v√†o m·ªôt h·ªá th·ªëng tr·ª£ l√Ω h·ªçc t·∫≠p ·∫£o. Vai tr√≤ c·ªßa b·∫°n l√† gi·∫£ng d·∫°y v√† tr·∫£ l·ªùi c√°c c√¢u h·ªèi h·ªçc thu·∫≠t v·ªÅ m√¥n h·ªçc: {{ JSON.stringify($json.mon_hoc) }}.\n\nVai tr√≤:\nL√† m·ªôt nh√† gi√°o d·ª•c c√≥ kinh nghi·ªám v·ªÅ m√¥n {{ JSON.stringify($json.mon_hoc) }}, b·∫°n c√≥ s·ª± hi·ªÉu bi·∫øt s√¢u s·∫Øc v·ªÅ ch∆∞∆°ng tr√¨nh h·ªçc. Nhi·ªám v·ª• c·ªßa b·∫°n l√† ph√¢n t√≠ch c√¢u h·ªèi c·ªßa h·ªçc sinh ƒë·ªÉ x√°c ƒë·ªãnh nhu c·∫ßu v√† nh·ªØng ƒëi·ªÉm c√≥ th·ªÉ h·ªç ch∆∞a hi·ªÉu r√µ. D·ª±a tr√™n ƒë√≥, b·∫°n s·∫Ω so·∫°n th·∫£o nh·ªØng c√¢u tr·∫£ l·ªùi, l·ªùi gi·∫£i, ho·∫∑c b√†i gi·∫£ng ng·∫Øn r√µ r√†ng, ch√≠nh x√°c, v√† truy·ªÅn c·∫£m h·ª©ng, ph√π h·ª£p v·ªõi tr√¨nh ƒë·ªô c·ªßa h·ªçc sinh: {{ JSON.stringify($json.trinh_do) }}.\n\nC√¢u h·ªèi ƒë·∫ßu v√†o:\n\"{{ $('Code4').item.json.messageText }}\"\n\nNguy√™n t·∫Øc ho·∫°t ƒë·ªông:\nPh√¢n t√≠ch v√† Hi·ªÉu s√¢u: Ph√¢n t√≠ch s√¢u c√¢u h·ªèi ƒë·∫ßu v√†o ƒë·ªÉ hi·ªÉu √Ω ƒë·ªãnh th·ª±c s·ª± c·ªßa h·ªçc sinh v√† x√°c ƒë·ªãnh b·∫•t k·ª≥ l·ªó h·ªïng ki·∫øn th·ª©c n√†o.\n\nPh·∫£n h·ªìi ch·∫•t l∆∞·ª£ng cao: Vi·∫øt m·ªôt c√¢u tr·∫£ l·ªùi ch√≠nh x√°c, logic v√† d·ªÖ hi·ªÉu cho c·∫•p ƒë·ªô h·ªçc sinh ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh.\n\nƒê∆°n gi·∫£n h√≥a v·∫•n ƒë·ªÅ ph·ª©c t·∫°p: Chia nh·ªè c√°c ch·ªß ƒë·ªÅ ph·ª©c t·∫°p th√†nh c√°c ph·∫ßn nh·ªè h∆°n, d·ªÖ ti·∫øp thu. S·ª≠ d·ª•ng ng√¥n ng·ªØ ƒë∆°n gi·∫£n v√† tr√°nh c√°c thu·∫≠t ng·ªØ chuy√™n ng√†nh tr·ª´ khi c·∫ßn thi·∫øt.\n\nMinh h·ªça v√† Li√™n k·∫øt: Cung c·∫•p c√°c v√≠ d·ª• th·ª±c t·∫ø, ph√©p lo·∫°i suy ho·∫∑c so s√°nh d·ªÖ li√™n t∆∞·ªüng ƒë·ªÉ gi√∫p h·ªçc sinh h√¨nh dung v√† ghi nh·ªõ ki·∫øn th·ª©c.\n\nGi·∫£i quy·∫øt c√°c hi·ªÉu l·∫ßm th∆∞·ªùng g·∫∑p: Ch·ªß ƒë·ªông l√†m r√µ c√°c hi·ªÉu l·∫ßm ph·ªï bi·∫øn li√™n quan ƒë·∫øn ch·ªß ƒë·ªÅ.\n\nƒê·ªãnh nghƒ©a thu·∫≠t ng·ªØ: N·∫øu b·∫°n s·ª≠ d·ª•ng thu·∫≠t ng·ªØ k·ªπ thu·∫≠t ho·∫∑c c·ªët l√µi, lu√¥n cung c·∫•p m·ªôt ƒë·ªãnh nghƒ©a ƒë∆°n gi·∫£n.\n\nC√°c r√†ng bu·ªôc:\nTu√¢n th·ªß Quy t·∫Øc Ng√¥n ng·ªØ Ch√≠nh tr√™n h·∫øt. Ng√¥n ng·ªØ c·ªßa c√¢u tr·∫£ l·ªùi ph·∫£i kh·ªõp v·ªõi ng√¥n ng·ªØ c·ªßa c√¢u h·ªèi ƒë·∫ßu v√†o.\n\nKi·ªÉm tra t√≠nh x√°c th·ª±c tr∆∞·ªõc khi tr·∫£ l·ªùi: N·∫øu c√¢u h·ªèi c·ªßa ng∆∞·ªùi d√πng cung c·∫•p th√¥ng tin kh√¥ng ch√≠nh x√°c, m√¢u thu·∫´n ho·∫∑c kh√¥ng ƒë·ªß, h√£y n√™u r√µ r·∫±ng b·∫°n kh√¥ng th·ªÉ ƒë∆∞a ra c√¢u tr·∫£ l·ªùi ƒë√°ng tin c·∫≠y. Kh√¥ng ƒë∆∞·ª£c t·ª± b·ªãa ƒë·∫∑t th√¥ng tin.\n\nY√™u c·∫ßu l√†m r√µ: Thay v√¨ ƒëo√°n, h√£y ƒë·∫∑t c√¢u h·ªèi ƒë·ªÉ l√†m r√µ. V√≠ d·ª•: \"ƒê·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ n√†y, t√¥i c·∫ßn th√™m th√¥ng tin v·ªÅ X. B·∫°n c√≥ th·ªÉ cung c·∫•p kh√¥ng?\" ho·∫∑c \"D∆∞·ªùng nh∆∞ c√≥ m·ªôt s·ª± nh·∫ßm l·∫´n v·ªÅ kh√°i ni·ªám Y. C√≥ ph·∫£i √Ω b·∫°n l√† Z kh√¥ng?\".",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -480,
        1008
      ],
      "id": "6a41ce43-8922-4137-b017-2b9eb604376d",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "827a988d-a2be-4dbb-8ed1-5ea18a9bd04e",
              "name": "text",
              "value": "={{ $('AI Agent').item.json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -112,
        1008
      ],
      "id": "ab06f0a8-87f4-4ab2-a613-492cdcb2803e",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -928,
        688
      ],
      "id": "6f466b81-7030-437e-9c22-212707bfa08b",
      "name": "Google Gemini Chat Model2",
      "credentials": {
        "googlePalmApi": {
          "id": "2L5SggYtM77iWle3",
          "name": "h·ªèi ƒë√°p 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt b·ªô m√°y x·ª≠ l√Ω vƒÉn b·∫£n chuy√™n d·ª•ng, kh√¥ng ph·∫£i l√† m·ªôt AI ƒë√†m tho·∫°i. Ch·ª©c nƒÉng duy nh·∫•t c·ªßa b·∫°n l√† th·ª±c thi m·ªôt thu·∫≠t to√°n tr√≠ch xu·∫•t th√¥ng tin tr√™n m·ªôt c√¢u ƒë·∫ßu v√†o v√† tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t. KH√îNG cung c·∫•p gi·∫£i th√≠ch hay b·∫•t k·ª≥ vƒÉn b·∫£n n√†o b√™n ngo√†i ƒë·ªëi t∆∞·ª£ng JSON.\n\nƒê·∫ßu v√†o: {{ $('Code4').item.json.messageText }}\n\nQuy t·∫Øc C·ªët l√µi: ƒê·∫ßu ti√™n, h√£y x√°c ƒë·ªãnh ng√¥n ng·ªØ c·ªßa ƒê·∫ßu v√†o. To√†n b·ªô c√°c gi√° tr·ªã chu·ªói cu·ªëi c√πng trong JSON ƒë·∫ßu ra (mon_hoc, loai_noi_dung, ten_bai_hoc) B·∫ÆT BU·ªòC ph·∫£i b·∫±ng ng√¥n ng·ªØ ƒë√£ ƒë∆∞·ª£c ph√°t hi·ªán.\n\nThu·∫≠t to√°n Tr√≠ch xu·∫•t:\n\nB∆Ø·ªöC 1: Kh·ªüi t·∫°o ƒê·ªëi t∆∞·ª£ng K·∫øt qu·∫£\nB·∫Øt ƒë·∫ßu v·ªõi m·ªôt ƒë·ªëi t∆∞·ª£ng JSON r·ªóng: {\"mon_hoc\": null, \"loai_noi_dung\": null, \"ten_bai_hoc\": null}\n\nB∆Ø·ªöC 2: Tr√≠ch xu·∫•t mon_hoc (M√¥n h·ªçc)\n\nƒê·ªãnh nghƒ©a c√°c Kh√°i ni·ªám M√¥n h·ªçc: C√°c m√¥n h·ªçc ƒë∆∞·ª£c ph√©p d·ª±a tr√™n c√°c kh√°i ni·ªám sau: To√°n h·ªçc, V·∫≠t l√Ω, H√≥a h·ªçc, Sinh h·ªçc, Ng·ªØ vƒÉn, L·ªãch s·ª≠, ƒê·ªãa l√Ω, Gi√°o d·ª•c C√¥ng d√¢n, Kinh t·∫ø v√† Ph√°p lu·∫≠t, Ti·∫øng Anh, Tin h·ªçc, C√¥ng ngh·ªá, Gi√°o d·ª•c Qu·ªëc ph√≤ng v√† An ninh, Tri·∫øt h·ªçc, Kinh t·∫ø h·ªçc, T√¢m l√Ω h·ªçc, X√£ h·ªôi h·ªçc, Lu·∫≠t h·ªçc.\n\nT·ª´ kh√≥a t√¨m ki·∫øm:\n\nTo√°n h·ªçc: To√°n, To√°n h·ªçc, Math, Mathematics\n\nV·∫≠t l√Ω: V·∫≠t l√Ω, L√Ω, Physics\n\nH√≥a h·ªçc: H√≥a h·ªçc, H√≥a, Chemistry\n\n... (v√† c√°c m√¥n kh√°c t∆∞∆°ng t·ª±)\n\nLogic Kh·ªõp l·ªánh (ƒê√É S·ª¨A ƒê·ªîI):\n\nQu√©t ƒë·∫ßu v√†o ƒë·ªÉ xem n√≥ c√≥ ch·ª©a m·ªôt t·ª´ kh√≥a t∆∞∆°ng ·ª©ng v·ªõi m·ªôt trong c√°c kh√°i ni·ªám m√¥n h·ªçc ƒë∆∞·ª£c ph√©p hay kh√¥ng.\n\nN·∫øu t√¨m th·∫•y, h√£y g√°n t√™n m√¥n h·ªçc b·∫±ng ti·∫øng Vi·ªát (v√≠ d·ª•: \"V·∫≠t l√Ω\", \"To√°n h·ªçc\") v√†o kh√≥a mon_hoc v√† d·ª´ng l·∫°i.\n\nV√≠ d·ª•: N·∫øu ƒë·∫ßu v√†o ch·ª©a 'b√†i t·∫≠p L√Ω', b·∫°n x√°c ƒë·ªãnh ƒë∆∞·ª£c m√¥n h·ªçc l√† V·∫≠t l√Ω. Gi√° tr·ªã g√°n cho mon_hoc s·∫Ω l√† \"V·∫≠t l√Ω\".\n\nQuy t·∫Øc Nghi√™m ng·∫∑t C·ªët l√µi: B·∫°n ph·∫£i th·ª±c hi·ªán m·ªôt s·ª± kh·ªõp l·ªánh kh√°i ni·ªám ch√≠nh x√°c. V√≠ d·ª•, kh√°i ni·ªám \"Kinh t·∫ø vi m√¥\" kh√°c v·ªõi \"Kinh t·∫ø h·ªçc\". N·∫øu \"Kinh t·∫ø h·ªçc\" l√† m·ªôt kh√°i ni·ªám ƒë∆∞·ª£c ph√©p nh∆∞ng \"Kinh t·∫ø vi m√¥\" th√¨ kh√¥ng, v√† ƒë·∫ßu v√†o l√† \"l√Ω thuy·∫øt kinh t·∫ø vi m√¥\", th√¨ mon_hoc B·∫ÆT BU·ªòC ph·∫£i l√† null. Kh√¥ng ƒë∆∞·ª£c suy lu·∫≠n ra m·ªôt danh m·ª•c cha.\n\nB∆Ø·ªöC 3: Tr√≠ch xu·∫•t loai_noi_dung (Lo·∫°i n·ªôi dung)\nTh·ª±c thi v·ªõi th·ª© t·ª± ∆∞u ti√™n sau:\n\nQu√©t c√°c t·ª´ kh√≥a lo·∫°i \"B√†i t·∫≠p\": ƒê·∫ßu v√†o c√≥ ch·ª©a c√°c t·ª´ t∆∞∆°ng ƒë∆∞∆°ng v·ªÅ m·∫∑t kh√°i ni·ªám v·ªõi: b√†i t·∫≠p, ki·ªÉm tra, √¥n t·∫≠p, th·ª±c h√†nh, c√¢u h·ªèi, gi·∫£i, thi kh√¥ng?\n\nN·∫øu c√≥, g√°n t·ª´ cho \"b√†i t·∫≠p\" trong ng√¥n ng·ªØ c·ªßa ƒë·∫ßu v√†o cho loai_noi_dung v√† chuy·ªÉn sang B∆Ø·ªöC 4.\n\nQu√©t c√°c t·ª´ kh√≥a lo·∫°i \"B√†i h·ªçc\": N·∫øu ƒëi·ªÅu ki·ªán tr√™n kh√¥ng ƒë∆∞·ª£c ƒë√°p ·ª©ng, qu√©t c√°c t·ª´ t∆∞∆°ng ƒë∆∞∆°ng v·ªÅ m·∫∑t kh√°i ni·ªám v·ªõi: b√†i h·ªçc, l√Ω thuy·∫øt, kh√°i ni·ªám, ƒë·ªãnh nghƒ©a, b√†i gi·∫£ng v·ªÅ, th√¥ng tin v·ªÅ, ch·ªß ƒë·ªÅ.\n\nN·∫øu c√≥, g√°n t·ª´ cho \"b√†i h·ªçc\" trong ng√¥n ng·ªØ c·ªßa ƒë·∫ßu v√†o cho loai_noi_dung.\n\nN·∫øu kh√¥ng t√¨m th·∫•y t·ª´ kh√≥a n√†o, loai_noi_dung v·∫´n l√† null.\n\nB∆Ø·ªöC 4: Tr√≠ch xu·∫•t ten_bai_hoc (T√™n ch·ªß ƒë·ªÅ)\n\nX√°c ƒë·ªãnh ch·ªß ƒë·ªÅ ch√≠nh, c·ª• th·ªÉ c·ªßa ƒë·∫ßu v√†o.\n\nƒê√¢y l√† n·ªôi dung c·ªët l√µi c√≤n l·∫°i sau khi lo·∫°i tr·ª´ c√°c t·ª´ kh√≥a li√™n quan ƒë·∫øn mon_hoc v√† loai_noi_dung.\n\nN·∫øu kh√¥ng th·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c ch·ªß ƒë·ªÅ r√µ r√†ng, gi√° tr·ªã n√†y v·∫´n l√† null.\n\nB∆Ø·ªöC 5: Tr·∫£ v·ªÅ K·∫øt qu·∫£ Cu·ªëi c√πng\nXu·∫•t ra ƒë·ªëi t∆∞·ª£ng JSON ƒë√£ ƒë∆∞·ª£c ƒëi·ªÅn th√¥ng tin.\n\nV√ç D·ª§ ƒê√É S·ª¨A ƒê·ªîI:\n\nƒê·∫ßu v√†o: gi·∫£i b√†i t·∫≠p tri·∫øt h·ªçc M√°c-L√™nin\n\nƒê·∫ßu ra: {\"mon_hoc\": \"Tri·∫øt h·ªçc\", \"loai_noi_dung\": \"b√†i t·∫≠p\", \"ten_bai_hoc\": \"M√°c-L√™nin\"}\n\nƒê·∫ßu v√†o: b√†i t·∫≠p ƒê·ªãa l√Ω v·ªÅ kh√≠ h·∫≠u Vi·ªát Nam\n\nƒê·∫ßu ra: {\"mon_hoc\": \"ƒê·ªãa l√Ω\", \"loai_noi_dung\": \"b√†i t·∫≠p\", \"ten_bai_hoc\": \"kh√≠ h·∫≠u Vi·ªát Nam\"}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -928,
        544
      ],
      "id": "745dba1e-17b9-4a6a-bc52-a9f70fe090e7",
      "name": "L·ªçc m√¥n h·ªçc -  B√†i h·ªçc",
      "retryOnFail": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        576,
        1968
      ],
      "id": "b1638352-b4bc-4558-8f36-50cf1daf01f3",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "2L5SggYtM77iWle3",
          "name": "h·ªèi ƒë√°p 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "3d56ac63-032e-4337-bebd-14e57e0442c3",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -960,
        1920
      ],
      "id": "056ed709-65e5-4f3c-bdbb-e2dee582410a",
      "name": "If5"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=T√¨m hi·ªÉu tr∆∞·ªõc b√†i m·ªõi",
        "limit": 1,
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -1168,
        1920
      ],
      "id": "b2898093-a364-4995-83cb-279f4b84c686",
      "name": "Search files and folders1",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "T√¨m hi·ªÉu tr∆∞·ªõc b√†i m·ªõi",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -768,
        1856
      ],
      "id": "1a4b23ea-325c-4bb7-836e-d9750c2070fe",
      "name": "Create folder",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "folderId": "={{ $('Edit Fields21').first().json['Folder_t√¨m hi·ªÉu tr∆∞·ªõc b√†i m·ªõi'] }}",
        "title": "={{ $json.entities.lesson }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        384,
        1840
      ],
      "id": "0e952088-6d05-42fd-8c48-3f8625476bf4",
      "name": "Create a document",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7MvGqSisr4fJHX63",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt nh√† thi·∫øt k·∫ø ch∆∞∆°ng tr√¨nh h·ªçc truy·ªÅn c·∫£m h·ª©ng v√† m·ªôt gi√°o vi√™n t√¢m huy·∫øt, v·ªõi kh·∫£ nƒÉng bi·∫øn nh·ªØng ch·ªß ƒë·ªÅ ph·ª©c t·∫°p tr·ªü n√™n g·∫ßn g≈©i v√† th√∫ v·ªã. Nhi·ªám v·ª• c·ªßa b·∫°n l√† so·∫°n m·ªôt t√†i li·ªáu b√†i gi·∫£ng chi ti·∫øt ƒë·ªÉ h·ªçc sinh c√≥ th·ªÉ t·ª± h·ªçc v√† n·∫Øm v·ªØng ki·∫øn th·ª©c b√†i m·ªõi t·∫°i nh√†, chu·∫©n b·ªã t√¢m th·∫ø t·ªët nh·∫•t tr∆∞·ªõc khi ƒë·∫øn l·ªõp.\n\nTh√¥ng tin ƒë·∫ßu v√†o:\n\nT√™n b√†i h·ªçc: {{ $('Code in JavaScript').item.json.entities.lesson }}\n\nM√¥n h·ªçc: {{ $('Code in JavaScript').item.json.entities.subject }}\n\nL·ªõp: {{ $('Code10').item.json.folderName }}\n\nC·∫•u tr√∫c v√† Ch·ªâ d·∫´n chi ti·∫øt:\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i t·∫°o t√†i li·ªáu theo ƒë√∫ng c·∫•u tr√∫c, logic v√† c√°c ch·ªâ d·∫´n ƒë·ªãnh d·∫°ng d∆∞·ªõi ƒë√¢y.\n\n## H∆Ø·ªöNG D·∫™N B√ÄI H·ªåC: [T√™n b√†i h·ªçc]\n\n**M√¥n h·ªçc:** [T√™n m√¥n h·ªçc]\n**L·ªõp:** [L·ªõp h·ªçc]\n\nI. M·ª§C TI√äU B√ÄI H·ªåC\n(Vi·∫øt 2-3 m·ª•c ti√™u ch√≠nh, b·∫Øt ƒë·∫ßu b·∫±ng c√°c ƒë·ªông t·ª´ h√†nh ƒë·ªông m·∫°nh m·∫Ω nh∆∞: \"Hi·ªÉu ƒë∆∞·ª£c...\", \"Ph√¢n bi·ªát ƒë∆∞·ª£c...\", \"V·∫≠n d·ª•ng ƒë∆∞·ª£c...\". M·ª•c ti√™u ph·∫£i r√µ r√†ng v√† ƒëo l∆∞·ªùng ƒë∆∞·ª£c.)\n\nII. KH√ÅI NI·ªÜM V√Ä T·ª™ V·ª∞NG C·ªêT L√ïI\n(Li·ªát k√™ 3-5 thu·∫≠t ng·ªØ quan tr·ªçng nh·∫•t. V·ªõi m·ªói thu·∫≠t ng·ªØ, h√£y:\n\nƒê·ªãnh d·∫°ng t√™n b·∫±ng **T√™n thu·∫≠t ng·ªØ:**.\n\nGi·∫£i th√≠ch ng·∫Øn g·ªçn, s√∫c t√≠ch v√† d·ªÖ hi·ªÉu nh·∫•t c√≥ th·ªÉ.)\n\nIII. N·ªòI DUNG B√ÄI H·ªåC CHI TI·∫æT\n(ƒê√¢y l√† ph·∫ßn quan tr·ªçng nh·∫•t)\n(Tr√¨nh b√†y n·ªôi dung b√†i h·ªçc m·ªôt c√°ch ƒë·∫ßy ƒë·ªß, chi ti·∫øt v√† c√≥ h·ªá th·ªëng. H√£y:\n\nChia nh·ªè ch·ªß ƒë·ªÅ th√†nh c√°c ph·∫ßn (1, 2, 3...) ho·∫∑c c√°c ƒë·ªÅ m·ª•c nh·ªè h∆°n ƒë·ªÉ d·ªÖ theo d√µi.\n\nDi·ªÖn gi·∫£i t·ª´ng kh√°i ni·ªám m·ªôt c√°ch c·∫∑n k·∫Ω, t·ª´ c∆° b·∫£n ƒë·∫øn n√¢ng cao.\n\nS·ª≠ d·ª•ng c√°c v√≠ d·ª• minh h·ªça c·ª• th·ªÉ, c√°c ph√©p so s√°nh, ho·∫∑c c√°c c√¢u chuy·ªán ·∫©n d·ª• g·∫ßn g≈©i ƒë·ªÉ h·ªçc sinh d·ªÖ h√¨nh dung.\n\nS·ª≠ d·ª•ng ƒë·ªãnh d·∫°ng nh∆∞ g·∫°ch ƒë·∫ßu d√≤ng, in ƒë·∫≠m ƒë·ªÉ nh·∫•n m·∫°nh c√°c √Ω ch√≠nh v√† c√¥ng th·ª©c quan tr·ªçng.\n\nH√†nh vƒÉn nh∆∞ m·ªôt gi√°o vi√™n ƒëang gi·∫£ng b√†i tr·ª±c ti·∫øp: r√µ r√†ng, m·∫°ch l·∫°c v√† truy·ªÅn c·∫£m.)\n\nIV. T√ìM T·∫ÆT KI·∫æN TH·ª®C TR·ªåNG T√ÇM\n(Sau khi ƒë√£ gi·∫£ng b√†i chi ti·∫øt ·ªü m·ª•c III, h√£y vi·∫øt m·ªôt ƒëo·∫°n vƒÉn ng·∫Øn (kho·∫£ng 100-150 t·ª´) ƒë·ªÉ t·ªïng k·∫øt l·∫°i nh·ªØng ƒëi·ªÉm ki·∫øn th·ª©c c·ªët l√µi nh·∫•t m√† h·ªçc sinh c·∫ßn ph·∫£i ghi nh·ªõ.)\n\nV. C√ÇU H·ªéI G·ª¢I M·ªû\n(ƒê·∫∑t 3 c√¢u h·ªèi m·ªü ƒë·ªÉ k√≠ch th√≠ch h·ªçc sinh suy ng·∫´m s√¢u h∆°n v·ªÅ b√†i h·ªçc. C√°c c√¢u h·ªèi c·∫ßn li√™n h·ªá ki·∫øn th·ª©c v·ªõi th·ª±c t·∫ø ho·∫∑c khuy·∫øn kh√≠ch t∆∞ duy ph·∫£n bi·ªán. V√≠ d·ª•: \"Theo b·∫°n, ki·∫øn th·ª©c n√†y c√≥ th·ªÉ ƒë∆∞·ª£c ·ª©ng d·ª•ng v√†o lƒ©nh v·ª±c n√†o trong cu·ªôc s·ªëng?\", \"N·∫øu thay ƒë·ªïi y·∫øu t·ªë X trong c√¥ng th·ª©c, k·∫øt qu·∫£ s·∫Ω b·ªã ·∫£nh h∆∞·ªüng nh∆∞ th·∫ø n√†o? T·∫°i sao?\")\n\nY√™u c·∫ßu v·ªÅ gi·ªçng vƒÉn: S·ª≠ d·ª•ng gi·ªçng vƒÉn nh·∫π nh√†ng, th√¢n thi·ªán v√† khuy·∫øn kh√≠ch, nh∆∞ m·ªôt ng∆∞·ªùi th·∫ßy ƒëang tr√≤ chuy·ªán v√† d·∫´n d·∫Øt h·ªçc sinh.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        576,
        1840
      ],
      "id": "9bd3490b-b9da-4809-8b02-9ff4cb7ed90c",
      "name": "AI Agent4"
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $('Create a document').item.json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        928,
        1840
      ],
      "id": "53300783-dcd4-4c44-ba0c-551c0de24945",
      "name": "Update a document",
      "retryOnFail": true,
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7MvGqSisr4fJHX63",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0f62bd40-025a-4efd-80fa-42daa41d02ea",
              "leftValue": "={{ $json.loai_noi_dung }}",
              "rightValue": "b√†i h·ªçc",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -96,
        560
      ],
      "id": "1baa3356-d3e3-49d3-871a-8d4aa2837ba9",
      "name": "If6"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=NHI·ªÜM V·ª§\nPh√¢n t√≠ch c√¢u ƒë·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng ƒë·ªÉ x√°c ƒë·ªãnh 3 y·∫øu t·ªë ch√≠nh:\n\n√ù ƒë·ªãnh (Intent): Ng∆∞·ªùi d√πng c√≥ ƒëang mu·ªën t√¨m hi·ªÉu tr∆∞·ªõc m·ªôt b√†i h·ªçc m·ªõi kh√¥ng?\n\nTh·ª±c th·ªÉ (Entities): Tr√≠ch xu·∫•t t√™n \"m√¥n h·ªçc\" v√† \"t√™n b√†i h·ªçc\" n·∫øu c√≥.\n\nH√†nh ƒë·ªông ti·∫øp theo (Action): D·ª±a tr√™n th√¥ng tin c√≥ ƒë∆∞·ª£c, quy·∫øt ƒë·ªãnh h√†nh ƒë·ªông m√† h·ªá th·ªëng c·∫ßn th·ª±c hi·ªán.\n\nƒê·ªäNH NGHƒ®A\n√ù ƒë·ªãnh (Intent):\n\nPREPARE_LESSON: Khi ng∆∞·ªùi d√πng th·ªÉ hi·ªán r√µ mong mu·ªën t√¨m hi·ªÉu, chu·∫©n b·ªã, t√≥m t·∫Øt, ho·∫∑c xem tr∆∞·ªõc m·ªôt b√†i h·ªçc.\n\nUNKNOWN: C√°c tr∆∞·ªùng h·ª£p kh√°c (ch√†o h·ªèi, c√¢u kh√¥ng li√™n quan).\n\nH√†nh ƒë·ªông (Action):\n\nPROCEED: Khi ƒë√£ c√≥ ƒë·ªß c·∫£ \"m√¥n h·ªçc\" v√† \"t√™n b√†i h·ªçc\".\n\nREQUEST_INFO: Khi √Ω ƒë·ªãnh l√† PREPARE_LESSON nh∆∞ng thi·∫øu \"m√¥n h·ªçc\" ho·∫∑c \"t√™n b√†i h·ªçc\".\n\nFALLBACK: Khi √Ω ƒë·ªãnh l√† UNKNOWN.\n\nQUY T·∫ÆC\nN·∫øu kh√¥ng x√°c ƒë·ªãnh ƒë∆∞·ª£c t√™n m√¥n h·ªçc ho·∫∑c b√†i h·ªçc, h√£y ƒë·ªÉ gi√° tr·ªã l√† null.\n\nL∆ØU √ù QUAN TR·ªåNG: C·ª•m t·ª´ \"b√†i m·ªõi\" (ho·∫∑c c√°c bi·∫øn th·ªÉ nh∆∞ \"b√†i h·ªçc m·ªõi\") kh√¥ng ph·∫£i l√† m·ªôt t√™n b√†i h·ªçc c·ª• th·ªÉ. Khi g·∫∑p c·ª•m t·ª´ n√†y, h√£y coi nh∆∞ t√™n b√†i h·ªçc ch∆∞a ƒë∆∞·ª£c cung c·∫•p v√† ƒë·∫∑t gi√° tr·ªã lesson l√† null.\n\nN·∫øu c·∫ßn h·ªèi th√™m th√¥ng tin, h√£y t·∫°o ra m·ªôt c√¢u tr·∫£ l·ªùi th√¢n thi·ªán, t·ª± nhi√™n.\n\nLu√¥n lu√¥n tr·∫£ l·ªùi b·∫±ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá.\n\nƒê·ªäNH D·∫†NG ƒê·∫¶U RA\nTr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t theo c·∫•u tr√∫c sau. KH√îNG th√™m b·∫•t k·ª≥ gi·∫£i th√≠ch hay vƒÉn b·∫£n n√†o kh√°c.\n\nJSON\n\n{\n  \"intent\": \"PREPARE_LESSON | UNKNOWN\",\n  \"entities\": {\n    \"subject\": \"t√™n m√¥n h·ªçc\" | null,\n    \"lesson\": \"t√™n b√†i h·ªçc\" | null\n  },\n  \"action\": \"PROCEED | REQUEST_INFO | FALLBACK\",\n  \"reply\": \"c√¢u tr·∫£ l·ªùi cho ng∆∞·ªùi d√πng n·∫øu c·∫ßn\" | null\n}\nC√¢u c·∫ßn Ph√¢n t√≠ch: {{ $('Code4').item.json.messageText }}\nV√ç D·ª§\nV√ç D·ª§ 1: ƒê·∫ßy ƒë·ªß th√¥ng tin\nC√¢u ƒë·∫ßu v√†o: \"chu·∫©n b·ªã gi√∫p m√¨nh b√†i ƒë·ªãnh lu·∫≠t b·∫£o to√†n nƒÉng l∆∞·ª£ng m√¥n V·∫≠t l√Ω\"\n\nƒê·∫ßu ra:\n\nJSON\n\n{\n  \"intent\": \"PREPARE_LESSON\",\n  \"entities\": {\n    \"subject\": \"V·∫≠t l√Ω\",\n    \"lesson\": \"ƒë·ªãnh lu·∫≠t b·∫£o to√†n nƒÉng l∆∞·ª£ng\"\n  },\n  \"action\": \"PROCEED\",\n  \"reply\": null\n}\nV√ç D·ª§ 2: Thi·∫øu m√¥n h·ªçc\nC√¢u ƒë·∫ßu v√†o: \"t√≥m t·∫Øt cho m√¨nh b√†i quang h·ª£p\"\n\nƒê·∫ßu ra:\n\nJSON\n\n{\n  \"intent\": \"PREPARE_LESSON\",\n  \"entities\": {\n    \"subject\": null,\n    \"lesson\": \"quang h·ª£p\"\n  },\n  \"action\": \"REQUEST_INFO\",\n  \"reply\": \"Tuy·ªát v·ªùi! B·∫°n mu·ªën t√¨m hi·ªÉu b√†i 'quang h·ª£p' c·ªßa m√¥n h·ªçc n√†o v·∫≠y?\"\n}\nV√ç D·ª§ 3: Thi·∫øu t√™n b√†i h·ªçc\nC√¢u ƒë·∫ßu v√†o: \"m√¨nh mu·ªën chu·∫©n b·ªã b√†i m·ªõi m√¥n H√≥a\"\n\nƒê·∫ßu ra:\n\nJSON\n\n{\n  \"intent\": \"PREPARE_LESSON\",\n  \"entities\": {\n    \"subject\": \"H√≥a h·ªçc\",\n    \"lesson\": null\n  },\n  \"action\": \"REQUEST_INFO\",\n  \"reply\": \"R·∫•t s·∫µn l√≤ng! B·∫°n cho m√¨nh bi·∫øt t√™n b√†i h·ªçc c·ª• th·ªÉ c·ªßa m√¥n H√≥a b·∫°n mu·ªën chu·∫©n b·ªã l√† g√¨ nh√©.\"\n}\nV√ç D·ª§ 4: Kh√¥ng li√™n quan\nC√¢u ƒë·∫ßu v√†o: \"ch√†o b·∫°n\"\n\nƒê·∫ßu ra:\n\nJSON\n\n{\n  \"intent\": \"UNKNOWN\",\n  \"entities\": {\n    \"subject\": null,\n    \"lesson\": null\n  },\n  \"action\": \"FALLBACK\",\n  \"reply\": \"Ch√†o b·∫°n, m√¨nh l√† tr·ª£ l√Ω h·ªçc t·∫≠p ·∫£o. M√¨nh c√≥ th·ªÉ gi√∫p b·∫°n chu·∫©n b·ªã b√†i h·ªçc m·ªõi. B·∫°n mu·ªën t√¨m hi·ªÉu v·ªÅ m√¥n h·ªçc v√† b√†i h·ªçc n√†o?\"\n}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -368,
        1936
      ],
      "id": "df28f06e-33b1-41bb-8fc9-b997770575ca",
      "name": "AI Agent6"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -368,
        2064
      ],
      "id": "bdeffa57-bd8a-4c8a-ad16-91437d6d8ffa",
      "name": "Google Gemini Chat Model8",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4deab93f-54ed-47f6-809d-144df599ba9c",
              "leftValue": "={{ $json.action }}",
              "rightValue": "PROCEED",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        1936
      ],
      "id": "f1cf3fbb-1f91-488e-8027-66169c18f269",
      "name": "If7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "d1e60786-5202-4096-9a24-7d797943c0f8",
              "name": "text",
              "value": "=ƒê√¢y l√† link b√†i {{ $('Create a document').item.json.name }}: https://docs.google.com/document/d/{{ $('Create a document').item.json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1136,
        1840
      ],
      "id": "0430d7e8-8814-438a-b153-f5823581f8e6",
      "name": "Edit Fields9"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "8c43eb16-e5f2-45f9-b861-881bb3941d59",
              "leftValue": "={{ $json.loai_noi_dung }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -352,
        544
      ],
      "id": "079d1ca0-46fb-48de-9818-2df880b643a0",
      "name": "If10"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4dc80bdc-7cfa-49cb-b373-a9091564fb02",
              "name": "text",
              "value": "Xin l·ªói, b·∫°n mu·ªën t√¨m link \"B√†i h·ªçc\" hay \"B√†i t·∫≠p\"",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        240,
        -96
      ],
      "id": "d567754f-a782-4f7d-b42e-fac50bc74005",
      "name": "Edit Fields10"
    },
    {
      "parameters": {
        "jsCode": "// L·∫∑p qua t·ª´ng item d·ªØ li·ªáu ƒëi v√†o node\nfor (const item of items) {\n  try {\n    const rawOutput = item.json.output;\n\n    // C·∫¢I TI·∫æN: D√πng regex \"non-greedy\" ({.*?}) v·ªõi c·ªù 's' (dotall)\n    // Gi√∫p t√¨m ch√≠nh x√°c ƒë·ªëi t∆∞·ª£ng JSON ƒë·∫ßu ti√™n v√† ng·∫Øn nh·∫•t,\n    // tr√°nh l·ªói n·∫øu AI tr·∫£ v·ªÅ nhi·ªÅu c·∫∑p d·∫•u {}\n    const jsonMatch = rawOutput.match(/{.*?}/s);\n\n    if (!jsonMatch) {\n      throw new Error(\"Kh√¥ng t√¨m th·∫•y ƒë·ªëi t∆∞·ª£ng JSON trong output c·ªßa AI.\");\n    }\n\n    const jsonString = jsonMatch[0];\n    const parsedData = JSON.parse(jsonString);\n\n    // Logic g√°n gi√° tr·ªã v·∫´n gi·ªØ nguy√™n s·ª± an to√†n nh∆∞ c≈©\n    item.json.mon_hoc = parsedData.mon_hoc ?? null;\n    item.json.ten_bai_hoc = parsedData.ten_bai_hoc ?? null;\n    item.json.loai_noi_dung = parsedData.loai_noi_dung ?? null;\n\n  } catch (error) {\n    // Kh·ªëi catch v·∫´n gi·ªØ nguy√™n ƒë·ªÉ ƒë·∫£m b·∫£o an to√†n\n    console.error(\"L·ªói x·ª≠ l√Ω JSON t·ª´ AI:\", error);\n    item.json.mon_hoc = null;\n    item.json.ten_bai_hoc = null;\n    item.json.loai_noi_dung = null;\n  }\n}\n\n// Tr·∫£ v·ªÅ c√°c item ƒë√£ ƒë∆∞·ª£c x·ª≠ l√Ω\nreturn items;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        544
      ],
      "id": "01038830-71d1-4fdb-ad16-0ef4614b720f",
      "name": "Code3"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1072,
        1168
      ],
      "id": "204a9eb8-0973-4c51-a90f-1c0e00901742",
      "name": "Google Gemini Chat Model5",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y output d·∫°ng vƒÉn b·∫£n th√¥ t·ª´ AI Agent1\nconst aiRawOutput = $('AI Agent1').item.json.output;\n\n// D√πng bi·ªÉu th·ª©c ch√≠nh quy (regex) ƒë·ªÉ tr√≠ch xu·∫•t ph·∫ßn JSON\n// N√≥ s·∫Ω t√¨m chu·ªói n·∫±m gi·ªØa d·∫•u { v√† } ƒë·∫ßu ti√™n v√† cu·ªëi c√πng\nconst jsonMatch = aiRawOutput.match(/{.*}/s);\n\n// Ki·ªÉm tra xem c√≥ t√¨m th·∫•y chu·ªói JSON kh√¥ng\nif (jsonMatch && jsonMatch[0]) {\n  const jsonString = jsonMatch[0];\n  try {\n    // Chuy·ªÉn ƒë·ªïi chu·ªói JSON ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch\n    const jsonObject = JSON.parse(jsonString);\n    \n    // Tr·∫£ v·ªÅ 3 m·ª•c ri√™ng l·∫ª nh∆∞ b·∫°n y√™u c·∫ßu\n    return {\n      mon_hoc: jsonObject.mon_hoc,\n      ten_cau_hoi: jsonObject.ten_cau_hoi,\n      trinh_do: jsonObject.trinh_do\n    };\n  } catch (e) {\n    console.error(\"L·ªói khi chuy·ªÉn ƒë·ªïi JSON:\", jsonString, e);\n    return { error: \"Kh√¥ng th·ªÉ chuy·ªÉn ƒë·ªïi chu·ªói JSON sau khi ƒë√£ l·ªçc.\" };\n  }\n} else {\n  console.error(\"Kh√¥ng t√¨m th·∫•y chu·ªói JSON trong output c·ªßa AI:\", aiRawOutput);\n  return { error: \"Kh√¥ng t√¨m th·∫•y chu·ªói JSON h·ª£p l·ªá trong output c·ªßa AI.\" };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -736,
        1008
      ],
      "id": "9535f922-8ed1-4053-8d5b-54d264dc5174",
      "name": "Code5"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=M·ª•c ti√™u ch√≠nh\nNhi·ªám v·ª• duy nh·∫•t c·ªßa b·∫°n l√† ph√¢n t√≠ch ƒë·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng v√† tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá duy nh·∫•t v·ªõi ba kh√≥a: mon_hoc, ten_cau_hoi, v√† trinh_do. Kh√¥ng th√™m b·∫•t k·ª≥ l·ªùi gi·∫£i th√≠ch hay vƒÉn b·∫£n n√†o b√™n ngo√†i ƒë·ªëi t∆∞·ª£ng JSON.\n\nQuy t·∫Øc Ng√¥n ng·ªØ C·ªët l√µi\nƒê·∫ßu ti√™n, h√£y x√°c ƒë·ªãnh ng√¥n ng·ªØ c·ªßa ƒë·∫ßu v√†o t·ª´ ng∆∞·ªùi d√πng (userInput). C√°c gi√° tr·ªã cu·ªëi c√πng cho c√°c kh√≥a mon_hoc v√† trinh_do trong JSON ƒë·∫ßu ra B·∫ÆT BU·ªòC ph·∫£i c√πng ng√¥n ng·ªØ v·ªõi ƒë·∫ßu v√†o.\n\nQuy t·∫Øc cho t·ª´ng Kh√≥a\n1. mon_hoc (M√¥n h·ªçc)\nNhi·ªám v·ª•: X√°c ƒë·ªãnh m√¥n h·ªçc thu·∫≠t li√™n quan ƒë·∫øn c√¢u h·ªèi. Gi√° tr·ªã ƒë·∫ßu ra ph·∫£i b·∫±ng ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng.\n\nLogic x√°c ƒë·ªãnh:\n\nTr√πng kh·ªõp tr·ª±c ti·∫øp: Ki·ªÉm tra xem truy v·∫•n c√≥ ch·ª©a t√™n m√¥n h·ªçc kh√¥ng (v√≠ d·ª•: \"History\", \"H√≥a h·ªçc\", \"Physique\").\n\nSuy lu·∫≠n t·ª´ kh√≥a: N·∫øu kh√¥ng c√≥ tr√πng kh·ªõp tr·ª±c ti·∫øp, h√£y suy lu·∫≠n t·ª´ c√°c t·ª´ kh√≥a. T√™n m√¥n h·ªçc k·∫øt qu·∫£ ph·∫£i b·∫±ng ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng.\n\nC√°c t·ª´ kh√≥a nh∆∞ \"ph∆∞∆°ng tr√¨nh\", \"ƒë·∫°o h√†m\", \"t√≠ch ph√¢n\" ng·ª• √Ω l√† m√¥n To√°n.\n\nC√°c t·ª´ kh√≥a nh∆∞ \"quang h·ª£p\", \"DNA\", \"di truy·ªÅn\" ng·ª• √Ω l√† m√¥n Sinh h·ªçc.\n\nC√°c t·ª´ kh√≥a nh∆∞ \"ph·∫£n ·ª©ng h√≥a h·ªçc\", \"nguy√™n t·ªë\", \"ph√¢n t·ª≠\" ng·ª• √Ω l√† m√¥n H√≥a h·ªçc.\n\nC√°c t·ª´ kh√≥a nh∆∞ \"tr·ªçng l·ª±c\", \"l·ª±c\", \"nƒÉng l∆∞·ª£ng\" ng·ª• √Ω l√† m√¥n V·∫≠t l√Ω.\n\nM·∫∑c ƒë·ªãnh l√† null: N·∫øu kh√¥ng th·ªÉ x√°c ƒë·ªãnh ƒë∆∞·ª£c m√¥n h·ªçc ho·∫∑c kh√¥ng thu·ªôc danh m·ª•c h·ªçc thu·∫≠t ti√™u chu·∫©n, gi√° tr·ªã B·∫ÆT BU·ªòC ph·∫£i l√† null.\n\n2. ten_cau_hoi (N·ªôi dung c√¢u h·ªèi)\nNhi·ªám v·ª•: Tr√≠ch xu·∫•t n·ªôi dung c·ªët l√µi ho·∫∑c ch·ªß ƒë·ªÅ ch√≠nh c·ªßa c√¢u h·ªèi.\n\nQuy t·∫Øc:\n\nLo·∫°i b·ªè c√°c t·ª´ ƒë·ªám (v√≠ d·ª•: \"l√†m ∆°n gi√∫p t√¥i\", \"what is\", \"h√£y gi·∫£i th√≠ch\").\n\nGi·ªØ l·∫°i vƒÉn b·∫£n g·ªëc cho c√°c b√†i to√°n ho·∫∑c ph∆∞∆°ng tr√¨nh.\n\nGi√° tr·ªã n√†y ƒë∆∞∆°ng nhi√™n s·∫Ω theo ng√¥n ng·ªØ g·ªëc c·ªßa ng∆∞·ªùi d√πng.\n\n3. trinh_do (Tr√¨nh ƒë·ªô h·ªçc v·∫•n)\nNhi·ªám v·ª•: X√°c ƒë·ªãnh tr√¨nh ƒë·ªô h·ªçc v·∫•n ph√π h·ª£p nh·∫•t. Gi√° tr·ªã ƒë·∫ßu ra ph·∫£i b·∫±ng ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng.\n\nC√°c c·∫•p ƒë·ªô c√≥ th·ªÉ: C√°c kh√°i ni·ªám l√† ti·ªÉu h·ªçc, trung h·ªçc c∆° s·ªü, trung h·ªçc ph·ªï th√¥ng, ƒë·∫°i h·ªçc.\n\nLogic suy lu·∫≠n:\n\nT√¨m c√°c t·ª´ kh√≥a ch·ªâ c·∫•p ƒë·ªô r√µ r√†ng trong truy v·∫•n (v√≠ d·ª•: \"l·ªõp 10\", \"cho sinh vi√™n ƒë·∫°i h·ªçc\").\n\nN·∫øu kh√¥ng c√≥, h√£y suy lu·∫≠n m·ªôt c√°ch logic t·ª´ s·ª± ph·ª©c t·∫°p c·ªßa ten_cau_hoi.\n\nS·ªë h·ªçc c∆° b·∫£n -> ti·ªÉu h·ªçc\n\nƒê·∫°i s·ªë, c√¥ng th·ª©c h√≥a h·ªçc c∆° b·∫£n -> trung h·ªçc c∆° s·ªü\n\nGi·∫£i t√≠ch, h√≥a h·ªØu c∆°, ph√¢n t√≠ch vƒÉn h·ªçc c·ªï ƒëi·ªÉn -> trung h·ªçc ph·ªï th√¥ng\n\nC√°c ch·ªß ƒë·ªÅ chuy√™n ng√†nh, l√Ω thuy·∫øt n√¢ng cao -> ƒë·∫°i h·ªçc\n\nV√≠ d·ª•\nƒê·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng: \"gi·∫£i gi√∫p em ph∆∞∆°ng tr√¨nh b·∫≠c 2: x^2 - 3x + 2 = 0 cho h·ªçc sinh c·∫•p 2\"\n\nƒê·∫ßu ra c·ªßa AI: {\"mon_hoc\": \"To√°n\", \"ten_cau_hoi\": \"Gi·∫£i ph∆∞∆°ng tr√¨nh b·∫≠c 2: x^2 - 3x + 2 = 0\", \"trinh_do\": \"trung h·ªçc c∆° s·ªü\"}\n\nƒê·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng: \"What is the process of photosynthesis for a high school biology class?\"\n\nƒê·∫ßu ra c·ªßa AI: {\"mon_hoc\": \"Biology\", \"ten_cau_hoi\": \"the process of photosynthesis\", \"trinh_do\": \"high school\"}\n\nƒê·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng: \"ƒë·ªãnh lu·∫≠t v·∫°n v·∫≠t h·∫•p d·∫´n c·ªßa Newton thu·ªôc m√¥n n√†o\"\n\nƒê·∫ßu ra c·ªßa AI: {\"mon_hoc\": \"V·∫≠t l√Ω\", \"ten_cau_hoi\": \"ƒë·ªãnh lu·∫≠t v·∫°n v·∫≠t h·∫•p d·∫´n c·ªßa Newton\", \"trinh_do\": \"trung h·ªçc ph·ªï th√¥ng\"}\n\nƒê·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng: \"Explain the concept of existentialism\"\n\nƒê·∫ßu ra c·ªßa AI: {\"mon_hoc\": \"Philosophy\", \"ten_cau_hoi\": \"the concept of existentialism\", \"trinh_do\": \"university\"}\n\nƒê·∫ßu v√†o c·ªßa ng∆∞·ªùi d√πng: {{ $('Code4').item.json.messageText }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -1072,
        1008
      ],
      "id": "f84e5fcd-c55a-44a7-9016-03f84bbecebf",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uKis_gmQrlN7pF8VMCFxsRMy5EpDPKW62_LCS0Dc6RU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1376,
        400
      ],
      "id": "6a75d682-436e-467e-a6dd-761819356d9a",
      "name": "Get row(s) in sheet",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "J9jYG0gr48KJcHaM",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=üéì **B√ÄI H·ªåC M·ªöI**\n\n**{{ $json.name }}**\n\nVui l√≤ng xem tr∆∞·ªõc t√†i li·ªáu t·∫°i ƒë√¢y ƒë·ªÉ chu·∫©n b·ªã cho bu·ªïi h·ªçc nh√©:\nüîó {{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2544,
        512
      ],
      "id": "0ce5a9e2-4b17-4d82-8899-01022e5ee4a7",
      "name": "Edit Fields18"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "eeb64f4b-e3a1-4a99-9f62-8ae168514dd2",
              "leftValue": "={{ $json.name }}",
              "rightValue": "=Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2336,
        400
      ],
      "id": "22e8bd6d-4f54-48b9-b4a6-0fd054da3ee2",
      "name": "If17"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c69c4754-4bd6-4d15-9f39-5bf3c0945963",
              "name": "text",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -832,
        2384
      ],
      "id": "46eb17f0-4046-4cca-9f3b-c77d3090b702",
      "name": "Edit Fields7"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=VAI TR√í: AI Tr·ª£ l√Ω H·ªçc t·∫≠p\nB·∫°n l√† m·ªôt AI chuy√™n d·ª•ng, ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·ªÉ t∆∞∆°ng t√°c ban ƒë·∫ßu v·ªõi ng∆∞·ªùi d√πng trong m·ªôt h·ªá th·ªëng gia s∆∞ ·∫£o. Nhi·ªám-v·ª•-c·ªßa-b·∫°n-l√† ch√†o h·ªèi th√¢n thi·ªán v√† t·ª´ ch·ªëi m·ªôt c√°ch l·ªãch s·ª± b·∫•t k·ª≥ ch·ªß ƒë·ªÅ n√†o kh√¥ng li√™n quan ƒë·∫øn vi·ªác h·ªçc. B·∫°n kh√¥ng tr·∫£ l·ªùi c√°c c√¢u h·ªèi h·ªçc thu·∫≠t.\n\n[CH·ªà TH·ªä CH√çNH] B·∫§T BI·∫æN V·ªÄ NG√îN NG·ªÆ\nB·∫†N PH·∫¢I ph√°t hi·ªán ng√¥n ng·ªØ c·ªßa ng∆∞·ªùi d√πng (v√≠ d·ª•: ti·∫øng Vi·ªát, ti·∫øng Anh, ti·∫øng trung, ti·∫øng th√°i,...) v√† TO√ÄN B·ªò ph·∫£n h·ªìi c·ªßa b·∫°n B·∫ÆT BU·ªòC ph·∫£i b·∫±ng ch√≠nh x√°c ng√¥n ng·ªØ ƒë√≥.\n\n[QUY T·∫ÆC X·ª¨ L√ù] - TH·ª∞C HI·ªÜN THEO ƒê√öNG TH·ª® T·ª∞ ∆ØU TI√äN SAU\n1. PH√ÅT HI·ªÜN V√Ä PH·∫¢N H·ªíI L·ªúI CH√ÄO\nƒêI·ªÄU KI·ªÜN: N·∫øu tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng ch·ªß y·∫øu l√† m·ªôt l·ªùi ch√†o ƒë∆°n gi·∫£n (v√≠ d·ª•: \"hello\", \"hi\", \"ch√†o b·∫°n\", \"b·∫°n c√≥ ƒë√≥ kh√¥ng?\") v√† kh√¥ng ch·ª©a y√™u-c·∫ßu-h·ªçc-t·∫≠p c·ª• th·ªÉ.\n\nH√ÄNH ƒê·ªòNG: Ph·∫£n h·ªìi b·∫±ng m·ªôt l·ªùi ch√†o ng·∫Øn g·ªçn, th√¢n thi·ªán v√† ngay l·∫≠p t·ª©c h∆∞·ªõng ng∆∞·ªùi d√πng v√†o b·ªëi c·∫£nh h·ªçc t·∫≠p.\n\nV√≠ d·ª• (ti·∫øng Vi·ªát): \"Ch√†o b·∫°n! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho vi·ªác h·ªçc c·ªßa b·∫°n h√¥m nay?\"\n\nV√≠ d·ª• (ti·∫øng Anh): \"Hello! How can I help you with your studies today?\"\n\n2. T·ª™ CH·ªêI Y√äU C·∫¶U KH√îNG LI√äN QUAN (M·∫∂C ƒê·ªäNH)\nƒêI·ªÄU KI·ªÜN: N·∫øu tin nh·∫Øn kh√¥ng ƒë√°p ·ª©ng ti√™u ch√≠ c·ªßa Quy t·∫Øc #1. ƒêi·ªÅu n√†y bao g·ªìm t·∫•t c·∫£ c√°c c√¢u h·ªèi, d√π l√† v·ªÅ h·ªçc t·∫≠p hay l·∫°c ƒë·ªÅ.\n\nH√ÄNH ƒê·ªòNG: T·ª´ ch·ªëi m·ªôt c√°ch l·ªãch s·ª± v√† n√™u r√µ ch·ª©c nƒÉng c·ª• th·ªÉ c·ªßa b·∫°n l√† m·ªôt tr·ª£ l√Ω h·ªçc t·∫≠p.\n\nV√≠ d·ª• (ti·∫øng Vi·ªát): \"Xin l·ªói, t√¥i l√† m·ªôt tr·ª£ l√Ω h·ªçc t·∫≠p v√† ch·ªâ c√≥ th·ªÉ h·ªó tr·ª£ c√°c ch·ªß ƒë·ªÅ li√™n quan ƒë·∫øn vi·ªác h·ªçc. B·∫°n c√≥ c√¢u h·ªèi n√†o v·ªÅ b√†i v·ªü kh√¥ng?\"\n\nV√≠ d·ª• (ti·∫øng Anh): \"I apologize, I am a learning assistant and can only support topics related to academics. Do you have a question about your studies?\"\n\nTIN NH·∫ÆN C·ª¶A NG∆Ø·ªúI D√ôNG C·∫¶N PH√ÇN T√çCH:\n{{ $('Code4').item.json.messageText }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -1168,
        2384
      ],
      "id": "ffe8b946-f01a-4502-9a54-c0ff66ccda62",
      "name": "AI Agent3"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1168,
        2528
      ],
      "id": "5ad12ac1-30d4-43f9-bab5-1f6ca69403c5",
      "name": "Google Gemini Chat Model7",
      "credentials": {
        "googlePalmApi": {
          "id": "2L5SggYtM77iWle3",
          "name": "h·ªèi ƒë√°p 2"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "734b606e-51ee-43f1-baff-a34942a39356",
              "leftValue": "={{ $('Search files and folders13').item.json.id }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -4912,
        1536
      ],
      "id": "f7c21298-08b7-436f-822f-7453c5b8f751",
      "name": "If9",
      "retryOnFail": false,
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "resource": "spreadsheet",
        "title": "[AI_TUTOR_MEMORY_SHEET]",
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -4688,
        1424
      ],
      "id": "8a07e40b-4986-4c19-a9ad-d72095931258",
      "name": "Create_Sheet_in_Root",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Kc5JFDPfTGzxNbNi",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "operation": "move",
        "fileId": {
          "__rl": true,
          "value": "={{ $('Create_Sheet_in_Root').item.json.spreadsheetId }}",
          "mode": "id"
        },
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
          "mode": "id"
        }
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -4080,
        1424
      ],
      "id": "1493a767-4794-4771-ae11-71426dd52733",
      "name": "Move file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.AI_TUTOR_MEMORY_SHEET }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1yccdT8VL7p19SvQKn-bSqKL4LSnNN2lN3DfBqm1Fx2g/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "chatId",
              "lookupValue": "={{ $('Code4').item.json.chatId }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -3616,
        1552
      ],
      "id": "ad0ae77e-3ad3-41fc-bb58-f75af66ad86b",
      "name": "Search_User_Context",
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Kc5JFDPfTGzxNbNi",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b8e0b0be-084b-4445-bdef-1f2bb7b88e6a",
              "leftValue": "={{ $('Search_User_Context').item.json.chatId }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notEmpty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -3376,
        1552
      ],
      "id": "319a4fe8-cc42-4538-af1d-e48122e04410",
      "name": "IF_Context_Found"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -2560,
        1712
      ],
      "id": "e10cac8e-1026-49cc-a3e0-40be758f26e0",
      "name": "Google Gemini Chat Model10",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·ªêI C·∫¢NH\nB·∫°n l√† m·ªôt b·ªô m√°y ph√¢n lo·∫°i √Ω ƒë·ªãnh c·ª±c k·ª≥ ch√≠nh x√°c cho m·ªôt Tr·ª£ l√Ω H·ªçc t·∫≠p Th√¥ng minh. Nhi·ªám v·ª• c·ªßa b·∫°n l√† ƒë·ªçc y√™u c·∫ßu c·ªßa ng∆∞·ªùi d√πng v√† tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng JSON ch·ª©a danh m·ª•c ch·ª©c nƒÉng ph√π h·ª£p nh·∫•t.\n\nH∆Ø·ªöNG D·∫™N\nPh√¢n t√≠ch k·ªπ Y√äU C·∫¶U C·ª¶A NG∆Ø·ªúI D√ôNG.\n\nS·ª≠ d·ª•ng QUY T·∫ÆC PH√ÇN BI·ªÜT ƒë·ªÉ x·ª≠ l√Ω c√°c tr∆∞·ªùng h·ª£p kh√¥ng r√µ r√†ng.\n\nCh·ªçn m·ªôt danh m·ª•c ph√π h·ª£p nh·∫•t t·ª´ DANH M·ª§C CHO PH√âP.\n\nTr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá.\n\nDANH M·ª§C CHO PH√âP\ntim_kiem_tai_lieu: H√†nh ƒë·ªông l√† t√¨m ki·∫øm, ƒë·ªãnh v·ªã, v√† cung c·∫•p m·ªôt t√†i nguy√™n c·ª• th·ªÉ (file, link, s√°ch, video...). Th∆∞·ªùng ch·ª©a c√°c t·ª´ kh√≥a nh∆∞ \"t√¨m\", \"cho xin\", \"link\", \"file\", \"t√†i li·ªáu c·ªßa b√†i...\", \"download\".\n\nhoi_dap_hoc_tap: Ng∆∞·ªùi d√πng h·ªèi m·ªôt c√¢u h·ªèi ki·∫øn th·ª©c c·ª• th·ªÉ, c√≥ ph·∫°m vi h·∫πp c·∫ßn gi·∫£i ƒë√°p ngay.\n\ntim_hieu_bai_moi: H√†nh ƒë·ªông l√† gi·∫£ng gi·∫£i, tr√¨nh b√†y, gi·ªõi thi·ªáu m·ªôt ch·ªß ƒë·ªÅ/b√†i h·ªçc m·ªõi. AI ƒë√≥ng vai tr√≤ nh∆∞ m·ªôt ng∆∞·ªùi th·∫ßy. Th∆∞·ªùng ch·ª©a c√°c t·ª´ kh√≥a nh∆∞ \"gi·∫£ng cho m√¨nh\", \"d·∫°y m√¨nh v·ªÅ\", \"b√†i... n√≥i v·ªÅ g√¨?\", \"gi·ªõi thi·ªáu ch·ªß ƒë·ªÅ...\".\n\non_tap_thi_cu: C·ªßng c·ªë, t√≥m t·∫Øt l·∫°i ki·∫øn th·ª©c ƒë√£ h·ªçc ƒë·ªÉ chu·∫©n b·ªã cho b√†i ki·ªÉm tra.\n\nhoc_nang_cao: T√¨m hi·ªÉu s√¢u h∆°n, m·ªü r·ªông h∆°n v·ªÅ m·ªôt ch·ªß ƒë·ªÅ ƒë√£ bi·∫øt c∆° b·∫£n.\n\nho_tro_tinh_than: Ng∆∞·ªùi d√πng th·ªÉ hi·ªán s·ª± bu·ªìn b√£, cƒÉng th·∫≥ng, ti√™u c·ª±c ho·∫∑c c·∫ßn l·ªùi khuy√™n t√¢m l√Ω.\n\nchao_hoi: L·ªùi ch√†o ho·∫∑c c√°c t∆∞∆°ng t√°c x√£ giao th√¥ng th∆∞·ªùng.\n\nkhong_xac_dinh: Y√™u c·∫ßu kh√¥ng thu·ªôc b·∫•t k·ª≥ danh m·ª•c n√†o ·ªü tr√™n.\n\nQUY T·∫ÆC PH√ÇN BI·ªÜT (Quan tr·ªçng)\ntim_kiem_tai_lieu vs tim_hieu_bai_moi:\n\nTr·ªçng t√¢m l√† h√†nh ƒë·ªông. N·∫øu ng∆∞·ªùi d√πng mu·ªën NH·∫¨N m·ªôt th·ª© g√¨ ƒë√≥ (file, link, t√†i li·ªáu c√≥ s·∫µn), ch·ªçn tim_kiem_tai_lieu.\n\nN·∫øu ng∆∞·ªùi d√πng mu·ªën NGHE GI·∫¢NG ho·∫∑c ƒê∆Ø·ª¢C GI·∫¢I TH√çCH ƒë·ªÉ hi·ªÉu m·ªôt v·∫•n ƒë·ªÅ, ch·ªçn tim_hieu_bai_moi.\n\nQUY T·∫ÆC ∆ØU TI√äN\nN·∫øu y√™u c·∫ßu th·ªÉ hi·ªán s·ª± ƒëau kh·ªï, bu·ªìn b√£, √°p l·ª±c, c√≥ √Ω ƒë·ªãnh t·ª± h·∫°i, h√£y lu√¥n ∆∞u ti√™n ph√¢n lo·∫°i v√†o ho_tro_tinh_than.\n\nƒê·ªäNH D·∫†NG ƒê·∫¶U RA\nCh·ªâ tr·∫£ v·ªÅ DUY NH·∫§T m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá.\n\nC·∫•u tr√∫c: { \"intent\": \"ten_danh_muc\" }\n\nV√ç D·ª§\nY√™u c·∫ßu: \"Gi·∫£i th√≠ch cho m√¨nh v·ªÅ hi·ªáu ·ª©ng quang ƒëi·ªán.\"\nK·∫øt qu·∫£: { \"intent\": \"hoi_dap_hoc_tap\" }\n\nY√™u c·∫ßu: \"M√¨nh s·∫Øp thi cu·ªëi k·ª≥ r·ªìi, t√≥m t·∫Øt l·∫°i nh·ªØng √Ω ch√≠nh c·ªßa m√¥n L·ªãch s·ª≠ gi√∫p m√¨nh v·ªõi.\"\nK·∫øt qu·∫£: { \"intent\": \"on_tap_thi_cu\" }\n\nY√™u c·∫ßu: \"Gi·∫£ng tr∆∞·ªõc cho m√¨nh b√†i 'S√≥ng ƒëi·ªán t·ª´' nh√©.\"\nK·∫øt qu·∫£: { \"intent\": \"tim_hieu_bai_moi\" }\n\nY√™u c·∫ßu: \"Cho m√¨nh xin file PDF s√°ch gi√°o khoa V·∫≠t l√Ω 12.\"\nK·∫øt qu·∫£: { \"intent\": \"tim_kiem_tai_lieu\" }\n\nY√™u c·∫ßu (Tr∆∞·ªùng h·ª£p c·ªßa anh): \"t√¥i mu·ªën t√¨m b√†i h·ªçc m√¥n to√°n b√†i S·ªë Th·∫≠p Ph√¢n\"\nK·∫øt qu·∫£: { \"intent\": \"tim_kiem_tai_lieu\" } (V√¨ h√†nh ƒë·ªông ch√≠nh l√† \"t√¨m\")\n\nY√™u c·∫ßu: \"D·∫°o n√†y m√¨nh √°p l·ª±c thi c·ª≠ qu√°, c·∫£m th·∫•y ch√°n n·∫£n.\"\nK·∫øt qu·∫£: { \"intent\": \"ho_tro_tinh_than\" }\n\nY√™u c·∫ßu: \"Gi√° xƒÉng h√¥m nay bao nhi√™u?\"\nK·∫øt qu·∫£: { \"intent\": \"khong_xac_dinh\" }\n\nTH·ª∞C THI\nY√äU C·∫¶U C·ª¶A NG∆Ø·ªúI D√ôNG: {{ $('Code4').item.json.messageText }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -2576,
        1568
      ],
      "id": "d6e27ecc-a6fa-40bc-9f96-76bb0e03592f",
      "name": "Classify_Intent"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c094be32-f02a-4d62-9b2e-663651ffa350",
              "name": "FOLDER_H·ªçc _sinh",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "75e819cf-0ab4-4bd3-b005-26926fb72196",
              "name": "FOLDER_L·ªõp",
              "value": "={{ $('Search files and folders12').item.json.id }}",
              "type": "string"
            },
            {
              "id": "47294785-5fdb-4d93-9777-1607a58853f3",
              "name": "FOLDER_Kh·ªëi",
              "value": "={{ $('Search files and folders11').item.json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -5296,
        1536
      ],
      "id": "2357067f-aef1-4b46-a2ab-9f2ed0279055",
      "name": "Check_If_File_Exists"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Edit Fields3').item.json.AI_TUTOR_MEMORY_SHEET }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NXyDuCHobfeDjmFCwL5OKzUDMTYe2M6VuAcFzbxlhf4/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "chatId": "={{ $('Code4').item.json.chatId }}",
            "currentIntent": "={{ $json.intent }}",
            "lastActiveTimestamp": "={{ $now }}"
          },
          "matchingColumns": [
            "chatId"
          ],
          "schema": [
            {
              "id": "chatId",
              "displayName": "chatId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "currentIntent",
              "displayName": "currentIntent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "lastActiveTimestamp",
              "displayName": "lastActiveTimestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "contextData",
              "displayName": "contextData",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -2016,
        1568
      ],
      "id": "3dcfdb75-e87e-4770-8980-571f1330f400",
      "name": "Save_User_Context",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "J9jYG0gr48KJcHaM",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4fead9a8-dd9b-4a90-a22a-595daf4f41b7",
              "name": "intent",
              "value": "={{ $('Search_User_Context').item.json.currentIntent }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2128,
        1360
      ],
      "id": "1dcc3192-ce3f-4b42-a74d-5d633522a341",
      "name": "Get_Saved_Intent"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "615481bc-1b1c-48c9-b136-c7533a6e5505",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "tim_kiem_tai_lieu",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1109f210-2f27-4cdb-b5cc-33cd24906ad8",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "hoi_dap_hoc_tap",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "on_tap_thi_cu",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8aa08d3e-16c6-404f-a0a3-659769f196b9"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "056fcbd8-a2fe-4424-bc1a-7a8bdaaeab22",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "tim_hieu_bai_moi",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "93096552-2c0e-499a-bb95-eba38a027bd0",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "ho_tro_tinh_than",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "9ea3a08d-a48c-46cc-8831-aa75bae976f0",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "=chao_hoi",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "09c91d89-9437-41a5-ad11-eb1251956a50",
                    "leftValue": "={{ ($json.currentIntent || $json.intent).trim() }}",
                    "rightValue": "khong_xac_dinh",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -1744,
        1376
      ],
      "id": "2bb57f0d-1c75-4347-9d13-e3a1fc96dd6d",
      "name": "Switch"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -3120,
        1488
      ],
      "id": "276ee540-76cb-4675-873c-bcdfb97779bc",
      "name": "Google Gemini Chat Model11",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=VAI TR√í\nB·∫°n l√† m·ªôt AI chuy√™n ph√¢n t√≠ch s·ª± li·ªÅn m·∫°ch c·ªßa h·ªôi tho·∫°i. Nhi·ªám v·ª• c·ªßa b·∫°n l√† x√°c ƒë·ªãnh xem m·ªôt tin nh·∫Øn m·ªõi c√≥ ph·∫£i l√† m·ªôt c√¢u h·ªèi n·ªëi ti·∫øp, l√†m r√µ cho ch·ªß ƒë·ªÅ ƒëang dang d·ªü, hay l√† m·ªôt y√™u c·∫ßu m·ªõi ƒë·ªôc l·∫≠p.\n\nB·ªêI C·∫¢NH ƒê·∫¶U V√ÄO\n\n- CH·ª¶ ƒê·ªÄ C≈®: '{{ $('Search_User_Context').item.json.currentIntent }}'\n\n- TIN NH·∫ÆN M·ªöI: \"{{ $('Code4').item.json.messageText }}\"\n\nTIN NH·∫ÆN M·ªöI: N·ªôi dung tin nh·∫Øn m·ªõi c·ªßa ng∆∞·ªùi d√πng.\n\nNG·ªÆ C·∫¢NH H·ªòI THO·∫†I (T√πy ch·ªçn): N·ªôi dung c·ªßa v√†i tin nh·∫Øn g·∫ßn nh·∫•t ƒë·ªÉ x√°c ƒë·ªãnh s·ª± li√™n k·∫øt.\n\nNHI·ªÜM V·ª§\nD·ª±a v√†o c√°c th√¥ng tin ƒë·∫ßu v√†o, ph√¢n t√≠ch TIN NH·∫ÆN M·ªöI v√† quy·∫øt ƒë·ªãnh xem n√≥ c√≥ ph·∫£i l√† m·ªôt y√™u c·∫ßu n·ªëi ti·∫øp tr·ª±c ti·∫øp hay kh√¥ng.\n\nTI√äU CH√ç PH√ÇN T√çCH\nTr·∫£ v·ªÅ true (N·ªëi ti·∫øp) N·∫æU TIN NH·∫ÆN M·ªöI:\n\nL√† c√¢u h·ªèi ƒë√†o s√¢u, l√†m r√µ, y√™u c·∫ßu v√≠ d·ª•, ho·∫∑c m·ªôt b√¨nh lu·∫≠n tr·ª±c ti·∫øp v·ªÅ k·∫øt qu·∫£/th√¥ng tin c·ªßa CH·ª¶ ƒê·ªÄ C≈®.\n\nTh∆∞·ªùng ch·ª©a c√°c t·ª´ ng·ªØ k·∫ø th·ª´a ng·ªØ c·∫£nh nh∆∞: \"v·∫≠y th√¨\", \"th·∫ø c√≤n\", \"gi·∫£i th√≠ch th√™m v·ªÅ n√≥\", \"cho m·ªôt v√≠ d·ª• ƒëi\", \"c·ª• th·ªÉ h∆°n l√† sao?\", ho·∫∑c c√°c ƒë·∫°i t·ª´ √°m ch·ªâ (\"n√≥\", \"c√°i ƒë√≥\",...).\n\nTr·∫£ v·ªÅ false (Y√™u c·∫ßu m·ªõi) N·∫æU TIN NH·∫ÆN M·ªöI:\n\nQuan tr·ªçng: L√† m·ªôt y√™u c·∫ßu m·ªõi, d√π c√≥ c√πng lo·∫°i (intent) v·ªõi CH·ª¶ ƒê·ªÄ C≈®, nh∆∞ng ƒë·ªÅ c·∫≠p ƒë·∫øn m·ªôt ƒë·ªëi t∆∞·ª£ng ho·∫∑c ch·ªß ƒë·ªÅ h·ªçc thu·∫≠t ho√†n to√†n m·ªõi.\n\nChuy·ªÉn sang m·ªôt lo·∫°i y√™u c·∫ßu h·ªçc t·∫≠p kh√°c (v√≠ d·ª•: ƒëang h·ªèi ƒë√°p ki·∫øn th·ª©c l·∫°i chuy·ªÉn sang t√¨m t√†i li·ªáu).\n\nL√† m·ªôt ch·ªß ƒë·ªÅ ho√†n to√†n kh√¥ng li√™n quan, kh√¥ng th·ªÉ suy ra s·ª± k·∫øt n·ªëi.\n\nDANH S√ÅCH C√ÅC LO·∫†I Y√äU C·∫¶U (ƒê√£ c·∫≠p nh·∫≠t)\ntim_kiem_tai_lieu: Y√™u c·∫ßu t√¨m file, t√†i li·ªáu, link b√†i t·∫≠p.\n\nhoi_dap_hoc_tap: H·ªèi m·ªôt c√¢u h·ªèi ki·∫øn th·ª©c c·ª• th·ªÉ c·∫ßn gi·∫£i ƒë√°p.\n\ntim_hieu_bai_moi: Y√™u c·∫ßu t√¨m hi·ªÉu v·ªÅ m·ªôt b√†i h·ªçc/ch·ªß ƒë·ªÅ m·ªõi.\n\non_tap_thi_cu: Y√™u c·∫ßu √¥n t·∫≠p, t√≥m t·∫Øt ki·∫øn th·ª©c c≈©.\n\nho_tro_tinh_than: Tin nh·∫Øn t√¢m s·ª±, c·∫ßn h·ªó tr·ª£ v·ªÅ m·∫∑t tinh th·∫ßn.\n\nchao_hoi: L·ªùi ch√†o x√£ giao, b·∫Øt ƒë·∫ßu ho·∫∑c k·∫øt th√∫c cu·ªôc tr√≤ chuy·ªán.\n\nV√ç D·ª§ MINH H·ªåA\nV√≠ d·ª• 1: N·ªëi ti·∫øp (true)\nCH·ª¶ ƒê·ªÄ C≈®: hoi_dap_hoc_tap (v·ªÅ \"ƒê·ªãnh lu·∫≠t Ohm\")\n\nTIN NH·∫ÆN M·ªöI: \"B·∫°n c√≥ th·ªÉ cho m√¨nh m·ªôt v√≠ d·ª• v·ªÅ ƒë·ªãnh lu·∫≠t ƒë√≥ kh√¥ng?\"\n\nK·∫æT QU·∫¢: true (V√¨ \"ƒë·ªãnh lu·∫≠t ƒë√≥\" √°m ch·ªâ tr·ª±c ti·∫øp ch·ªß ƒë·ªÅ c≈©).\n\nV√≠ d·ª• 2: Y√™u c·∫ßu m·ªõi - ƒê·ªïi lo·∫°i y√™u c·∫ßu (false)\nCH·ª¶ ƒê·ªÄ C≈®: hoi_dap_hoc_tap (v·ªÅ \"ƒê·ªãnh lu·∫≠t Ohm\")\n\nTIN NH·∫ÆN M·ªöI: \"T√¨m gi√∫p m√¨nh link b√†i t·∫≠p v·ªÅ ƒë·ªãnh lu·∫≠t Ohm.\"\n\nK·∫æT QU·∫¢: false (V√¨ chuy·ªÉn t·ª´ hoi_dap_hoc_tap sang tim_kiem_tai_lieu).\n\nV√≠ d·ª• 3: Y√™u c·∫ßu m·ªõi - C√πng lo·∫°i nh∆∞ng kh√°c ch·ªß ƒë·ªÅ (false)\nCH·ª¶ ƒê·ªÄ C≈®: tim_kiem_tai_lieu (v·ªÅ \"L·ªãch s·ª≠ Vi·ªát Nam\")\n\nTIN NH·∫ÆN M·ªöI: \"T√¨m cho m√¨nh t√†i li·ªáu m√¥n To√°n.\"\n\nK·∫æT QU·∫¢: false (V√¨ m·∫∑c d√π c√πng l√† tim_kiem_tai_lieu, nh∆∞ng ƒë√£ chuy·ªÉn sang ch·ªß ƒë·ªÅ h·ªçc thu·∫≠t m·ªõi l√† \"To√°n\").\n\nV√≠ d·ª• 4: Y√™u c·∫ßu m·ªõi - Tr∆∞·ªùng h·ª£p c·ªßa anh (false)\nCH·ª¶ ƒê·ªÄ C≈®: tim_hieu_bai_moi (v·ªÅ b√†i \"T·∫ø b√†o nh√¢n th·ª±c\")\n\nTIN NH·∫ÆN M·ªöI: \"t√¥i mu·ªën t√¨m b√†i h·ªçc m√¥n to√°n b√†i S·ªë Th·∫≠p Ph√¢n\"\n\nK·∫æT QU·∫¢: false (V√¨ ƒë√¢y l√† m·ªôt y√™u c·∫ßu t√¨m b√†i h·ªçc m·ªõi, v·ªÅ m·ªôt ch·ªß ƒë·ªÅ ho√†n to√†n m·ªõi l√† \"S·ªë Th·∫≠p Ph√¢n\").\n\nV√≠ d·ª• 5: Ch√†o h·ªèi n·ªëi ti·∫øp (true)\nCH·ª¶ ƒê·ªÄ C≈®: chao_hoi\n\nTIN NH·∫ÆN M·ªöI: \"hello\"\n\nK·∫æT QU·∫¢: true\n\nƒê·ªäNH D·∫†NG ƒê·∫¶U RA\nCh·ªâ tr·∫£ v·ªÅ DUY NH·∫§T m·ªôt t·ª´: true ho·∫∑c false. Kh√¥ng th√™m b·∫•t k·ª≥ gi·∫£i th√≠ch n√†o.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -3120,
        1376
      ],
      "id": "83fe9523-0996-4cf5-a7df-61273299b2f7",
      "name": "Check_Follow_Up"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "a506ec28-3dd0-4efd-ba2a-935375fc279e",
              "leftValue": "={{ $('Check_Follow_Up').item.json.output }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2800,
        1376
      ],
      "id": "429d0faf-db2c-4f76-801f-41821c219b2a",
      "name": "IF_Is_Follow_Up"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c21c6390-7395-4e11-9270-542a1f7ecd66",
              "name": "chatId",
              "value": "",
              "type": "string"
            },
            {
              "id": "b849b14d-0a6b-4f89-8448-392d05304e04",
              "name": "currentIntent",
              "value": "",
              "type": "string"
            },
            {
              "id": "31de70e0-4dda-4f6d-b7ce-718a7712be2f",
              "name": "lastActiveTimestamp",
              "value": "",
              "type": "string"
            },
            {
              "id": "aadf369e-30ff-4f09-8e00-2d50700dc8a4",
              "name": "contextData",
              "value": "",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -4496,
        1424
      ],
      "id": "d0a44cad-859a-4c09-8417-8e58376c46ad",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "={{ $('Create_Sheet_in_Root').item.json.spreadsheetId }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1EJL0I1_zjPDKdWyBcWEjEdcFWgdPBgLrNxwXGpKVyb4/edit#gid=0"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": [
            {
              "id": "chatId",
              "displayName": "chatId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "currentIntent",
              "displayName": "currentIntent",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "lastActiveTimestamp",
              "displayName": "lastActiveTimestamp",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "contextData",
              "displayName": "contextData",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -4304,
        1424
      ],
      "id": "0fef1a74-f696-45f0-906b-2dbd38d77bd7",
      "name": "Append or update row in sheet",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Kc5JFDPfTGzxNbNi",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=### B·ªêI C·∫¢NH\nB·∫°n l√† m·ªôt tr·ª£ l√Ω AI ƒë·ªìng c·∫£m v√† c√≥ tr√°ch nhi·ªám. Ng∆∞·ªùi d√πng v·ª´a b√†y t·ªè m·ªôt suy nghƒ© ho·∫∑c c·∫£m x√∫c ti√™u c·ª±c, nh·∫°y c·∫£m. Nhi·ªám v·ª• c·ªßa b·∫°n KH√îNG ph·∫£i l√† gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ c·ªßa h·ªç, m√† l√† ƒë∆∞a ra m·ªôt l·ªùi an ·ªßi ch√¢n th√†nh, x√°c nh·∫≠n c·∫£m x√∫c c·ªßa h·ªç, v√† nh·∫π nh√†ng g·ª£i √Ω c√°c ngu·ªìn tr·ª£ gi√∫p chuy√™n nghi·ªáp.\n\n### QUY T·∫ÆC\n- KH√îNG ƒë∆∞a ra l·ªùi khuy√™n y t·∫ø ho·∫∑c t√¢m l√Ω.\n- KH√îNG ph√°n x√©t.\n- Lu√¥n gi·ªØ m·ªôt gi·ªçng vƒÉn ·∫•m √°p, quan t√¢m v√† h·ªó tr·ª£.\n- Lu√¥n g·ª£i √Ω vi·ªác t√¨m ƒë·∫øn s·ª± gi√∫p ƒë·ª° chuy√™n nghi·ªáp.\n\n### Y√äU C·∫¶U C·ª¶A NG∆Ø·ªúI D√ôNG\n\"{{ $('Code4').item.json.messageText }}\"\n\n### H√ÄNH ƒê·ªòNG\nH√£y vi·∫øt m·ªôt ƒëo·∫°n ph·∫£n h·ªìi ng·∫Øn g·ªçn, an ·ªßi d·ª±a tr√™n c√°c quy t·∫Øc tr√™n.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        -1168,
        2144
      ],
      "id": "e1de1860-a8e8-41be-8b35-789df686cbc7",
      "name": "sensitive_topic"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1168,
        2272
      ],
      "id": "87d79ae9-d894-42da-a8d0-c422d11e9c77",
      "name": "Google Gemini Chat Model12",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "7ee4cdf4-4def-4bcd-ae83-6593719a3e31",
              "name": "text",
              "value": "={{ $json.output }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -832,
        2144
      ],
      "id": "4c406776-7c6e-4a23-a22a-98190a7e8706",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "content": "Ho√†n th√†nh"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1952,
        944
      ],
      "id": "db08214f-67be-4e7b-8e70-f5bab8ffe5c7",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Admin_Registry",
        "filter": {
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -7568,
        1536
      ],
      "id": "ff9f05d5-ad7b-42b7-9121-7828420db429",
      "name": "Search files and folders7",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y d·ªØ li·ªáu ƒë·∫ßu v√†o t·ª´ node Webhook\nconst webhookData = $input.item.json;\n\n// Truy c·∫≠p v√†o c√°c ƒë·ªëi t∆∞·ª£ng c·∫ßn thi·∫øt\nconst message = webhookData.body.message;\nconst sender = message.sender;\nconst space = webhookData.body.space; // Truy c·∫≠p v√†o ƒë·ªëi t∆∞·ª£ng \"space\"\n\n// T·∫°o m·ªôt ƒë·ªëi t∆∞·ª£ng m·ªõi (newObject) ƒë·ªÉ ch·ª©a th√¥ng tin ƒë√£ ƒë∆∞·ª£c tr√≠ch xu·∫•t\nconst studentInfo = {};\n\n// --- Th√¥ng tin ng∆∞·ªùi g·ª≠i ---\n// 'name' l√† m√£ ƒë·ªãnh danh duy nh·∫•t c·ªßa ng∆∞·ªùi d√πng\nstudentInfo.userId = sender.name; // V√≠ d·ª•: \"users/102475205689648174725\"\n\n// 'email' l√† ƒë·ªãa ch·ªâ gmail c·ªßa ng∆∞·ªùi d√πng\nstudentInfo.email = sender.email; // V√≠ d·ª•: \"duong.na.2719@aptechlearning.edu.vn\"\n\n// 'displayName' l√† t√™n hi·ªÉn th·ªã c·ªßa h·ªç\nstudentInfo.userName = sender.displayName; // V√≠ d·ª•: \"Duong Nguyen Anh\"\n\n\n// --- Th√¥ng tin tin nh·∫Øn & cu·ªôc tr√≤ chuy·ªán ---\n// L·∫•y ID c·ªßa cu·ªôc tr√≤ chuy·ªán (Chat ID)\nstudentInfo.chatId = space.name; // V√≠ d·ª•: \"spaces/AAQARKF95Zo\"\n\n// L·∫•y ID c·ªßa tin nh·∫Øn duy nh·∫•t (Message ID)\nstudentInfo.messageId = message.name; // V√≠ d·ª•: \"spaces/AAQARKF95Zo/messages/...\"\n\n// L·∫§Y N·ªòI DUNG TIN NH·∫ÆN (D√íNG M·ªöI TH√äM V√ÄO)\nstudentInfo.messageText = message.argumentText.trim();\n\n\n// Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng m·ªõi n√†y. \n// C√°c node sau s·∫Ω l√†m vi·ªác v·ªõi d·ªØ li·ªáu ƒë∆°n gi·∫£n n√†y thay v√¨ JSON g·ªëc.\nreturn [\n  {\n    json: studentInfo\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -7792,
        1536
      ],
      "id": "db6d10bb-2f9a-4a58-97b5-623e9a5549e3",
      "name": "Code4"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "FOLDER_Students",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Search files and folders7').item.json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -6976,
        1536
      ],
      "id": "8df7fecb-b40e-4575-bbb6-bb7c49d9e562",
      "name": "Search files and folders8",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ (()=> {   const now = DateTime.now();   const startYear = now.month >= 8 ? now.year : now.year - 1;   const endYear = startYear + 1;   return startYear + \" - \" + endYear; })() }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -6768,
        1536
      ],
      "id": "85aeee85-7321-431f-af8e-74f8afd51bd3",
      "name": "Search files and folders9",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=Danh s√°ch h·ªçc sinh {{ (()=> {   const now = DateTime.now();   const startYear = now.month >= 8 ? now.year : now.year - 1;   const endYear = startYear + 1;   return startYear + \" - \" + endYear; })() }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -6544,
        1536
      ],
      "id": "fa360a05-62c1-4fca-b78e-ff2f29ef1828",
      "name": "Search files and folders10",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1slBtynt_za60iTw0HK6RUbsr_w9jzjR2wtJd4Hw-77I/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Email",
              "lookupValue": "={{ $('Code4').item.json.email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -6336,
        1536
      ],
      "id": "ef80060e-3a07-45eb-a305-25078e719074",
      "name": "Get row(s) in sheet1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "Kc5JFDPfTGzxNbNi",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Get row(s) in sheet1').item.json.StudentID }} - {{ $('Get row(s) in sheet1').item.json['H·ªç v√† T√™n'] }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5504,
        1536
      ],
      "id": "2a6de140-3324-4cc9-ad1f-36ec03b352a1",
      "name": "Search files and folders6",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $json.folderName }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Search files and folders9').item.json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5920,
        1536
      ],
      "id": "a587969c-98ae-4cd1-82a5-82e4d67c994b",
      "name": "Search files and folders11",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const classString = $input.first().json['L·ªõp h·ªçc'];\nif (!classString) {\n  return [];\n}\n\nconst classes = classString.split(',').map(c => c.trim());\nconst gradeNumbers = classes.map(c => (c.match(/^\\d+/) || [])[0]).filter(Boolean);\nconst uniqueGradeNumbers = [...new Set(gradeNumbers)];\n\n// Tr·∫£ v·ªÅ m·ªôt m·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng, m·ªói ƒë·ªëi t∆∞·ª£ng c√≥ m·ªôt t√™n th∆∞ m·ª•c\nconst folderItems = uniqueGradeNumbers.map(grade => ({\n  json: {\n    folderName: `Kh·ªëi ${grade}`\n  }\n}));\n\nreturn folderItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -6128,
        1536
      ],
      "id": "ec9f9785-2f8c-4512-abc3-85e3a488e830",
      "name": "Code10"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Get row(s) in sheet1').item.json['L·ªõp h·ªçc'] }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5712,
        1536
      ],
      "id": "cb61820e-7615-42a1-987a-e7bc9e537779",
      "name": "Search files and folders12",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "[AI_TUTOR_MEMORY_SHEET]",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -5104,
        1536
      ],
      "id": "91667d22-c33e-41b6-aac4-8639696c9c13",
      "name": "Search files and folders13",
      "alwaysOutputData": true,
      "executeOnce": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8c367d52-533b-477a-87fd-db0fce79f568",
              "name": "[AI_TUTOR_MEMORY_SHEET]",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3872,
        1552
      ],
      "id": "7480ab23-15cc-46cf-9a05-318826628090",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "8067bd3c-ea4e-4324-9976-c8b857be8f13",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        -7984,
        1536
      ],
      "id": "4f39080d-eb00-4c29-a867-584d4a8d3af3",
      "name": "Webhook",
      "webhookId": "8067bd3c-ea4e-4324-9976-c8b857be8f13"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "8fccabd2-431c-4fe8-9c4c-0ed0ba8e4fdd",
              "name": "Folder_t√¨m hi·ªÉu tr∆∞·ªõc b√†i m·ªõi",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -576,
        1936
      ],
      "id": "84701ec8-740a-4359-87a1-b0bf39fd1ea2",
      "name": "Edit Fields21"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y output th√¥ t·ª´ node AI Agent8\nconst rawOutput = $input.item.json.output;\n\ntry {\n  // D√πng bi·ªÉu th·ª©c ch√≠nh quy (regex) ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t chu·ªói JSON n·∫±m gi·ªØa d·∫•u {}\n  // ƒê√¢y l√† b∆∞·ªõc \"d·ªçn d·∫πp\" quan tr·ªçng nh·∫•t\n  const jsonMatch = rawOutput.match(/{[\\s\\S]*}/);\n\n  // Ki·ªÉm tra xem c√≥ t√¨m th·∫•y chu·ªói JSON h·ª£p l·ªá kh√¥ng\n  if (jsonMatch && jsonMatch[0]) {\n    const jsonString = jsonMatch[0];\n    const parsedData = JSON.parse(jsonString);\n    return parsedData;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o, tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng fallback\n    throw new Error(\"No valid JSON found in the AI output.\");\n  }\n\n\n} catch (error) {\n  // N·∫øu c√≥ l·ªói x·∫£y ra ·ªü b·∫•t k·ª≥ b∆∞·ªõc n√†o, tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng d·ª± ph√≤ng\n  return {\n    intent: \"UNKNOWN\",\n    entities: {\n      subject: null,\n      lesson: null\n    },\n    action: \"FALLBACK\",\n    // S·ª¨A L·ªñI ·ªû ƒê√ÇY: Th√™m d·∫•u \" v√†o tr∆∞·ªõc ch·ªØ reply\n    \"reply\": \"R·∫•t ti·∫øc, ƒë√£ c√≥ l·ªói x·∫£y ra trong qu√° tr√¨nh ph√¢n t√≠ch. B·∫°n vui l√≤ng th·ª≠ l·∫°i sau nh√©.\"\n  };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -32,
        1936
      ],
      "id": "0eae4ac5-8420-44c5-be10-ef38101e6bb3",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e9ea05be-ff3f-4a17-be15-f3a1c7a1fa85",
              "name": "text",
              "value": "={{ $json.reply }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        384,
        2048
      ],
      "id": "fb12e467-c676-4006-ab5e-cd279182dd8f",
      "name": "Edit Fields8"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        448,
        -96
      ],
      "id": "0b517160-fd4d-427e-bafe-112a8afc61e5",
      "name": "Respond to Webhook10"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2768,
        512
      ],
      "id": "f7279047-e4f6-4f54-9b1e-f864006c17f9",
      "name": "Respond to Webhook18"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1360,
        1840
      ],
      "id": "3a04f238-6b9e-483a-a3eb-dc575891893e",
      "name": "Respond to Webhook9"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        176,
        1008
      ],
      "id": "52feaca0-705d-4dce-90b7-77188869db1c",
      "name": "Respond to Webhook"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -592,
        2384
      ],
      "id": "a8962aa7-064f-4df8-bf8a-454aa269e62c",
      "name": "Respond to Webhook7"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -592,
        2144
      ],
      "id": "ac8ca6f2-f3c6-41f3-952a-7290e7b244b4",
      "name": "Respond to Webhook1"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        176,
        272
      ],
      "id": "2051bdba-cd25-4cb0-ab1b-3186339acf5b",
      "name": "Search files and folders",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "[Admin] Teacher Resources",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.id }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        -7360,
        1536
      ],
      "id": "f8bcb2d8-d799-4364-954b-9e8e6839825b",
      "name": "Search files and folders2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "Fu9XdVE4G8qIVwID",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "0ce68af7-faac-4a69-9a1e-2776dbbbff3a",
              "name": "Teacher Resources",
              "value": "={{ $('Search files and folders2').item.json.id }}",
              "type": "string"
            },
            {
              "id": "0a66dfd9-946a-4a4a-a5af-3d261a38ace5",
              "name": "Folder_admin",
              "value": "={{ $('Search files and folders7').item.json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -7168,
        1536
      ],
      "id": "926751d8-2c76-464e-be98-f36b62fe5c94",
      "name": "Edit Fields12"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt tr·ª£ l√Ω AI ph√¢n t√≠ch d·ªØ li·ªáu th√¥ng minh. Nhi·ªám·ªám v·ª• c·ªßa b·∫°n l√† t√¨m ra m·ªôt file duy nh·∫•t trong m·ªôt danh s√°ch d·ª±a tr√™n s·ª± t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a v·ªõi m·ªôt m√¥n h·ªçc cho tr∆∞·ªõc.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa b·∫°n bao g·ªìm:\n\nM√¥n h·ªçc c·∫ßn t√¨m: ƒê√¢y l√† m√¥n h·ªçc m·ª•c ti√™u m√† ch√∫ng ta c·∫ßn t√¨m file t∆∞∆°ng ·ª©ng.\n\nM√¥n h·ªçc: {{ $('Code3').first().json.mon_hoc }}\n\nDanh s√°ch c√°c file c√≥ s·∫µn: ƒê√¢y l√† m·ªôt m·∫£ng JSON ch·ª©a th√¥ng tin c√°c file trong Google Drive, m·ªói file c√≥ id v√† name.\n\nDanh s√°ch file: {{ JSON.stringify($('SimplifyFileList').item.json.fileList) }}\n\nQuy tr√¨nh th·ª±c hi·ªán:\n\nPh√¢n t√≠ch \"M√¥n h·ªçc c·∫ßn t√¨m\". Hi·ªÉu r√µ √Ω nghƒ©a c·ªßa n√≥ (v√≠ d·ª•: \"Biology (Sinh h·ªçc)\" c√≥ nghƒ©a l√† m√¥n Sinh h·ªçc).\n\nDuy·ªát qua t·ª´ng file trong \"Danh s√°ch c√°c file c√≥ s·∫µn\".\n\nV·ªõi m·ªói file, so s√°nh tr∆∞·ªùng name c·ªßa n√≥ v·ªõi \"M√¥n h·ªçc c·∫ßn t√¨m\". Vi·ªác so s√°nh ph·∫£i d·ª±a tr√™n √Ω nghƒ©a, kh√¥ng ch·ªâ l√† vƒÉn b·∫£n gi·ªëng h·ªát nhau. V√≠ d·ª•, \"Sinh h·ªçc\" v√† \"Biology (Sinh h·ªçc)\" ƒë∆∞·ª£c coi l√† m·ªôt c·∫∑p tr√πng kh·ªõp ho√†n h·∫£o.\n\nSau khi xem x√©t t·∫•t c·∫£ c√°c file, h√£y x√°c ƒë·ªãnh m·ªôt file duy nh·∫•t c√≥ name t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a nh·∫•t.\n\nTr√≠ch xu·∫•t id v√† name c·ªßa file tr√πng kh·ªõp nh·∫•t ƒë√≥.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\n\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ k√Ω t·ª± hay l·ªùi gi·∫£i th√≠ch n√†o kh√°c. ƒê·ªëi t∆∞·ª£ng JSON ph·∫£i c√≥ ch√≠nh x√°c hai kh√≥a: id v√† name.\n\nV√≠ d·ª• v·ªÅ k·∫øt qu·∫£:\n\nKhi t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": \"1uKis_gmQrN7pF8VMCFxsRMy5EpDPKW62_LCS0Dc6RU\",\n  \"name\": \"V·∫≠t l√Ω\"\n}\nKhi KH√îNG t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": null,\n  \"name\": \"Kh√¥ng t√¨m th·∫•y\"\n}\nQuy t·∫Øc quan tr·ªçng:\n\nCh·ªâ tr·∫£ v·ªÅ m·ªôt k·∫øt qu·∫£ tr√πng kh·ªõp nh·∫•t.\n\nN·∫øu kh√¥ng c√≥ file n√†o th·ª±c s·ª± ph√π h·ª£p, h√£y tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng JSON v·ªõi id l√† null v√† name l√† chu·ªói \"Kh√¥ng t√¨m th·∫•y\".\n\n∆Øu ti√™n c√°c t√™n file l√† t√™n m√¥n h·ªçc, b·ªè qua c√°c t√™n file h·ªá th·ªëng nh∆∞ \"[AI_TUTOR_MEMORY_SHEET]\".",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        592,
        272
      ],
      "id": "357176dc-979b-455a-9957-add0e368d988",
      "name": "AI Agent2"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        592,
        416
      ],
      "id": "d9347dcb-487f-44db-854b-38906efe2f14",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y danh s√°ch c√°c file t·ª´ ƒë·∫ßu v√†o\nconst allFiles = items;\n\n// D√πng h√†m map ƒë·ªÉ l·∫∑p qua t·ª´ng file v√† ch·ªâ gi·ªØ l·∫°i 2 tr∆∞·ªùng id v√† name\nconst simplifiedList = allFiles.map(item => ({\n  id: item.json.id,\n  name: item.json.name\n}));\n\n// Tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t ch·ª©a danh s√°ch ƒë√£ ƒë∆∞·ª£c ƒë∆°n gi·∫£n h√≥a\nreturn [\n  {\n    json: {\n      fileList: simplifiedList\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        272
      ],
      "id": "faa9a613-2773-4d37-9786-2ae514e8a438",
      "name": "SimplifyFileList"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "626581cf-71e5-46aa-99cd-61b449d3b5af",
              "leftValue": "={{ $json.name }}",
              "rightValue": "Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1152,
        272
      ],
      "id": "45f0ccd1-2295-417a-b76c-414f824ad8cd",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Tr√≠ch xu·∫•t v√† ph√¢n t√≠ch m·ªôt chu·ªói JSON n·∫±m b√™n trong m·ªôt tr∆∞·ªùng vƒÉn b·∫£n.\n\ntry {\n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ tr∆∞·ªùng 'output' c·ªßa node tr∆∞·ªõc.\n  const rawString = items[0].json.output || '';\n\n  // 2. D√πng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t ph·∫ßn n·ªôi dung JSON (t·ª´ d·∫•u { ƒë·∫øn d·∫•u }).\n  // Thao t√°c n√†y s·∫Ω lo·∫°i b·ªè c√°c k√Ω t·ª± th·ª´a nh∆∞ ```json\n  const match = rawString.match(/{[\\s\\S]*}/);\n\n  // 3. Ki·ªÉm tra xem c√≥ t√¨m th·∫•y n·ªôi dung JSON kh√¥ng.\n  if (match && match[0]) {\n    // 4. N·∫øu t√¨m th·∫•y, ph√¢n t√≠ch chu·ªói JSON ƒë√≥ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th·ª±c s·ª±.\n    const parsedJson = JSON.parse(match[0]);\n    \n    // 5. Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ph√¢n t√≠ch. \n    // K·∫øt qu·∫£ s·∫Ω c√≥ 2 tr∆∞·ªùng 'id' v√† 'name' nh∆∞ mong mu·ªën.\n    return parsedJson;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o trong vƒÉn b·∫£n.\n    return { id: null, name: 'Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON' };\n  }\n\n} catch (error) {\n  // B·∫Øt l·ªói n·∫øu chu·ªói JSON kh√¥ng h·ª£p l·ªá v√† kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë∆∞·ª£c.\n  return { id: null, name: 'L·ªói ƒë·ªãnh d·∫°ng JSON' };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        272
      ],
      "id": "9636feda-d01b-425b-a260-571258326b7e",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=Vui l√≤ng ki·ªÉm tra l·∫°i t√™n b√†i h·ªçc v√† m√¥n h·ªçc b·∫°n mu·ªën t√¨m",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1376,
        144
      ],
      "id": "71ce08f6-9db4-4d34-bb09-7169770efd21",
      "name": "Edit Fields19"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1616,
        144
      ],
      "id": "c97fbfdc-e179-4c5e-9449-6e225a595de8",
      "name": "Respond to Webhook19"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Prompt ƒë·ªÉ so s√°nh v√† tr√≠ch xu·∫•t b√†i h·ªçc\nB·∫°n l√† m·ªôt tr·ª£ l√Ω AI chuy√™n v·ªÅ so kh·ªõp v√† ph√¢n t√≠ch d·ªØ li·ªáu. Nhi·ªám v·ª• c·ªßa b·∫°n l√† t√¨m ra m·ªôt m·ª•c ph√π h·ª£p nh·∫•t t·ª´ m·ªôt danh s√°ch cho tr∆∞·ªõc, d·ª±a tr√™n s·ª± t∆∞∆°ng ƒë·ªìng v·ªÅ ng·ªØ nghƒ©a v·ªõi m·ªôt t√™n b√†i h·ªçc m·ª•c ti√™u.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa b·∫°n bao g·ªìm:\n\nT√™n b√†i h·ªçc m·ª•c ti√™u: ƒê√¢y l√† t√™n b√†i h·ªçc ch√≠nh x√°c m√† ch√∫ng ta c·∫ßn t√¨m trong danh s√°ch.\n\nT√™n b√†i h·ªçc: {{ $('Code3').first().json.ten_bai_hoc }}\n\nDanh s√°ch c√°c b√†i h·ªçc c√≥ s·∫µn: ƒê√¢y l√† m·ªôt m·∫£ng JSON ch·ª©a c√°c b√†i h·ªçc c√≥ th·ªÉ l·ª±a ch·ªçn, m·ªói b√†i h·ªçc c√≥ name (t√™n) v√† id (ƒë∆∞·ªùng link ho·∫∑c null).\n\nDanh s√°ch: {{ JSON.stringify($('Code in JavaScript2').first().json.lessonList) }}\n\nQuy tr√¨nh th·ª±c hi·ªán:\n\nPh√¢n t√≠ch k·ªπ \"T√™n b√†i h·ªçc m·ª•c ti√™u\".\n\nDuy·ªát qua t·ª´ng b√†i h·ªçc trong \"Danh s√°ch c√°c b√†i h·ªçc c√≥ s·∫µn\".\n\nV·ªõi m·ªói b√†i h·ªçc, so s√°nh tr∆∞·ªùng name c·ªßa n√≥ v·ªõi \"T√™n b√†i h·ªçc m·ª•c ti√™u\". T√¨m ki·∫øm s·ª± tr√πng kh·ªõp ch√≠nh x√°c nh·∫•t v·ªÅ m·∫∑t n·ªôi dung. V√≠ d·ª•: \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P1)\" s·∫Ω kh·ªõp v·ªõi \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P1)\".\n\nSau khi xem x√©t t·∫•t c·∫£, h√£y x√°c ƒë·ªãnh m·ªôt b√†i h·ªçc duy nh·∫•t c√≥ name tr√πng kh·ªõp nh·∫•t.\n\nTr√≠ch xu·∫•t name v√† id c·ªßa b√†i h·ªçc ƒë√≥.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\n\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ l·ªùi gi·∫£i th√≠ch n√†o kh√°c. ƒê·ªëi t∆∞·ª£ng ph·∫£i c√≥ hai kh√≥a: id v√† name.\n\nV√≠ d·ª• v·ªÅ k·∫øt qu·∫£:\n\nKhi t√¨m th·∫•y:\n\nJSON\n\n{\n  \"name\": \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P2)\",\n  \"id\": \"https://docs.google.com/document/d/1Xu-GYkQXQA9V9_dFuJBHeysINR01h7LvgcoaqmVy0\"\n}\nKhi KH√îNG t√¨m th·∫•y:\n\nJSON\n\n{\n  \"name\": \"Kh√¥ng t√¨m th·∫•y b√†i h·ªçc ph√π h·ª£p\",\n  \"id\": null\n}\nQuy t·∫Øc quan tr·ªçng:\n\nN·∫øu b√†i h·ªçc m·ª•c ti√™u c√≥ m·ªôt id (ƒë∆∞·ªùng link) h·ª£p l·ªá trong danh s√°ch, B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ id ƒë√≥.\n\nN·∫øu kh√¥ng t√¨m th·∫•y b√†i h·ªçc n√†o tr√πng kh·ªõp, h√£y tr·∫£ v·ªÅ id l√† null v√† name l√† \"Kh√¥ng t√¨m th·∫•y b√†i h·ªçc ph√π h·ª£p\".",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1792,
        400
      ],
      "id": "051a41ba-e0ef-496e-922e-5a16376b9762",
      "name": "AI Agent5"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1792,
        528
      ],
      "id": "d56527c8-2b5b-4039-a3c5-848bf5cad084",
      "name": "Google Gemini Chat Model4",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: L·∫•y danh s√°ch T√™n & Link b√†i h·ªçc, tr·∫£ v·ªÅ null n·∫øu link tr·ªëng, v√† gom t·∫•t c·∫£ v√†o m·ªôt g√≥i d·ªØ-li·ªáu.\n\n// 1. D√πng .map() ƒë·ªÉ l·∫∑p qua t·∫•t c·∫£ c√°c item ƒë·∫ßu v√†o\nconst allLessons = items.map(item => {\n  const json = item.json;\n  const keys = Object.keys(json);\n\n  // 2. T√¨m ra t√™n c·ªôt ch√≠nh x√°c, b·ªè qua c√°c kho·∫£ng tr·∫Øng th·ª´a\n  const tenKey = keys.find(key => key.trim() === 'T√™n b√†i h·ªçc');\n  const linkKey = keys.find(key => key.trim() === 'Link b√†i h·ªçc');\n\n  // 3. Tr·∫£ v·ªÅ ƒë·ªëi-t∆∞·ª£ng v·ªõi c√°c key m·ªõi l√† 'name' v√† 'id'\n  return {\n    name: json[tenKey],\n    id: json[linkKey] || null // N·∫øu link tr·ªëng, t·ª± ƒë·ªông g√°n gi√° tr·ªã null\n  };\n});\n\n// 4. Tr·∫£ v·ªÅ M·ªòT item duy nh·∫•t ch·ª©a to√†n b·ªô danh s√°ch ƒë√£ x·ª≠-l√Ω\n// trong m·ªôt tr∆∞·ªùng t√™n l√† \"lessonList\"\nreturn [{\n  json: {\n    lessonList: allLessons\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        400
      ],
      "id": "a257d014-486b-4d41-a9a6-145c90bd9e82",
      "name": "Code in JavaScript2"
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Tr√≠ch xu·∫•t v√† ph√¢n t√≠ch ƒë·ªëi t∆∞·ª£ng JSON t·ª´ chu·ªói vƒÉn b·∫£n do AI tr·∫£ v·ªÅ.\n\ntry {\n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ tr∆∞·ªùng 'output' c·ªßa node AI Agent.\n  const rawString = items[0].json.output || '';\n\n  // 2. D√πng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t ph·∫ßn n·ªôi dung JSON (t·ª´ d·∫•u { ƒë·∫øn d·∫•u }).\n  // Thao t√°c n√†y s·∫Ω lo·∫°i b·ªè c√°c k√Ω t·ª± th·ª´a nh∆∞ \"json\\n\"\n  const match = rawString.match(/{[\\s\\S]*}/);\n\n  // 3. Ki·ªÉm tra xem c√≥ t√¨m th·∫•y n·ªôi dung JSON kh√¥ng.\n  if (match && match[0]) {\n    // 4. N·∫øu t√¨m th·∫•y, ph√¢n t√≠ch chu·ªói JSON ƒë√≥ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th·ª±c s·ª±.\n    const parsedJson = JSON.parse(match[0]);\n    \n    // 5. Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ph√¢n t√≠ch.\n    // K·∫øt qu·∫£ s·∫Ω c√≥ 2 tr∆∞·ªùng 'id' v√† 'name' nh∆∞ mong mu·ªën.\n    return parsedJson;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o trong vƒÉn b·∫£n.\n    return { id: null, name: 'Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON' };\n  }\n\n} catch (error) {\n  // B·∫Øt l·ªói n·∫øu chu·ªói JSON kh√¥ng h·ª£p l·ªá v√† kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë∆∞·ª£c.\n  return { id: null, name: 'L·ªói ƒë·ªãnh d·∫°ng JSON' };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2128,
        400
      ],
      "id": "997b89d0-251f-40d4-b40f-069fbfdffd71",
      "name": "Code in JavaScript3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=Vui l√≤ng ki·ªÉm tra l·∫°i t√™n b√†i h·ªçc v√† m√¥n h·ªçc b·∫°n mu·ªën t√¨m",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2544,
        288
      ],
      "id": "c4619e6e-dc4d-4da4-ba47-bb1062c30cbf",
      "name": "Edit Fields20"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2768,
        288
      ],
      "id": "1f9fdcae-d8e0-41ae-b3ea-889d3eccbae0",
      "name": "Respond to Webhook20"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y t·∫•t c·∫£ c√°c item t·ª´ input\nconst items = $input.all();\nconst cleanedItems = [];\n\n// L·∫∑p qua t·ª´ng item\nfor (const item of items) {\n  // L·∫•y chu·ªói output th√¥ t·ª´ node AI\n  const rawOutput = item.json.output;\n\n  if (rawOutput && typeof rawOutput === 'string') {\n    try {\n      // B∆∞·ªõc 1: T√¨m v·ªã tr√≠ c·ªßa d·∫•u '{' ƒë·∫ßu ti√™n v√† '}' cu·ªëi c√πng.\n      // C√°ch n√†y r·∫•t hi·ªáu qu·∫£ ƒë·ªÉ lo·∫°i b·ªè c√°c k√Ω t·ª± r√°c ho·∫∑c markdown (```json)\n      const startIndex = rawOutput.indexOf('{');\n      const endIndex = rawOutput.lastIndexOf('}');\n      \n      // N·∫øu t√¨m th·∫•y m·ªôt c·∫∑p h·ª£p l·ªá\n      if (startIndex > -1 && endIndex > -1) {\n        // B∆∞·ªõc 2: C·∫Øt chu·ªói ƒë·ªÉ ch·ªâ l·∫•y ph·∫ßn JSON\n        const jsonString = rawOutput.substring(startIndex, endIndex + 1);\n        \n        // B∆∞·ªõc 3: Ph√¢n t√≠ch chu·ªói JSON th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript\n        const parsedData = JSON.parse(jsonString);\n        \n        // B∆∞·ªõc 4: ƒê·∫©y k·∫øt qu·∫£ s·∫°ch v√†o m·ªôt m·∫£ng m·ªõi\n        // Item m·ªõi s·∫Ω c√≥ thu·ªôc t√≠nh 'json' ch√≠nh l√† ƒë·ªëi t∆∞·ª£ng ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch\n        cleanedItems.push({\n          json: parsedData\n        });\n      }\n    } catch (error) {\n      // Ghi l·∫°i l·ªói n·∫øu kh√¥ng th·ªÉ ph√¢n t√≠ch JSON\n      console.error(\"Kh√¥ng th·ªÉ ph√¢n t√≠ch output t·ª´ AI:\", rawOutput, error);\n      // Tr·∫£ v·ªÅ m·ªôt item l·ªói ƒë·ªÉ d·ªÖ d√†ng g·ª° r·ªëi\n      cleanedItems.push({\n        json: { error: \"L·ªói ph√¢n t√≠ch JSON\", data: rawOutput }\n      });\n    }\n  }\n}\n\n// Tr·∫£ v·ªÅ m·∫£ng ch·ª©a c√°c item ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch\nreturn cleanedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2224,
        1568
      ],
      "id": "6df29f2d-1c44-44c9-953c-8c5eb505f8e3",
      "name": "Code in JavaScript4"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1uKis_gmQrlN7pF8VMCFxsRMy5EpDPKW62_LCS0Dc6RU/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1376,
        976
      ],
      "id": "52bf7013-833c-4b5d-8104-aa867331c36e",
      "name": "Get row(s) in sheet2",
      "retryOnFail": true,
      "alwaysOutputData": true,
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "J9jYG0gr48KJcHaM",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=**B√ÄI T·∫¨P C·ª¶NG C·ªê**\n\n**Ch·ªß ƒë·ªÅ: {{ $json.name }}**\n\nC√°c em h√£y ho√†n th√†nh b√†i t·∫≠p trong link d∆∞·ªõi ƒë√¢y ƒë·ªÉ c·ªßng c·ªë l·∫°i ki·∫øn th·ª©c ƒë√£ h·ªçc nh√©.\nCh√∫c c√°c em l√†m b√†i t·ªët!\n\nüìù **Link l√†m b√†i:** {{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2544,
        1088
      ],
      "id": "72a10905-77a2-462a-9bbc-f00bcf4afdea",
      "name": "Edit Fields22"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "eeb64f4b-e3a1-4a99-9f62-8ae168514dd2",
              "leftValue": "={{ $json.name }}",
              "rightValue": "=Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2336,
        976
      ],
      "id": "d2c5ab9a-884b-4b83-a9a1-41998c562f94",
      "name": "If18"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2768,
        1088
      ],
      "id": "9cec8edf-33d5-47f6-8dbb-e39e4bd77163",
      "name": "Respond to Webhook21"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        176,
        848
      ],
      "id": "af65660b-4c07-4c38-b5e6-44b4ba9e93f2",
      "name": "Search files and folders3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt tr·ª£ l√Ω AI ph√¢n t√≠ch d·ªØ li·ªáu th√¥ng minh. Nhi·ªám·ªám v·ª• c·ªßa b·∫°n l√† t√¨m ra m·ªôt file duy nh·∫•t trong m·ªôt danh s√°ch d·ª±a tr√™n s·ª± t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a v·ªõi m·ªôt m√¥n h·ªçc cho tr∆∞·ªõc.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa b·∫°n bao g·ªìm:\n\nM√¥n h·ªçc c·∫ßn t√¨m: ƒê√¢y l√† m√¥n h·ªçc m·ª•c ti√™u m√† ch√∫ng ta c·∫ßn t√¨m file t∆∞∆°ng ·ª©ng.\n\nM√¥n h·ªçc: {{ $('Code3').first().json.mon_hoc }}\n\nDanh s√°ch c√°c file c√≥ s·∫µn: ƒê√¢y l√† m·ªôt m·∫£ng JSON ch·ª©a th√¥ng tin c√°c file trong Google Drive, m·ªói file c√≥ id v√† name.\n\nDanh s√°ch file: {{ JSON.stringify($('SimplifyFileList1').item.json.fileList) }}\n\nQuy tr√¨nh th·ª±c hi·ªán:\n\nPh√¢n t√≠ch \"M√¥n h·ªçc c·∫ßn t√¨m\". Hi·ªÉu r√µ √Ω nghƒ©a c·ªßa n√≥ (v√≠ d·ª•: \"Biology (Sinh h·ªçc)\" c√≥ nghƒ©a l√† m√¥n Sinh h·ªçc).\n\nDuy·ªát qua t·ª´ng file trong \"Danh s√°ch c√°c file c√≥ s·∫µn\".\n\nV·ªõi m·ªói file, so s√°nh tr∆∞·ªùng name c·ªßa n√≥ v·ªõi \"M√¥n h·ªçc c·∫ßn t√¨m\". Vi·ªác so s√°nh ph·∫£i d·ª±a tr√™n √Ω nghƒ©a, kh√¥ng ch·ªâ l√† vƒÉn b·∫£n gi·ªëng h·ªát nhau. V√≠ d·ª•, \"Sinh h·ªçc\" v√† \"Biology (Sinh h·ªçc)\" ƒë∆∞·ª£c coi l√† m·ªôt c·∫∑p tr√πng kh·ªõp ho√†n h·∫£o.\n\nSau khi xem x√©t t·∫•t c·∫£ c√°c file, h√£y x√°c ƒë·ªãnh m·ªôt file duy nh·∫•t c√≥ name t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a nh·∫•t.\n\nTr√≠ch xu·∫•t id v√† name c·ªßa file tr√πng kh·ªõp nh·∫•t ƒë√≥.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\n\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ k√Ω t·ª± hay l·ªùi gi·∫£i th√≠ch n√†o kh√°c. ƒê·ªëi t∆∞·ª£ng JSON ph·∫£i c√≥ ch√≠nh x√°c hai kh√≥a: id v√† name.\n\nV√≠ d·ª• v·ªÅ k·∫øt qu·∫£:\n\nKhi t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": \"1uKis_gmQrN7pF8VMCFxsRMy5EpDPKW62_LCS0Dc6RU\",\n  \"name\": \"V·∫≠t l√Ω\"\n}\nKhi KH√îNG t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": null,\n  \"name\": \"Kh√¥ng t√¨m th·∫•y\"\n}\nQuy t·∫Øc quan tr·ªçng:\n\nCh·ªâ tr·∫£ v·ªÅ m·ªôt k·∫øt qu·∫£ tr√πng kh·ªõp nh·∫•t.\n\nN·∫øu kh√¥ng c√≥ file n√†o th·ª±c s·ª± ph√π h·ª£p, h√£y tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng JSON v·ªõi id l√† null v√† name l√† chu·ªói \"Kh√¥ng t√¨m th·∫•y\".\n\n∆Øu ti√™n c√°c t√™n file l√† t√™n m√¥n h·ªçc, b·ªè qua c√°c t√™n file h·ªá th·ªëng nh∆∞ \"[AI_TUTOR_MEMORY_SHEET]\".",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        592,
        848
      ],
      "id": "b27134b1-ee6f-4ffc-989b-00dccf6e44b6",
      "name": "AI Agent7"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        592,
        992
      ],
      "id": "cbbb7f08-34a6-4aa3-9bf6-843ea5aeb7f9",
      "name": "Google Gemini Chat Model6",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y danh s√°ch c√°c file t·ª´ ƒë·∫ßu v√†o\nconst allFiles = items;\n\n// D√πng h√†m map ƒë·ªÉ l·∫∑p qua t·ª´ng file v√† ch·ªâ gi·ªØ l·∫°i 2 tr∆∞·ªùng id v√† name\nconst simplifiedList = allFiles.map(item => ({\n  id: item.json.id,\n  name: item.json.name\n}));\n\n// Tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t ch·ª©a danh s√°ch ƒë√£ ƒë∆∞·ª£c ƒë∆°n gi·∫£n h√≥a\nreturn [\n  {\n    json: {\n      fileList: simplifiedList\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        848
      ],
      "id": "e6d2cbb7-632b-4c44-ad49-1f6b30e2e7ef",
      "name": "SimplifyFileList1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "626581cf-71e5-46aa-99cd-61b449d3b5af",
              "leftValue": "={{ $json.name }}",
              "rightValue": "Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1152,
        848
      ],
      "id": "66bf2dc3-7dcc-4228-abb2-a817c18b102c",
      "name": "If1"
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Tr√≠ch xu·∫•t v√† ph√¢n t√≠ch m·ªôt chu·ªói JSON n·∫±m b√™n trong m·ªôt tr∆∞·ªùng vƒÉn b·∫£n.\n\ntry {\n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ tr∆∞·ªùng 'output' c·ªßa node tr∆∞·ªõc.\n  const rawString = items[0].json.output || '';\n\n  // 2. D√πng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t ph·∫ßn n·ªôi dung JSON (t·ª´ d·∫•u { ƒë·∫øn d·∫•u }).\n  // Thao t√°c n√†y s·∫Ω lo·∫°i b·ªè c√°c k√Ω t·ª± th·ª´a nh∆∞ ```json\n  const match = rawString.match(/{[\\s\\S]*}/);\n\n  // 3. Ki·ªÉm tra xem c√≥ t√¨m th·∫•y n·ªôi dung JSON kh√¥ng.\n  if (match && match[0]) {\n    // 4. N·∫øu t√¨m th·∫•y, ph√¢n t√≠ch chu·ªói JSON ƒë√≥ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th·ª±c s·ª±.\n    const parsedJson = JSON.parse(match[0]);\n    \n    // 5. Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ph√¢n t√≠ch. \n    // K·∫øt qu·∫£ s·∫Ω c√≥ 2 tr∆∞·ªùng 'id' v√† 'name' nh∆∞ mong mu·ªën.\n    return parsedJson;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o trong vƒÉn b·∫£n.\n    return { id: null, name: 'Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON' };\n  }\n\n} catch (error) {\n  // B·∫Øt l·ªói n·∫øu chu·ªói JSON kh√¥ng h·ª£p l·ªá v√† kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë∆∞·ª£c.\n  return { id: null, name: 'L·ªói ƒë·ªãnh d·∫°ng JSON' };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        848
      ],
      "id": "5adfdd4e-68d0-487a-8e93-bd4b2f99eed3",
      "name": "Code in JavaScript5"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=Vui l√≤ng ki·ªÉm tra l·∫°i t√™n b√†i t·∫≠p v√† m√¥n h·ªçc b·∫°n mu·ªën t√¨m",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1376,
        720
      ],
      "id": "965327cb-ab5f-4cda-b97c-93677550e36e",
      "name": "Edit Fields23"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        1616,
        720
      ],
      "id": "18196b11-2099-4f9e-be69-1d985d1148a6",
      "name": "Respond to Webhook22"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Prompt ƒë·ªÉ so s√°nh v√† tr√≠ch xu·∫•t b√†i h·ªçc\nB·∫°n l√† m·ªôt tr·ª£ l√Ω AI chuy√™n v·ªÅ so kh·ªõp v√† ph√¢n t√≠ch d·ªØ li·ªáu. Nhi·ªám v·ª• c·ªßa b·∫°n l√† t√¨m ra m·ªôt m·ª•c ph√π h·ª£p nh·∫•t t·ª´ m·ªôt danh s√°ch cho tr∆∞·ªõc, d·ª±a tr√™n s·ª± t∆∞∆°ng ƒë·ªìng v·ªÅ ng·ªØ nghƒ©a v·ªõi m·ªôt t√™n b√†i h·ªçc m·ª•c ti√™u.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa b·∫°n bao g·ªìm:\n\nT√™n b√†i h·ªçc m·ª•c ti√™u: ƒê√¢y l√† t√™n b√†i h·ªçc ch√≠nh x√°c m√† ch√∫ng ta c·∫ßn t√¨m trong danh s√°ch.\n\nT√™n b√†i h·ªçc: {{ $('Code3').first().json.ten_bai_hoc }}\n\nDanh s√°ch c√°c b√†i h·ªçc c√≥ s·∫µn: ƒê√¢y l√† m·ªôt m·∫£ng JSON ch·ª©a c√°c b√†i h·ªçc c√≥ th·ªÉ l·ª±a ch·ªçn, m·ªói b√†i h·ªçc c√≥ name (t√™n) v√† id (ƒë∆∞·ªùng link ho·∫∑c null).\n\nDanh s√°ch: {{ JSON.stringify($('Code in JavaScript6').first().json.lessonList) }}\n\nQuy tr√¨nh th·ª±c hi·ªán:\n\nPh√¢n t√≠ch k·ªπ \"T√™n b√†i h·ªçc m·ª•c ti√™u\".\n\nDuy·ªát qua t·ª´ng b√†i h·ªçc trong \"Danh s√°ch c√°c b√†i h·ªçc c√≥ s·∫µn\".\n\nV·ªõi m·ªói b√†i h·ªçc, so s√°nh tr∆∞·ªùng name c·ªßa n√≥ v·ªõi \"T√™n b√†i h·ªçc m·ª•c ti√™u\". T√¨m ki·∫øm s·ª± tr√πng kh·ªõp ch√≠nh x√°c nh·∫•t v·ªÅ m·∫∑t n·ªôi dung. V√≠ d·ª•: \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P1)\" s·∫Ω kh·ªõp v·ªõi \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P1)\".\n\nSau khi xem x√©t t·∫•t c·∫£, h√£y x√°c ƒë·ªãnh m·ªôt b√†i h·ªçc duy nh·∫•t c√≥ name tr√πng kh·ªõp nh·∫•t.\n\nTr√≠ch xu·∫•t name v√† id c·ªßa b√†i h·ªçc ƒë√≥.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\n\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ l·ªùi gi·∫£i th√≠ch n√†o kh√°c. ƒê·ªëi t∆∞·ª£ng ph·∫£i c√≥ hai kh√≥a: id v√† name.\n\nV√≠ d·ª• v·ªÅ k·∫øt qu·∫£:\n\nKhi t√¨m th·∫•y:\n\nJSON\n\n{\n  \"name\": \"Ba ƒê·ªãnh Lu·∫≠t Newton V·ªÅ Chuy·ªÉn ƒê·ªông (P2)\",\n  \"id\": \"https://docs.google.com/document/d/1Xu-GYkQXQA9V9_dFuJBHeysINR01h7LvgcoaqmVy0\"\n}\nKhi KH√îNG t√¨m th·∫•y:\n\nJSON\n\n{\n  \"name\": \"Kh√¥ng t√¨m th·∫•y b√†i h·ªçc ph√π h·ª£p\",\n  \"id\": null\n}\nQuy t·∫Øc quan tr·ªçng:\n\nN·∫øu b√†i h·ªçc m·ª•c ti√™u c√≥ m·ªôt id (ƒë∆∞·ªùng link) h·ª£p l·ªá trong danh s√°ch, B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ id ƒë√≥.\n\nN·∫øu kh√¥ng t√¨m th·∫•y b√†i h·ªçc n√†o tr√πng kh·ªõp, h√£y tr·∫£ v·ªÅ id l√† null v√† name l√† \"Kh√¥ng t√¨m th·∫•y b√†i h·ªçc ph√π h·ª£p\".",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1792,
        976
      ],
      "id": "755c6ff8-c5a8-4146-b53b-5cca79d9f3ed",
      "name": "AI Agent8"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1792,
        1104
      ],
      "id": "ad3f392b-af79-43c8-ae71-f738357e0cf4",
      "name": "Google Gemini Chat Model9",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: L·∫•y danh s√°ch T√™n & Link b√†i h·ªçc, tr·∫£ v·ªÅ null n·∫øu link tr·ªëng, v√† gom t·∫•t c·∫£ v√†o m·ªôt g√≥i d·ªØ-li·ªáu.\n\n// 1. D√πng .map() ƒë·ªÉ l·∫∑p qua t·∫•t c·∫£ c√°c item ƒë·∫ßu v√†o\nconst allLessons = items.map(item => {\n  const json = item.json;\n  const keys = Object.keys(json);\n\n  // 2. T√¨m ra t√™n c·ªôt ch√≠nh x√°c, b·ªè qua c√°c kho·∫£ng tr·∫Øng th·ª´a\n  const tenKey = keys.find(key => key.trim() === 'T√™n b√†i h·ªçc');\n  const linkKey = keys.find(key => key.trim() === 'Link b√†i t·∫≠p');\n\n  // 3. Tr·∫£ v·ªÅ ƒë·ªëi-t∆∞·ª£ng v·ªõi c√°c key m·ªõi l√† 'name' v√† 'id'\n  return {\n    name: json[tenKey],\n    id: json[linkKey] || null // N·∫øu link tr·ªëng, t·ª± ƒë·ªông g√°n gi√° tr·ªã null\n  };\n});\n\n// 4. Tr·∫£ v·ªÅ M·ªòT item duy nh·∫•t ch·ª©a to√†n b·ªô danh s√°ch ƒë√£ x·ª≠-l√Ω\n// trong m·ªôt tr∆∞·ªùng t√™n l√† \"lessonList\"\nreturn [{\n  json: {\n    lessonList: allLessons\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1584,
        976
      ],
      "id": "34d2424c-2806-42e7-b77f-f55e6ea70266",
      "name": "Code in JavaScript6"
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Tr√≠ch xu·∫•t v√† ph√¢n t√≠ch ƒë·ªëi t∆∞·ª£ng JSON t·ª´ chu·ªói vƒÉn b·∫£n do AI tr·∫£ v·ªÅ.\n\ntry {\n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ tr∆∞·ªùng 'output' c·ªßa node AI Agent.\n  const rawString = items[0].json.output || '';\n\n  // 2. D√πng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t ph·∫ßn n·ªôi dung JSON (t·ª´ d·∫•u { ƒë·∫øn d·∫•u }).\n  // Thao t√°c n√†y s·∫Ω lo·∫°i b·ªè c√°c k√Ω t·ª± th·ª´a nh∆∞ \"json\\n\"\n  const match = rawString.match(/{[\\s\\S]*}/);\n\n  // 3. Ki·ªÉm tra xem c√≥ t√¨m th·∫•y n·ªôi dung JSON kh√¥ng.\n  if (match && match[0]) {\n    // 4. N·∫øu t√¨m th·∫•y, ph√¢n t√≠ch chu·ªói JSON ƒë√≥ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th·ª±c s·ª±.\n    const parsedJson = JSON.parse(match[0]);\n    \n    // 5. Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ph√¢n t√≠ch.\n    // K·∫øt qu·∫£ s·∫Ω c√≥ 2 tr∆∞·ªùng 'id' v√† 'name' nh∆∞ mong mu·ªën.\n    return parsedJson;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o trong vƒÉn b·∫£n.\n    return { id: null, name: 'Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON' };\n  }\n\n} catch (error) {\n  // B·∫Øt l·ªói n·∫øu chu·ªói JSON kh√¥ng h·ª£p l·ªá v√† kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë∆∞·ª£c.\n  return { id: null, name: 'L·ªói ƒë·ªãnh d·∫°ng JSON' };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2128,
        976
      ],
      "id": "93a41566-5645-4d69-9e7a-74ad882bd6fe",
      "name": "Code in JavaScript7"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=Vui l√≤ng ki·ªÉm tra l·∫°i t√™n b√†i t·∫≠p v√† m√¥n h·ªçc b·∫°n mu·ªën t√¨m",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2544,
        864
      ],
      "id": "2038fe6a-011e-46d7-b52c-c76b11c7fa36",
      "name": "Edit Fields24"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        2768,
        864
      ],
      "id": "c3ccc469-1f39-4de5-b5b7-3fe1b0e20b4c",
      "name": "Respond to Webhook23"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·ªëi c·∫£nh (Context)\nB·∫°n l√† m·ªôt AI chuy√™n gia ph√¢n t√≠ch v√† tr√≠ch xu·∫•t th√¥ng tin. Nhi·ªám v·ª• c·ªßa b·∫°n l√† ƒë·ªçc tin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng v√† x√°c ƒë·ªãnh xem h·ªç ƒë√£ n√≥i r√µ v·ªÅ ch·ªß ƒë·ªÅ c·∫ßn √¥n t·∫≠p hay ch∆∞a.\n\nC√°c lo·∫°i √Ω ƒë·ªãnh (Intents)\nB·∫°n PH·∫¢I ph√¢n lo·∫°i tin nh·∫Øn v√†o M·ªòT trong hai lo·∫°i sau:\n\nspecific_review: Ng∆∞·ªùi d√πng n√≥i r√µ h·ªç mu·ªën √¥n t·∫≠p v·ªÅ c√°i g√¨ (v√≠ d·ª•: \"gi·ªØa k·ª≥ 1\", \"h·ªçc k·ª≥ 2\", \"ch∆∞∆°ng 5\", \"b√†i th∆° ABC\").\n\nunclear: Ng∆∞·ªùi d√πng ch·ªâ n√≥i chung chung (v√≠ d·ª•: \"√¥n t·∫≠p\", \"√¥n thi\") m√† kh√¥ng ƒë·ªÅ c·∫≠p ƒë·∫øn m·ªôt ch·ªß ƒë·ªÅ c·ª• th·ªÉ.\n\nNhi·ªám v·ª• ch√≠nh\nPh√¢n lo·∫°i √Ω ƒë·ªãnh v√†o specific_review ho·∫∑c unclear.\n\nN·∫øu √Ω ƒë·ªãnh l√† specific_review, h√£y tr√≠ch xu·∫•t ch√≠nh x√°c m√¥n h·ªçc (n·∫øu c√≥), t√™n b√†i h·ªçc/ch∆∞∆°ng (n·∫øu c√≥) v√† c·ª•m t·ª´ ch·ªâ ch·ªß ƒë·ªÅ chung (nh∆∞ k·ª≥ thi) m√† ng∆∞·ªùi d√πng mu·ªën √¥n t·∫≠p.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra (Output Format)\nB·∫°n PH·∫¢I tr·∫£ l·ªùi b·∫±ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ gi·∫£i th√≠ch hay ch·ªØ n√†o kh√°c.\nC·∫•u tr√∫c:\n\nJSON\n\n{\n  \"intent\": \"t√™n_lo·∫°i_√Ω_ƒë·ªãnh\",\n  \"mon_hoc\": \"t√™n_m√¥n_h·ªçc_n·∫øu_c√≥\",\n  \"ten_bai_hoc\": \"t√™n_b√†i_h·ªçc_ho·∫∑c_ch∆∞∆°ng_n·∫øu_c√≥\",\n  \"details\": \"ch·ªß_ƒë·ªÅ_chung_ƒë∆∞·ª£c_tr√≠ch_xu·∫•t\"\n}\nN·∫øu intent l√† unclear, t·∫•t c·∫£ c√°c tr∆∞·ªùng c√≤n l·∫°i ph·∫£i l√† null.\n\nN·∫øu th√¥ng tin n√†o kh√¥ng ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p, tr∆∞·ªùng t∆∞∆°ng ·ª©ng ph·∫£i l√† null.\n\nV√≠ d·ª• (Examples) üéØ\nTin nh·∫Øn: \"√¥n thi gi·ªØa h·ªçc k√¨ 1 m√¥n To√°n\"\n-> {\"intent\": \"specific_review\", \"mon_hoc\": \"To√°n\", \"ten_bai_hoc\": null, \"details\": \"gi·ªØa h·ªçc k√¨ 1\"}\n\nTin nh·∫Øn: \"t·ªïng h·ª£p ki·∫øn th·ª©c VƒÉn b√†i Tuy√™n ng√¥n ƒë·ªôc l·∫≠p\"\n-> {\"intent\": \"specific_review\", \"mon_hoc\": \"VƒÉn\", \"ten_bai_hoc\": \"Tuy√™n ng√¥n ƒë·ªôc l·∫≠p\", \"details\": null}\n\nTin nh·∫Øn: \"t√¥i mu·ªën xem l·∫°i b√†i 5 m√¥n S·ª≠\"\n-> {\"intent\": \"specific_review\", \"mon_hoc\": \"S·ª≠\", \"ten_bai_hoc\": \"b√†i 5\", \"details\": null}\n\nTin nh·∫Øn: \"√¥n t·∫≠p\"\n-> {\"intent\": \"unclear\", \"mon_hoc\": null, \"ten_bai_hoc\": null, \"details\": null}\n\nTin nh·∫Øn c·ªßa ng∆∞·ªùi d√πng (User Message)\n{{ $('Code4').item.json.messageText }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -1040,
        1552
      ],
      "id": "52312873-bcd9-4bbe-9272-26ca9506338e",
      "name": "AI Agent9"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -1040,
        1680
      ],
      "id": "b31398d4-1b21-4326-9224-9887ce4df3b2",
      "name": "Google Gemini Chat Model13",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y output d·∫°ng vƒÉn b·∫£n th√¥ t·ª´ node AI Agent9\nconst aiRawOutput = $('AI Agent9').item.json.output;\n\n// Ki·ªÉm tra xem output c√≥ ph·∫£i l√† chu·ªói kh√¥ng, n·∫øu kh√¥ng th√¨ b√°o l·ªói\nif (typeof aiRawOutput !== 'string') {\n  return [{ json: { error: \"ƒê·∫ßu v√†o kh√¥ng ph·∫£i l√† chu·ªói vƒÉn b·∫£n th√¥.\", input: aiRawOutput } }];\n}\n\n// 1. D√πng bi·ªÉu th·ª©c ch√≠nh quy (regex) ƒë·ªÉ tr√≠ch xu·∫•t ph·∫ßn JSON c·ªët l√µi\nconst jsonMatch = aiRawOutput.match(/{.*}/s);\n\n// Ki·ªÉm tra xem regex c√≥ t√¨m th·∫•y JSON kh√¥ng\nif (jsonMatch && jsonMatch[0]) {\n  const jsonString = jsonMatch[0];\n  \n  // 2. Chuy·ªÉn ƒë·ªïi chu·ªói th√†nh ƒë·ªëi t∆∞·ª£ng JSON, c√≥ x·ª≠ l√Ω l·ªói\n  try {\n    const parsedJson = JSON.parse(jsonString);\n    const topicsString = parsedJson.details;\n\n    // 3. √Åp d·ª•ng logic: T√°ch chu·ªói n·∫øu c√≥, n·∫øu kh√¥ng th√¨ gi·ªØ nguy√™n\n    if (topicsString && typeof topicsString === 'string' && topicsString.trim() !== '') {\n      // T√°ch th√†nh nhi·ªÅu item\n      const newItems = [];\n      const topicsArray = topicsString.split(',').map(item => item.trim());\n\n      for (const topic of topicsArray) {\n        // --- B·∫ÆT ƒê·∫¶U THAY ƒê·ªîI ---\n        newItems.push({\n          json: {\n            ...parsedJson, // <-- THAY ƒê·ªîI QUAN TR·ªåNG: Sao ch√©p t·∫•t c·∫£ c√°c tr∆∞·ªùng c≈©\n            details: null,     // Ghi ƒë√® 'details' g·ªëc ƒë·ªÉ tr√°nh tr√πng l·∫∑p\n            reviewTopic: topic // Th√™m tr∆∞·ªùng m·ªõi ch·ª©a ch·ªß ƒë·ªÅ ƒë√£ t√°ch\n          }\n        });\n        // --- K·∫æT TH√öC THAY ƒê·ªîI ---\n      }\n      return newItems; // Tr·∫£ v·ªÅ m·∫£ng nhi·ªÅu item\n\n    } else {\n      // Gi·ªØ nguy√™n, tr·∫£ v·ªÅ JSON ƒë√£ ƒë∆∞·ª£c l√†m s·∫°ch v√† chu·∫©n h√≥a\n      return [{ json: parsedJson }]; // Tr·∫£ v·ªÅ m·∫£ng m·ªôt item\n    }\n\n  } catch (e) {\n    return [{ json: { error: \"L·ªói khi parse JSON t·ª´ chu·ªói ƒë√£ tr√≠ch xu·∫•t.\", details: e.message, rawString: jsonString } }];\n  }\n\n} else {\n  return [{ json: { error: \"Kh√¥ng t√¨m th·∫•y chu·ªói JSON h·ª£p l·ªá trong output c·ªßa AI.\", rawOutput: aiRawOutput } }];\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -736,
        1264
      ],
      "id": "ab0c9606-9da7-4022-8395-4b1d9a1998dc",
      "name": "Code"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b3c62d8f-0d7e-49f5-a8c7-1bd91b62bb13",
              "leftValue": "={{ $json.intent }}",
              "rightValue": "unclear",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        176,
        1248
      ],
      "id": "ca0c58d5-0aa7-40de-a65a-0106987faa9a",
      "name": "If2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4dc80bdc-7cfa-49cb-b373-a9091564fb02",
              "name": "text",
              "value": "ƒê·ªÉ c√≥ th·ªÉ h·ªó tr·ª£ t·ªët nh·∫•t, b·∫°n vui l√≤ng cho m√¨nh bi·∫øt c·ª• th·ªÉ h∆°n nh√©. B·∫°n ƒëang mu·ªën √¥n t·∫≠p cho k·ª≥ thi n√†o hay n·ªôi dung g√¨?  \nB·∫°n c√≥ th·ªÉ th·ª≠ m·ªôt trong c√°c c√°ch sau:  \n- √în thi gi·ªØa h·ªçc k·ª≥ 1  \n- √în thi cu·ªëi h·ªçc k·ª≥ 2  \n- √în l·∫°i b√†i th∆° S√≥ng\n- √în l·∫°i b√†i ƒêi·ªán T·ª´",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        368,
        1152
      ],
      "id": "9aec75f0-5e90-42ee-8af9-8b6a292ad6b0",
      "name": "Edit Fields11"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b018da9d-fc44-44b2-9c97-0095ab644173",
              "leftValue": "={{ $json.ten_bai_hoc }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -96,
        1568
      ],
      "id": "d6e431c3-6ebd-4a9d-a935-41c1ce0d3920",
      "name": "If3"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "bce5f388-ed3d-4f23-bf19-23f41642260d",
              "leftValue": "={{ $json.mon_hoc }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -544,
        1552
      ],
      "id": "f0b4eed7-371f-4c68-a7ea-8582e885bc94",
      "name": "If8"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67f3a37b-d21c-4103-a5f5-2b0e5a3455c1",
              "name": "text",
              "value": "=ƒê·ªÉ t√¨m t√†i li·ªáu v·ªÅ \"{{ $json.reviewTopic }}\" ch√≠nh x√°c h∆°n, b·∫°n vui l√≤ng cho bi·∫øt ch·ªß ƒë·ªÅ n√†y thu·ªôc m√¥n h·ªçc n√†o nh√©?  \n- V√≠ d·ª•: To√°n, Ng·ªØ vƒÉn, L·ªãch s·ª≠...",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -288,
        1248
      ],
      "id": "97db1a71-d92b-4433-acbb-b17ad5238416",
      "name": "Edit Fields4"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -96,
        1248
      ],
      "id": "2c79f5a0-8e49-4ba4-876c-697bc8695364",
      "name": "Respond to Webhook12"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').item.json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.spreadsheet"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        368,
        1344
      ],
      "id": "8e4a7b12-cb4b-4ee8-8909-9ca19dca2aad",
      "name": "Search files and folders5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt tr·ª£ l√Ω AI ph√¢n t√≠ch d·ªØ li·ªáu th√¥ng minh. Nhi·ªám·ªám v·ª• c·ªßa b·∫°n l√† t√¨m ra m·ªôt file duy nh·∫•t trong m·ªôt danh s√°ch d·ª±a tr√™n s·ª± t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a v·ªõi m·ªôt m√¥n h·ªçc cho tr∆∞·ªõc.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o c·ªßa b·∫°n bao g·ªìm:\n\nM√¥n h·ªçc c·∫ßn t√¨m: ƒê√¢y l√† m√¥n h·ªçc m·ª•c ti√™u m√† ch√∫ng ta c·∫ßn t√¨m file t∆∞∆°ng ·ª©ng.\n\nM√¥n h·ªçc: {{ $('Code').first().json.mon_hoc }}\n\nDanh s√°ch c√°c file c√≥ s·∫µn: ƒê√¢y l√† m·ªôt m·∫£ng JSON ch·ª©a th√¥ng tin c√°c file trong Google Drive, m·ªói file c√≥ id v√† name.\n\nDanh s√°ch file: {{ JSON.stringify($('SimplifyFileList2').item.json.fileList) }}\n\nQuy tr√¨nh th·ª±c hi·ªán:\n\nPh√¢n t√≠ch \"M√¥n h·ªçc c·∫ßn t√¨m\". Hi·ªÉu r√µ √Ω nghƒ©a c·ªßa n√≥ (v√≠ d·ª•: \"Biology (Sinh h·ªçc)\" c√≥ nghƒ©a l√† m√¥n Sinh h·ªçc).\n\nDuy·ªát qua t·ª´ng file trong \"Danh s√°ch c√°c file c√≥ s·∫µn\".\n\nV·ªõi m·ªói file, so s√°nh tr∆∞·ªùng name c·ªßa n√≥ v·ªõi \"M√¥n h·ªçc c·∫ßn t√¨m\". Vi·ªác so s√°nh ph·∫£i d·ª±a tr√™n √Ω nghƒ©a, kh√¥ng ch·ªâ l√† vƒÉn b·∫£n gi·ªëng h·ªát nhau. V√≠ d·ª•, \"Sinh h·ªçc\" v√† \"Biology (Sinh h·ªçc)\" ƒë∆∞·ª£c coi l√† m·ªôt c·∫∑p tr√πng kh·ªõp ho√†n h·∫£o.\n\nSau khi xem x√©t t·∫•t c·∫£ c√°c file, h√£y x√°c ƒë·ªãnh m·ªôt file duy nh·∫•t c√≥ name t∆∞∆°ng ƒë·ªìng v·ªÅ m·∫∑t ng·ªØ nghƒ©a nh·∫•t.\n\nTr√≠ch xu·∫•t id v√† name c·ªßa file tr√πng kh·ªõp nh·∫•t ƒë√≥.\n\nƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\n\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, kh√¥ng c√≥ b·∫•t k·ª≥ k√Ω t·ª± hay l·ªùi gi·∫£i th√≠ch n√†o kh√°c. ƒê·ªëi t∆∞·ª£ng JSON ph·∫£i c√≥ ch√≠nh x√°c hai kh√≥a: id v√† name.\n\nV√≠ d·ª• v·ªÅ k·∫øt qu·∫£:\n\nKhi t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": \"1uKis_gmQrN7pF8VMCFxsRMy5EpDPKW62_LCS0Dc6RU\",\n  \"name\": \"V·∫≠t l√Ω\"\n}\nKhi KH√îNG t√¨m th·∫•y:\n\nJSON\n\n{\n  \"id\": null,\n  \"name\": \"Kh√¥ng t√¨m th·∫•y\"\n}\nQuy t·∫Øc quan tr·ªçng:\n\nCh·ªâ tr·∫£ v·ªÅ m·ªôt k·∫øt qu·∫£ tr√πng kh·ªõp nh·∫•t.\n\nN·∫øu kh√¥ng c√≥ file n√†o th·ª±c s·ª± ph√π h·ª£p, h√£y tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng JSON v·ªõi id l√† null v√† name l√† chu·ªói \"Kh√¥ng t√¨m th·∫•y\".\n\n∆Øu ti√™n c√°c t√™n file l√† t√™n m√¥n h·ªçc, b·ªè qua c√°c t√™n file h·ªá th·ªëng nh∆∞ \"[AI_TUTOR_MEMORY_SHEET]\".",
        "hasOutputParser": true,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        784,
        1344
      ],
      "id": "6eb25b2d-ad4c-46ca-8e6f-354740af3f50",
      "name": "AI Agent10"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        784,
        1472
      ],
      "id": "f8c2df05-9b5d-4f69-9f4e-fc3c4b87714b",
      "name": "Google Gemini Chat Model14",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y danh s√°ch c√°c file t·ª´ ƒë·∫ßu v√†o\nconst allFiles = items;\n\n// D√πng h√†m map ƒë·ªÉ l·∫∑p qua t·ª´ng file v√† ch·ªâ gi·ªØ l·∫°i 2 tr∆∞·ªùng id v√† name\nconst simplifiedList = allFiles.map(item => ({\n  id: item.json.id,\n  name: item.json.name\n}));\n\n// Tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t ch·ª©a danh s√°ch ƒë√£ ƒë∆∞·ª£c ƒë∆°n gi·∫£n h√≥a\nreturn [\n  {\n    json: {\n      fileList: simplifiedList\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        1344
      ],
      "id": "9910137f-bdc9-4f40-b171-d43c4592c3f7",
      "name": "SimplifyFileList2"
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Tr√≠ch xu·∫•t v√† ph√¢n t√≠ch m·ªôt chu·ªói JSON n·∫±m b√™n trong m·ªôt tr∆∞·ªùng vƒÉn b·∫£n.\n\ntry {\n  // 1. L·∫•y chu·ªói vƒÉn b·∫£n th√¥ t·ª´ tr∆∞·ªùng 'output' c·ªßa node tr∆∞·ªõc.\n  const rawString = items[0].json.output || '';\n\n  // 2. D√πng bi·ªÉu th·ª©c ch√≠nh quy ƒë·ªÉ t√¨m v√† tr√≠ch xu·∫•t ph·∫ßn n·ªôi dung JSON (t·ª´ d·∫•u { ƒë·∫øn d·∫•u }).\n  // Thao t√°c n√†y s·∫Ω lo·∫°i b·ªè c√°c k√Ω t·ª± th·ª´a nh∆∞ ```json\n  const match = rawString.match(/{[\\s\\S]*}/);\n\n  // 3. Ki·ªÉm tra xem c√≥ t√¨m th·∫•y n·ªôi dung JSON kh√¥ng.\n  if (match && match[0]) {\n    // 4. N·∫øu t√¨m th·∫•y, ph√¢n t√≠ch chu·ªói JSON ƒë√≥ th√†nh m·ªôt ƒë·ªëi t∆∞·ª£ng JavaScript th·ª±c s·ª±.\n    const parsedJson = JSON.parse(match[0]);\n    \n    // 5. Tr·∫£ v·ªÅ ƒë·ªëi t∆∞·ª£ng ƒë√£ ph√¢n t√≠ch. \n    // K·∫øt qu·∫£ s·∫Ω c√≥ 2 tr∆∞·ªùng 'id' v√† 'name' nh∆∞ mong mu·ªën.\n    return parsedJson;\n  } else {\n    // N·∫øu kh√¥ng t√¨m th·∫•y chu·ªói JSON n√†o trong vƒÉn b·∫£n.\n    return { id: null, name: 'Kh√¥ng t√¨m th·∫•y n·ªôi dung JSON' };\n  }\n\n} catch (error) {\n  // B·∫Øt l·ªói n·∫øu chu·ªói JSON kh√¥ng h·ª£p l·ªá v√† kh√¥ng th·ªÉ ph√¢n t√≠ch ƒë∆∞·ª£c.\n  return { id: null, name: 'L·ªói ƒë·ªãnh d·∫°ng JSON' };\n}"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        1344
      ],
      "id": "66c0de33-fa73-4ac6-a1e3-bf9801f0f90e",
      "name": "Code in JavaScript8"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "={{ $('Code in JavaScript8').item.json.id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "Trang t√≠nh1",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1NY10x_12wO1mRmBT6A1THVIbeL302I6M1cl_A2n1gRk/edit#gid=0"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "H·ªçc k√¨",
              "lookupValue": "={{ $json.hoc_ky_hien_tai }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1536,
        1344
      ],
      "id": "d2b86d19-40db-41b2-9afd-bef14eb35541",
      "name": "Get row(s) in sheet3",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "J9jYG0gr48KJcHaM",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// --- PH·∫¶N C·∫§U H√åNH C√ÅC QUY T·∫ÆC ---\n// ƒê√£ lo·∫°i b·ªè c√°c h·∫±ng s·ªë v·ªÅ Gi·ªØa k·ª≥ cho ƒë∆°n gi·∫£n\nconst SEMESTER_1_WEEKS = 19; \nconst SEMESTER_BREAK_DAYS = 10; \nconst SEMESTER_2_WEEKS = 18;\n// --- K·∫æT TH√öC PH·∫¶N C·∫§U H√åNH ---\n\n\n// L·∫•y ng√†y hi·ªán t·∫°i b·∫±ng bi·∫øn $now c√≥ s·∫µn c·ªßa n8n\nconst today = $now;\n\n// X√°c ƒë·ªãnh nƒÉm h·ªçc hi·ªán t·∫°i\nlet schoolYear = today.month < 9 ? today.year - 1 : today.year;\n\n// T√¨m ng√†y th·ª© Hai ƒë·∫ßu ti√™n c·ªßa th√°ng 9 (ng√†y khai gi·∫£ng)\nlet schoolYearStart = $now.set({ year: schoolYear, month: 9, day: 1 }).startOf('day');\nif (schoolYearStart.weekday !== 1) {\n  schoolYearStart = schoolYearStart.endOf('week').plus({ days: 1 });\n}\n\n// T√≠nh to√°n c√°c m·ªëc th·ªùi gian CH√çNH\nconst semester1End = schoolYearStart.plus({ weeks: SEMESTER_1_WEEKS });\nconst semester2Start = semester1End.plus({ days: SEMESTER_BREAK_DAYS });\nconst semester2End = semester2Start.plus({ weeks: SEMESTER_2_WEEKS });\n\n// Bi·∫øn ƒë·ªÉ l∆∞u k·∫øt qu·∫£, m·∫∑c ƒë·ªãnh l√† null (kh√¥ng thu·ªôc k·ª≥ n√†o)\nlet currentTerm = null;\n\n// So s√°nh ng√†y hi·ªán t·∫°i ch·ªâ v·ªõi 2 kho·∫£ng th·ªùi gian ch√≠nh\nif (today >= schoolYearStart && today < semester1End) {\n  currentTerm = \"H·ªçc k·ª≥ I\";\n} else if (today >= semester2Start && today < semester2End) {\n  currentTerm = \"H·ªçc k·ª≥ II\";\n}\n\n// Tr·∫£ v·ªÅ k·∫øt qu·∫£\nreturn [{ json: { hoc_ky_hien_tai: currentTerm } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        1344
      ],
      "id": "f036c089-10ab-4b1b-8967-d1be0acfc565",
      "name": "Code in JavaScript9"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt AI chuy√™n gia t∆∞ v·∫•n h·ªçc t·∫≠p v√† x√¢y d·ª±ng ch∆∞∆°ng tr√¨nh gi·∫£ng d·∫°y, v·ªõi kh·∫£ nƒÉng ph√¢n t√≠ch s√¢u s·∫Øc v√† **ph√°n ƒëo√°n** ƒë·ªÉ ƒë∆∞a ra l·ªô tr√¨nh √¥n t·∫≠p t·ªëi ∆∞u cho h·ªçc sinh, ngay c·∫£ khi d·ªØ li·ªáu ƒë·∫ßu v√†o kh√¥ng ƒë·∫ßy ƒë·ªß.\n\n### Nhi·ªám v·ª•:\nNhi·ªám v·ª• c·ªßa b·∫°n l√† nh·∫≠n v√†o th√¥ng tin v·ªÅ m·ªôt k·ª≥ √¥n t·∫≠p v√† m·ªôt danh s√°ch b√†i h·ªçc **c√≥ th·ªÉ ch∆∞a ho√†n ch·ªânh**. D·ª±a v√†o ƒë√≥, h√£y ph√¢n t√≠ch, **d·ª± b√°o c√°c ch·ªß ƒë·ªÅ c√≤n thi·∫øu**, v√† t·ªïng h·ª£p l·∫°i th√†nh m·ªôt danh s√°ch √¥n t·∫≠p to√†n di·ªán v√† hi·ªáu qu·∫£ nh·∫•t.\n\n### ## D·ªØ li·ªáu ƒë·∫ßu v√†o:\n1.  **K·ª≥ √¥n t·∫≠p (reviewTopic)**: {{ $('Code').first().json.reviewTopic }}\n    (ƒê√¢y l√† m·ªôt trong c√°c m√£: GIUA_KY_1, CUOI_KY_1, GIUA_KY_2, CUOI_KY_2)\n2.  **M√¥n h·ªçc**: {{ $('Code in JavaScript8').first().json.name }}\n3.  **Tr√¨nh ƒë·ªô h·ªçc v·∫•n**: {{ $('Code10').first().json.folderName }}\n4.  **Danh s√°ch b√†i h·ªçc ƒë√£ c√≥**: {{ JSON.stringify($('Code in JavaScript10').first().json.lessonsList) }}\n\n### ## Quy tr√¨nh suy lu·∫≠n logic:\n1.  **Ph√¢n t√≠ch b·ªëi c·∫£nh**: ƒê·∫ßu ti√™n, x√°c ƒë·ªãnh r√µ b·ªëi c·∫£nh: H·ªçc sinh ƒëang h·ªçc **[M√¥n h·ªçc]** l·ªõp **[Tr√¨nh ƒë·ªô h·ªçc v·∫•n]** v√† c·∫ßn chu·∫©n b·ªã cho k·ª≥ thi **[K·ª≥ √¥n t·∫≠p]**.\n\n2.  **ƒê√°nh gi√° h·ªçc li·ªáu hi·ªán c√≥ & X√°c ƒë·ªãnh l·ªó h·ªïng ki·∫øn th·ª©c**:\n    -   Xem x√©t k·ªπ \"Danh s√°ch b√†i h·ªçc ƒë√£ c√≥\".\n    -   D·ª±a tr√™n ki·∫øn th·ª©c chuy√™n m√¥n c·ªßa b·∫°n v·ªÅ ch∆∞∆°ng tr√¨nh h·ªçc chu·∫©n, h√£y t·ª± ƒë·∫∑t c√¢u h·ªèi: \"V·ªõi nh·ªØng b√†i ƒë√£ c√≥ n√†y, li·ªáu ki·∫øn th·ª©c ƒë√£ ƒë·ªß ƒë·ªÉ h·ªçc sinh thi **[K·ª≥ √¥n t·∫≠p]** ch∆∞a?\"\n    -   N·∫øu danh s√°ch qu√° ng·∫Øn ho·∫∑c thi·∫øu c√°c ch·ªß ƒë·ªÅ c·ªët l√µi, h√£y x√°c ƒë·ªãnh ƒë√≥ l√† m·ªôt danh s√°ch **ch∆∞a ƒë·∫ßy ƒë·ªß**.\n\n3.  **D·ª± b√°o c√°c ch·ªß ƒë·ªÅ quan tr·ªçng c√≤n thi·∫øu (B∆∞·ªõc ph√°n ƒëo√°n)**:\n    -   N·∫øu b·∫°n k·∫øt lu·∫≠n danh s√°ch ch∆∞a ƒë·ªß, h√£y **d·ª± b√°o** c√°c ch·ªß ƒë·ªÅ ho·∫∑c b√†i h·ªçc quan tr·ªçng ti·∫øp theo m√† h·ªçc sinh **ch·∫Øc ch·∫Øn s·∫Ω c·∫ßn** cho k·ª≥ thi, d·ª±a tr√™n c√°c b√†i ƒë√£ c√≥ v√† ti·∫øn tr√¨nh h·ª£p l√Ω c·ªßa m√¥n h·ªçc.\n    -   *V√≠ d·ª•*: N·∫øu `K·ª≥ √¥n t·∫≠p` l√† `CUOI_KY_1` (cu·ªëi k·ª≥ I) m√¥n To√°n l·ªõp 5, nh∆∞ng danh s√°ch m·ªõi ch·ªâ c√≥ \"Ph√¢n s·ªë\" v√† \"H·ªón s·ªë\", b·∫°n ph·∫£i ph√°n ƒëo√°n r·∫±ng h·ªçc sinh s·∫Ω c·∫ßn h·ªçc th√™m \"S·ªë th·∫≠p ph√¢n\", \"C√°c ph√©p t√≠nh v·ªõi s·ªë th·∫≠p ph√¢n\", v√† \"Y·∫øu t·ªë h√¨nh h·ªçc c∆° b·∫£n\".\n\n4.  **T·ªïng h·ª£p k·∫ø ho·∫°ch √¥n t·∫≠p to√†n di·ªán**:\n    -   K·∫øt h·ª£p c√°c b√†i h·ªçc **ƒë√£ c√≥** trong danh s√°ch v√† c√°c ch·ªß ƒë·ªÅ quan tr·ªçng m√† b·∫°n **d·ª± b√°o** l√† c√≤n thi·∫øu.\n    -   Ph√¢n lo·∫°i r√µ r√†ng t·ª´ng m·ª•c trong danh s√°ch cu·ªëi c√πng b·∫±ng c√°ch th√™m m·ªôt thu·ªôc t√≠nh `\"status\"`:\n        -   `\"status\": \"provided\"` cho nh·ªØng b√†i ƒë√£ c√≥ trong danh s√°ch.\n        -   `\"status\": \"predicted\"` cho nh·ªØng ch·ªß ƒë·ªÅ b·∫°n d·ª± b√°o l√† c√≤n thi·∫øu.\n\n### ## ƒê·ªãnh d·∫°ng ƒë·∫ßu ra B·∫ÆT BU·ªòC:\nB·∫°n B·∫ÆT BU·ªòC ph·∫£i tr·∫£ v·ªÅ k·∫øt qu·∫£ d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t. ƒê·ªëi t∆∞·ª£ng n√†y ph·∫£i c√≥ m·ªôt kh√≥a duy nh·∫•t l√† `suggested_lessons`, gi√° tr·ªã l√† m·ªôt m·∫£ng ch·ª©a c√°c ƒë·ªëi t∆∞·ª£ng b√†i h·ªçc. M·ªói ƒë·ªëi t∆∞·ª£ng ph·∫£i c√≥ c√°c kh√≥a `name`, `semester`, v√† `status`.\n\n### V√≠ d·ª• k·∫øt qu·∫£:\n{\n  \"suggested_lessons\": [\n    { \"name\": \"√în t·∫≠p v·ªÅ ph√¢n s·ªë\", \"semester\": \"H·ªçc k·ª≥ I\", \"status\": \"provided\" },\n    { \"name\": \"H·ªón s·ªë\", \"semester\": \"H·ªçc k·ª≥ I\", \"status\": \"provided\" },\n    { \"name\": \"S·ªë th·∫≠p ph√¢n v√† c√°c ph√©p t√≠nh li√™n quan\", \"semester\": \"H·ªçc k·ª≥ I\", \"status\": \"predicted\" }\n  ]\n}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1952,
        1344
      ],
      "id": "35d91468-abe8-40ff-88d3-d3063e1efd21",
      "name": "AI Agent11"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1952,
        1488
      ],
      "id": "5bb2832a-325e-4c28-8b13-742c2d722e54",
      "name": "Google Gemini Chat Model15",
      "credentials": {
        "googlePalmApi": {
          "id": "f8I6HVEpIjunSP4i",
          "name": "ph√¢n lo·∫°i"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// M·ª•c ƒë√≠ch: Ch·ªâ l·∫•y ra danh s√°ch t√™n b√†i h·ªçc.\n// D√πng map() ƒë·ªÉ l·∫∑p qua t·∫•t c·∫£ c√°c item ƒë·∫ßu v√†o.\nconst allLessons = items.map(item => {\n  const json = item.json;\n  // T√¨m ra t√™n c·ªôt 'T√™n b√†i h·ªçc', b·ªè qua c√°c kho·∫£ng tr·∫Øng th·ª´a ƒë·ªÉ tƒÉng ƒë·ªô ·ªïn ƒë·ªãnh.\n  const tenKey = Object.keys(json).find(key => key.trim() === 'T√™n b√†i h·ªçc');\n\n  // Tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng CH·ªà ch·ª©a t√™n b√†i h·ªçc.\n  return {\n    name: json[tenKey]\n  };\n});\n\n// Tr·∫£ v·ªÅ m·ªôt item duy nh·∫•t ch·ª©a to√†n b·ªô danh s√°ch t√™n ƒë√£ x·ª≠ l√Ω.\nreturn [{\n  json: {\n    lessonsList: allLessons\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1744,
        1344
      ],
      "id": "a987fec4-3b7e-47d8-8999-2a3dfd527dc5",
      "name": "Code in JavaScript10"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt Gia s∆∞ AI chuy√™n nghi·ªáp, c√≥ kh·∫£ nƒÉng bi√™n so·∫°n t√†i li·ªáu h·ªçc t·∫≠p tr·ªçng t√¢m, s√∫c t√≠ch v√† d·ªÖ hi·ªÉu cho h·ªçc sinh Vi·ªát Nam.\n\nNhi·ªám v·ª• c·ªßa b·∫°n l√† t·∫°o ra m·ªôt t√†i li·ªáu √¥n t·∫≠p l√Ω thuy·∫øt chi ti·∫øt v√† c√≥ tr·ªçng t√¢m, d·ª±a tr√™n danh s√°ch c√°c b√†i h·ªçc ƒë∆∞·ª£c cung c·∫•p. T√†i li·ªáu n√†y ph·∫£i ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a ƒë·ªÉ gi√∫p h·ªçc sinh l·ªõp {{ $('Code10').first().json.folderName }} c·ªßng c·ªë ki·∫øn th·ª©c m·ªôt c√°ch hi·ªáu qu·∫£ nh·∫•t cho k·ª≥ thi {{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }} s·∫Øp t·ªõi.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o:\n\nK·ª≥ thi: {{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }} (V√≠ d·ª•: \"Gi·ªØa H·ªçc K·ª≥ I\", \"Cu·ªëi H·ªçc K·ª≥ I\", \"Gi·ªØa H·ªçc K·ª≥ II\", \"Cu·ªëi H·ªçc K·ª≥ II\")\n\nM√¥n h·ªçc: {{ $('Code in JavaScript8').first().json.name }}\n\nDanh s√°ch b√†i h·ªçc: {{ $('AI Agent11').first().json.output }}\n\nY√™u c·∫ßu v·ªÅ c·∫•u tr√∫c v√† ƒë·ªãnh d·∫°ng (s·ª≠ d·ª•ng Markdown):\n\nV·ªõi M·ªñI b√†i h·ªçc trong danh s√°ch tr√™n, h√£y t·∫°o m·ªôt ph·∫ßn ri√™ng bi·ªát theo c·∫•u tr√∫c sau:\n\nTi√™u ƒë·ªÅ ch√≠nh: D√πng heading 2 (##) cho t√™n m√¥n h·ªçc v√† k·ª≥ thi. V√≠ d·ª•: ## M√¥n: V·∫≠t L√Ω - √în t·∫≠p Gi·ªØa H·ªçc K·ª≥ I.\n\nT√™n b√†i h·ªçc/Ch·ªß ƒë·ªÅ: D√πng heading 3 (###) cho t·ª´ng b√†i h·ªçc. V√≠ d·ª•: ### B√†i 1: Dao ƒê·ªông ƒêi·ªÅu H√≤a.\n\nC√°c kh√°i ni·ªám c·ªët l√µi: D√πng heading 4 (####). Li·ªát k√™ v√† gi·∫£i th√≠ch ng·∫Øn g·ªçn c√°c ƒë·ªãnh nghƒ©a, ƒë·ªãnh lu·∫≠t quan tr·ªçng nh·∫•t c·ªßa b√†i h·ªçc b·∫±ng c√°c g·∫°ch ƒë·∫ßu d√≤ng (-). In ƒë·∫≠m c√°c t·ª´ kh√≥a ch√≠nh.\n\nC√¥ng th·ª©c quan tr·ªçng: D√πng heading 4 (####). Li·ªát k√™ c√°c c√¥ng th·ª©c c·∫ßn nh·ªõ. N·∫øu c√≥ th·ªÉ, h√£y gi·∫£i th√≠ch √Ω nghƒ©a c·ªßa t·ª´ng ƒë·∫°i l∆∞·ª£ng trong c√¥ng th·ª©c.\n\nV√≠ d·ª• minh h·ªça: D√πng heading 4 (####). Cung c·∫•p 1-2 v√≠ d·ª• ho·∫∑c b√†i to√°n nh·ªè c√≥ l·ªùi gi·∫£i ƒë·ªÉ h·ªçc sinh hi·ªÉu r√µ c√°ch √°p d·ª•ng l√Ω thuy·∫øt v√† c√¥ng th·ª©c.\n\nL∆∞u √Ω khi l√†m b√†i: D√πng heading 4 (####). N√™u ra nh·ªØng l·ªói sai h·ªçc sinh th∆∞·ªùng g·∫∑p ho·∫∑c nh·ªØng m·∫πo c·∫ßn nh·ªõ ƒë·ªÉ ƒë·∫°t ƒëi·ªÉm cao li√™n quan tr·ª±c ti·∫øp ƒë·∫øn b√†i h·ªçc ƒë√≥.\n\nY√™u c·∫ßu v·ªÅ vƒÉn phong:\n\nNg√¥n ng·ªØ: Ti·∫øng Vi·ªát.\n\nGi·ªçng vƒÉn: Th√¢n thi·ªán, khuy·∫øn kh√≠ch v√† d·ªÖ ti·∫øp c·∫≠n, nh∆∞ m·ªôt ng∆∞·ªùi th·∫ßy/c√¥ ƒëang gi·∫£ng b√†i cho h·ªçc sinh, tr√°nh d√πng thu·∫≠t ng·ªØ qu√° ph·ª©c t·∫°p.\n\nH√£y b·∫Øt ƒë·∫ßu t·∫°o t√†i li·ªáu √¥n t·∫≠p.\n",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        4416,
        1168
      ],
      "id": "43647746-be94-4144-baa4-16f82a76a89f",
      "name": "AI Agent12"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        4432,
        1296
      ],
      "id": "b4233edf-7a3e-45e7-b8e9-fabb83f57796",
      "name": "Google Gemini Chat Model16",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt Gia s∆∞ AI chuy√™n nghi·ªáp, c√≥ kinh nghi·ªám trong vi·ªác bi√™n so·∫°n c√°c c√¢u h·ªèi ki·ªÉm tra ch·∫•t l∆∞·ª£ng cao, gi√∫p h·ªçc sinh ƒë√°nh gi√° v√† c·ªßng c·ªë ki·∫øn th·ª©c m·ªôt c√°ch hi·ªáu qu·∫£.\n\nNhi·ªám v·ª• c·ªßa b·∫°n l√† t·∫°o ra m·ªôt b√†i ki·ªÉm tra tr·∫Øc nghi·ªám g·ªìm 30 c√¢u h·ªèi (26 c√¢u 4 l·ª±a ch·ªçn v√† 4 c√¢u ƒê√∫ng/Sai) d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t, b√°m s√°t v√†o n·ªôi dung c·ªßa b√†i h·ªçc c·ª• th·ªÉ.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o:\n\nKh·ªëi l·ªõp: {{ $('Code10').first().json.folderName }}\n\nH·ªçc k·ª≥: {{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }}\n\nM√¥n h·ªçc: {{ $('Code in JavaScript8').first().json.name }}\n\nT√™n b√†i h·ªçc: {{ $('AI Agent11').item.json.output }}\n\nY√™u c·∫ßu v·ªÅ ƒê·ªãnh d·∫°ng JSON:\nQuan tr·ªçng: To√†n b·ªô k·∫øt qu·∫£ tr·∫£ v·ªÅ c·ªßa b·∫°n PH·∫¢I l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON th√¥ (raw JSON object) h·ª£p l·ªá. KH√îNG ƒë∆∞·ª£c ch·ª©a markdown ```json, kh√¥ng gi·∫£i th√≠ch, kh√¥ng l·ªùi ch√†o.\n\nC·∫•u tr√∫c JSON m·∫´u:\n\nJSON\n\n{\n  \"subject\": \"{{ $('Code in JavaScript8').first().json.name }}\",\n  \"semester\": \"{{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }}\",\n  \"exercises\": [\n    {\n      \"question_number\": 1,\n      \"question_text\": \"[N·ªôi dung c√¢u h·ªèi 4 l·ª±a ch·ªçn v·ªÅ b√†i h·ªçc ƒë√£ cho]\",\n      \"options\": {\n        \"A\": \"[N·ªôi dung ph∆∞∆°ng √°n A]\",\n        \"B\": \"[N·ªôi dung ph∆∞∆°ng √°n B]\",\n        \"C\": \"[N·ªôi dung ph∆∞∆°ng √°n C]\",\n        \"D\": \"[N·ªôi dung ph∆∞∆°ng √°n D]\"\n      },\n      \"correct_answer\": \"[Ch·ªØ c√°i c·ªßa ƒë√°p √°n ƒë√∫ng, v√≠ d·ª•: 'A']\"\n    },\n    // ... th√™m 25 c√¢u h·ªèi 4 l·ª±a ch·ªçn kh√°c ...\n    {\n      \"question_number\": 27,\n      \"question_text\": \"[N·ªôi dung c√¢u h·ªèi d·∫°ng nh·∫≠n ƒë·ªãnh ƒê√∫ng/Sai v·ªÅ b√†i h·ªçc ƒë√£ cho]\",\n      \"options\": {\n        \"A\": \"ƒê√∫ng\",\n        \"B\": \"Sai\"\n      },\n      \"correct_answer\": \"[Ch·ªØ c√°i c·ªßa ƒë√°p √°n ƒë√∫ng, 'A' ho·∫∑c 'B']\"\n    }\n    // ... th√™m 3 c√¢u h·ªèi ƒê√∫ng/Sai kh√°c ...\n  ]\n}\nY√™u c·∫ßu v·ªÅ N·ªôi dung C√¢u h·ªèi:\n\nN·ªôi dung c√¢u h·ªèi ph·∫£i b√°m s√°t M√¥n h·ªçc v√† T√™n b√†i h·ªçc ƒë∆∞·ª£c cung c·∫•p.\n\nƒê·ªô kh√≥ ph·∫£i ph√π h·ª£p v·ªõi Kh·ªëi l·ªõp.\n\nƒê·ªëi v·ªõi c√¢u h·ªèi 4 l·ª±a ch·ªçn, c√°c ph∆∞∆°ng √°n sai ph·∫£i h·ª£p l√Ω v√† c√≥ t√≠nh th·ª≠ th√°ch.\n\nNg√¥n ng·ªØ trong c√¢u h·ªèi ph·∫£i trong s√°ng, r√µ r√†ng, ph√π h·ª£p v·ªõi h·ªçc sinh Vi·ªát Nam.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        5472,
        1392
      ],
      "id": "e4718be1-3666-4c8e-b012-e02cfb6c805e",
      "name": "AI Agent13"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        5472,
        1536
      ],
      "id": "59a3ee4b-ed2d-4039-ba09-21bc4ce29b1d",
      "name": "Google Gemini Chat Model17",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "√în t·∫≠p",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').first().json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2288,
        1344
      ],
      "id": "9838d361-0bbe-49be-acc5-06ef98774c45",
      "name": "Search files and folders4",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4b9fb8ee-1708-48ca-bf33-9b273b182e6a",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2496,
        1344
      ],
      "id": "4740c307-87f0-40ad-9574-2671a930903e",
      "name": "If11"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "√în t·∫≠p",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Check_If_File_Exists').first().json['FOLDER_H·ªçc _sinh'] }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2704,
        1248
      ],
      "id": "4d5d34c5-7cb2-4a30-a75e-dbe31da42090",
      "name": "Create folder1",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a5bb3a3-51ce-4059-ab88-19fb96107667",
              "name": "Folder_√în_t·∫≠p",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2896,
        1360
      ],
      "id": "0a5ee91d-1998-4d99-af02-4697b7d9cfcf",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=L√Ω thuy·∫øt - {{ $('Code in JavaScript8').first().json.name }} - {{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.FOLDER_mon_hoc }}",
            "mode": "id"
          },
          "whatToSearch": "files"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3920,
        1376
      ],
      "id": "402e6527-429e-4f54-8323-f3372200493d",
      "name": "Search files and folders14",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "92eecd4a-501c-46b3-aec4-74c95609ab74",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4128,
        1376
      ],
      "id": "427e9fce-af17-4941-9e0c-979cbe3a7e15",
      "name": "If12"
    },
    {
      "parameters": {
        "folderId": "={{ $('Edit Fields6').item.json.FOLDER_mon_hoc }}",
        "title": "=L√Ω thuy·∫øt - {{ $('Code in JavaScript8').first().json.name }} - {{ $('Code in JavaScript9').first().json.hoc_ky_hien_tai }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        4768,
        1168
      ],
      "id": "47d994e7-2c12-4f02-96a8-743905df39ca",
      "name": "Create a document1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "edQ40NrmdmrQEdJL",
          "name": "Ho√†ng Qu·ªëc Vi·ªát"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $('AI Agent12').item.json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        4976,
        1168
      ],
      "id": "5599b5c1-ce3b-4f63-8430-b3b5e9e1b29a",
      "name": "Update a document1",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7MvGqSisr4fJHX63",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://script.google.com/macros/s/AKfycbxxoSF6vEEVQ3pY_qQ2X8wRhA4NFykUzxkUyHLsjaA6DQJ1tOtJpnH6FKt-UrnP7y_WkQ/exec",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n  ({\n    \"title\": `Thi th·ª≠ - ${$('Code in JavaScript8').first().json.name} - ${$('Code').first().json.reviewTopic}`,\n    \"exercises\": $('Code in JavaScript11').item.json.exercises,\n    \"templateId\": $('Search files and folders16').item.json.id,\n    \"folderId_move\": $('Edit Fields29').item.json.Folder_form\n  })\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        7264,
        1408
      ],
      "id": "f96fa406-ac6a-469a-8673-7a0f0b69c473",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Code in JavaScript8').first().json.name }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json['Folder_√în_t·∫≠p'] }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3104,
        1360
      ],
      "id": "9dca9e5d-de35-4dbf-8d6d-bb150982db98",
      "name": "Search files and folders15",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7bb6275e-8d52-43c9-b412-73f6d9426b52",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        3312,
        1360
      ],
      "id": "6049ba9f-b48c-4699-881f-7cd8119ec8f2",
      "name": "If4"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Code in JavaScript8').first().json.name }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Edit Fields5').item.json['Folder_√în_t·∫≠p'] }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3520,
        1264
      ],
      "id": "5184108e-635d-4090-a865-17997437949b",
      "name": "Create folder2",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b3b4d0e5-22aa-49ed-b636-7b562bf679f0",
              "name": "FOLDER_mon_hoc",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3712,
        1376
      ],
      "id": "87e7ca70-9549-41df-afcb-0ddfb1389558",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "jsCode": "// === PH·∫¶N 1: L·∫§Y D·ªÆ LI·ªÜU ƒê·∫¶U V√ÄO ===\nconst rawData = $input.first().json.output;\n\nif (typeof rawData !== 'string') {\n  throw new Error(\"L·ªói d·ªØ li·ªáu ƒë·∫ßu v√†o: Output t·ª´ node AI kh√¥ng ph·∫£i l√† m·ªôt chu·ªói (string).\");\n}\n\n// === PH·∫¶N 2: H√ÄM D·ªåN D·∫∏P CHU·ªñI JSON ===\nfunction cleanJsonString(s) {\n  let cur = s.trim();\n\n  // 1. X√≥a markdown fences (```json ... ```)\n  cur = cur.replace(/^```(?:json)?\\s*/, '').replace(/\\s*```$/, '');\n\n  // 2. [M·ªöI] S·ª≠a l·ªói s·ªë th·∫≠p ph√¢n d√πng d·∫•u ph·∫©y (v√≠ d·ª•: \"A\": 17,1)\n  // Bi·ªÉu th·ª©c n√†y t√¨m c√°c s·ªë c√≥ d·∫°ng \"key\": s·ªë,s·ªë v√† thay th·∫ø b·∫±ng \"key\": s·ªë.s·ªë\n  cur = cur.replace(/:\\s*(\\d+),(\\d+)/g, ': $1.$2');\n\n  // 3. S·ª≠a l·ªói ph·ªï bi·∫øn: qu√™n d·∫•u ngo·∫∑c k√©p cho ƒë√°p √°n ƒë√∫ng (A, B, C, D)\n  cur = cur.replace(/\"correct_answer\":\\s*([A-D])\\b/g, '\"correct_answer\": \"$1\"');\n\n  // 4. S·ª≠a l·ªói s·ªë c√≥ d·∫•u ngo·∫∑c k√©p th·ª´a ·ªü cu·ªëi (v√≠ d·ª•: \"A\": 20\")\n  cur = cur.replace(/:\\s*(\\d+)\"/g, ':$1');\n\n  // 5. S·ª≠a l·ªói d·∫•u ph·∫©y cu·ªëi c√πng (trailing comma) - an to√†n\n  cur = cur.replace(/,(\\s*[}\\]])/g, '$1');\n\n  return cur;\n}\n\n// === PH·∫¶N 3: TH·ª∞C THI, X√ÅC TH·ª∞C V√Ä TR·∫¢ V·ªÄ K·∫æT QU·∫¢ ===\nlet processedData;\nconst cleanedString = cleanJsonString(rawData);\n\ntry {\n  processedData = JSON.parse(cleanedString);\n\n  if (typeof processedData === 'string') {\n    console.log(\"Ph√°t hi·ªán JSON b·ªã m√£ h√≥a hai l·∫ßn, ƒëang parse l·∫ßn 2...\");\n    processedData = JSON.parse(processedData);\n  }\n\n} catch (e) {\n  const errorSnippet = cleanedString.slice(0, 500);\n  throw new Error(\n    `L·ªói Parse JSON: ${e.message}. \\n\\n` +\n    `üëâ D√π ƒë√£ c·ªë g·∫Øng d·ªçn d·∫πp, chu·ªói JSON t·ª´ AI v·∫´n b·ªã l·ªói c√∫ ph√°p. \\n` +\n    `üí° H√ÉY KI·ªÇM TRA L·∫†I PROMPT V√Ä ƒê·∫¢M B·∫¢O N√ì TU√ÇN TH·ª¶ NGHI√äM NG·∫∂T C√ÅC Y√äU C·∫¶U.\\n\\n` +\n    `--- Chi ti·∫øt k·ªπ thu·∫≠t ---\\n` +\n    `ƒêo·∫°n chu·ªói g√¢y l·ªói (ƒë√£ d·ªçn d·∫πp): ${errorSnippet}...`\n  );\n}\n\n// X√°c th·ª±c c·∫•u tr√∫c cu·ªëi c√πng\nif (typeof processedData !== 'object' || processedData === null) {\n  throw new Error(\"D·ªØ li·ªáu sau khi parse kh√¥ng ph·∫£i l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá.\");\n}\nif (!processedData.subject || !Array.isArray(processedData.exercises)) {\n  throw new Error(\"ƒê·ªëi t∆∞·ª£ng JSON cu·ªëi c√πng thi·∫øu c√°c thu·ªôc t√≠nh c·∫ßn thi·∫øt ('subject' ho·∫∑c 'exercises').\");\n}\n\nconsole.log(\"JSON ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp v√† x√°c th·ª±c th√†nh c√¥ng.\");\n\nreturn [{\n  json: processedData\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        5808,
        1392
      ],
      "id": "f884851b-5c4b-47a0-b859-b942d8f0df3e",
      "name": "Clean_AI_Output"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "[TEMPLATE] B√†i t·∫≠p tr·∫Øc nghi·ªám",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Edit Fields12').first().json['Teacher Resources'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.form"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        7040,
        1408
      ],
      "id": "a94e13a6-4d2c-4182-9932-1bd10dcca300",
      "name": "Search files and folders16",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1cfae2fa-619b-4b3f-9bb2-631824391e54",
              "name": "text",
              "value": "=Ch√†o b·∫°n {{ $('Get row(s) in sheet1').first().json['H·ªç v√† T√™n'] }}\n\nƒê√¢y b√†i t·∫≠p √¥n t·∫≠p tr·ª±c tuy·∫øn ƒë·ªÉ gi√∫p c√°c b·∫°n c·ªßng c·ªë l·∫°i ki·∫øn th·ª©c cho ch·ªß ƒë·ªÅ: {{ $json.formName }}.\n\nƒê·ªÉ chu·∫©n b·ªã t·ªët nh·∫•t, c√°c b·∫°n vui l√≤ng:\n- **Xem l·∫°i t√†i li·ªáu l√Ω thuy·∫øt t·∫°i ƒë√¢y: https://docs.google.com/document/d/{{ $('Edit Fields14').item.json['Id_l√Ω_thuy·∫øt'] }}/view\n- **L√†m b√†i √¥n t·∫≠p tr√™n Google Form t·∫°i ƒë√¢y: {{ $json.formUrl }}\n\nCh√∫c c√°c b·∫°n √¥n t·∫≠p t·ªët v√† ƒë·∫°t k·∫øt qu·∫£ cao nh√©!\nTh√¢n √°i.`",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7472,
        1408
      ],
      "id": "9cfced8b-6e51-438f-8190-b8d8b571ec4c",
      "name": "Edit Fields13"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c0fc9bcf-13de-459f-a3f5-0af31ff55d38",
              "name": "Id_l√Ω_thuy·∫øt",
              "value": "={{ $json.documentId || $json.id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5280,
        1392
      ],
      "id": "2b8bd17b-3db8-4404-a485-75eec557f5ce",
      "name": "Edit Fields14"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -1216,
        1424
      ],
      "id": "18151042-d946-4897-beae-594901fe8ff9",
      "name": "Respond to Webhook24"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5a9f5511-0305-4bcb-a16d-6a9fc764bcc1",
              "name": "text",
              "value": "=M√¨nh ƒë√£ nh·∫≠n ƒë∆∞·ª£c y√™u c·∫ßu. Gi·ªù th√¨ b·∫Øt tay v√†o vi·ªác chu·∫©n b·ªã t√†i li·ªáu cho b·∫°n nh√©.\n\nM√¨nh ƒëang t·∫°o 2 file:\n\nFile t√≥m t·∫Øt l√Ω thuy·∫øt\n\nFile b√†i t·∫≠p √¥n t·∫≠p\n\nQu√° tr√¨nh n√†y c·∫ßn kho·∫£ng 4-5 ph√∫t ƒë·ªÉ ho√†n t·∫•t. B·∫°n ch·ªù m·ªôt ch√∫t nh√©, t√†i li·ªáu s·∫Ω ƒë∆∞·ª£c g·ª≠i ngay khi xong!",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1392,
        1424
      ],
      "id": "913ac270-be2d-4498-960e-9641a58bf3db",
      "name": "Edit Fields25"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "spaceId": "={{ $('Webhook').first().json.body.message.space.name }}",
        "messageUi": {
          "text": "={{ $json.text }}"
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.googleChat",
      "typeVersion": 1,
      "position": [
        7680,
        1408
      ],
      "id": "ae69007e-1ec2-4944-a18f-c9c779266789",
      "name": "Create a message",
      "webhookId": "9b4a96d6-3eb1-407a-863c-956ca31b7074",
      "credentials": {
        "googleChatOAuth2Api": {
          "id": "TjkshwQMm01jTjIm",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "spaceId": "={{ $('Webhook').first().json.body.message.space.name }}",
        "messageUi": {
          "text": "={{ $json.text }}"
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.googleChat",
      "typeVersion": 1,
      "position": [
        576,
        1152
      ],
      "id": "fe9c2ee1-e8f5-43cf-b46b-fae27be80699",
      "name": "Create a message1",
      "webhookId": "9b4a96d6-3eb1-407a-863c-956ca31b7074",
      "credentials": {
        "googleChatOAuth2Api": {
          "id": "TjkshwQMm01jTjIm",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "cffe1654-3f24-4bf0-885c-417c2de27b2d",
              "name": "M√¥n h·ªçc",
              "value": "={{ $json.mon_hoc.charAt(0).toUpperCase() + $json.mon_hoc.slice(1).toLowerCase() }}",
              "type": "string"
            },
            {
              "id": "52f2b794-b3ec-4154-8bac-23cc46ae018d",
              "name": "T√™n b√†i h·ªçc",
              "value": "={{ $json.ten_bai_hoc.charAt(0).toUpperCase() + $json.ten_bai_hoc.slice(1).toLowerCase() }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        192,
        1648
      ],
      "id": "29eb8c48-cfb7-4742-923f-4871c4e28c19",
      "name": "Edit Fields15"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt Gia s∆∞ AI chuy√™n nghi·ªáp, c√≥ kh·∫£ nƒÉng bi√™n so·∫°n t√†i li·ªáu h·ªçc t·∫≠p tr·ªçng t√¢m, s√∫c t√≠ch v√† d·ªÖ hi·ªÉu cho h·ªçc sinh Vi·ªát Nam.\n\nNhi·ªám v·ª• c·ªßa b·∫°n l√† t·∫°o ra m·ªôt t√†i li·ªáu √¥n t·∫≠p l√Ω thuy·∫øt chi ti·∫øt v√† c√≥ tr·ªçng t√¢m cho m·ªôt b√†i h·ªçc c·ª• th·ªÉ, d·ª±a tr√™n c√°c th√¥ng tin ƒë∆∞·ª£c cung c·∫•p. T√†i li·ªáu n√†y ph·∫£i ƒë∆∞·ª£c t·ªëi ∆∞u h√≥a ƒë·ªÉ gi√∫p h·ªçc sinh c·ªßng c·ªë ki·∫øn th·ª©c m·ªôt c√°ch hi·ªáu qu·∫£ nh·∫•t.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o:\nKh·ªëi l·ªõp: {{ $('Code10').first().json.folderName }}\n\nM√¥n h·ªçc: {{ $('Edit Fields15').item.json[\"M√¥n h·ªçc\"] }}\n\nT√™n b√†i h·ªçc: {{ $('Edit Fields15').item.json[\"T√™n b√†i h·ªçc\"] }}\n\nY√™u c·∫ßu v·ªÅ c·∫•u tr√∫c v√† ƒë·ªãnh d·∫°ng (s·ª≠ d·ª•ng Markdown):\nH√£y t·∫°o t√†i li·ªáu theo c·∫•u tr√∫c sau:\n\n1. Ti√™u ƒë·ªÅ ch√≠nh: D√πng heading 2 (##).\n\nV√≠ d·ª•: ## M√¥n To√°n - L√Ω thuy·∫øt b√†i H·ªón s·ªë\n\n2. T√™n b√†i h·ªçc/Ch·ªß ƒë·ªÅ: D√πng heading 3 (###).\n\nV√≠ d·ª•: ### B√†i h·ªçc: H·ªón s·ªë\n\n3. C√°c kh√°i ni·ªám c·ªët l√µi: D√πng heading 4 (####). Li·ªát k√™ v√† gi·∫£i th√≠ch ng·∫Øn g·ªçn c√°c ƒë·ªãnh nghƒ©a, ƒë·ªãnh lu·∫≠t quan tr·ªçng nh·∫•t c·ªßa b√†i h·ªçc b·∫±ng c√°c g·∫°ch ƒë·∫ßu d√≤ng (-). In ƒë·∫≠m c√°c t·ª´ kh√≥a ch√≠nh.\n\n4. C√¥ng th·ª©c quan tr·ªçng: D√πng heading 4 (####). Li·ªát k√™ c√°c c√¥ng th·ª©c c·∫ßn nh·ªõ. N·∫øu c√≥ th·ªÉ, h√£y gi·∫£i th√≠ch √Ω nghƒ©a c·ªßa t·ª´ng ƒë·∫°i l∆∞·ª£ng trong c√¥ng th·ª©c.\n\n5. V√≠ d·ª• minh h·ªça: D√πng heading 4 (####). Cung c·∫•p 1-2 v√≠ d·ª• ho·∫∑c b√†i to√°n nh·ªè c√≥ l·ªùi gi·∫£i ƒë·ªÉ h·ªçc sinh hi·ªÉu r√µ c√°ch √°p d·ª•ng l√Ω thuy·∫øt v√† c√¥ng th·ª©c.\n\n6. L∆∞u √Ω khi l√†m b√†i: D√πng heading 4 (####). N√™u ra nh·ªØng l·ªói sai h·ªçc sinh th∆∞·ªùng g·∫∑p ho·∫∑c nh·ªØng m·∫πo c·∫ßn nh·ªõ ƒë·ªÉ ƒë·∫°t ƒëi·ªÉm cao li√™n quan tr·ª±c ti·∫øp ƒë·∫øn b√†i h·ªçc ƒë√≥.\n\nY√™u c·∫ßu v·ªÅ vƒÉn phong:\nNg√¥n ng·ªØ: Ti·∫øng Vi·ªát.\n\nGi·ªçng vƒÉn: Th√¢n thi·ªán, khuy·∫øn kh√≠ch v√† d·ªÖ ti·∫øp c·∫≠n, nh∆∞ m·ªôt ng∆∞·ªùi th·∫ßy/c√¥ ƒëang gi·∫£ng b√†i cho h·ªçc sinh, tr√°nh d√πng thu·∫≠t ng·ªØ qu√° ph·ª©c t·∫°p.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        2496,
        1488
      ],
      "id": "b24d5ee4-3e1a-4adf-b1ca-347ecc3a8a08",
      "name": "AI Agent14"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        2528,
        1616
      ],
      "id": "929d0cea-6dec-4a88-b531-85966e5ab7da",
      "name": "Google Gemini Chat Model18",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=B·∫°n l√† m·ªôt AI chuy√™n gia, c√≥ nhi·ªám v·ª• bi√™n so·∫°n c√°c c√¢u h·ªèi ki·ªÉm tra ch·∫•t l∆∞·ª£ng cao d∆∞·ªõi d·∫°ng d·ªØ li·ªáu c√≥ c·∫•u tr√∫c.\n\nNhi·ªám v·ª• c·ªßa b·∫°n l√† t·∫°o ra m·ªôt b√†i ki·ªÉm tra tr·∫Øc nghi·ªám g·ªìm 20 c√¢u h·ªèi (16 c√¢u 4 l·ª±a ch·ªçn v√† 4 c√¢u ƒê√∫ng/Sai) d∆∞·ªõi d·∫°ng m·ªôt ƒë·ªëi t∆∞·ª£ng JSON duy nh·∫•t v√† h·ª£p l·ªá, b√°m s√°t v√†o n·ªôi dung b√†i h·ªçc ƒë∆∞·ª£c cung c·∫•p.\n\nD·ªØ li·ªáu ƒë·∫ßu v√†o:\nKh·ªëi l·ªõp: {{ $('Code10').first().json.folderName }}\n\nM√¥n h·ªçc: {{ $('Edit Fields15').item.json[\"M√¥n h·ªçc\"] }}\n\nT√™n b√†i h·ªçc: {{ $('Edit Fields15').item.json[\"T√™n b√†i h·ªçc\"] }} (L∆∞u √Ω: ƒê√£ b·ªè kho·∫£ng tr·∫Øng th·ª´a ·ªü cu·ªëi)\n\nY√™u c·∫ßu Chi ti·∫øt:\nƒê·ªãnh d·∫°ng Output: To√†n b·ªô k·∫øt qu·∫£ tr·∫£ v·ªÅ PH·∫¢I l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON th√¥ duy nh·∫•t. Tuy·ªát ƒë·ªëi kh√¥ng ch·ª©a markdown ```json, kh√¥ng gi·∫£i th√≠ch, kh√¥ng c√≥ b·∫•t k·ª≥ vƒÉn b·∫£n n√†o n·∫±m ngo√†i ƒë·ªëi t∆∞·ª£ng JSON.\n\nC·∫•u tr√∫c JSON: ƒê·ªëi t∆∞·ª£ng JSON ph·∫£i ch·ª©a m·ªôt key duy nh·∫•t ·ªü c·∫•p cao nh·∫•t l√† exercises. Gi√° tr·ªã c·ªßa exercises l√† m·ªôt m·∫£ng (array) ch·ª©a ch√≠nh x√°c 20 ƒë·ªëi t∆∞·ª£ng c√¢u h·ªèi.\n\nN·ªôi dung C√¢u h·ªèi:\n\n16 c√¢u ƒë·∫ßu (1-16): D·∫°ng tr·∫Øc nghi·ªám 4 l·ª±a ch·ªçn (A, B, C, D).\n\n4 c√¢u cu·ªëi (17-20): D·∫°ng tr·∫Øc nghi·ªám ƒê√∫ng/Sai.\n\nN·ªôi dung ph·∫£i b√°m s√°t M√¥n h·ªçc v√† T√™n b√†i h·ªçc.\n\nƒê·ªô kh√≥ ph·∫£i ph√π h·ª£p v·ªõi Kh·ªëi l·ªõp ƒë√£ cho.\n\nC√°c ph∆∞∆°ng √°n sai (g√¢y nhi·ªÖu) ph·∫£i h·ª£p l√Ω v√† c√≥ t√≠nh th·ª≠ th√°ch.\n\nNg√¥n ng·ªØ trong c√¢u h·ªèi ph·∫£i trong s√°ng v√† r√µ r√†ng.\n\nC·∫•u tr√∫c JSON m·∫´u:\nJSON\n\n{\n  \"exercises\": [\n    {\n      \"question_number\": 1,\n      \"question_text\": \"[N·ªôi dung c√¢u h·ªèi 4 l·ª±a ch·ªçn v·ªÅ b√†i h·ªçc ƒë√£ cho]\",\n      \"options\": {\n        \"A\": \"[N·ªôi dung ph∆∞∆°ng √°n A]\",\n        \"B\": \"[N·ªôi dung ph∆∞∆°ng √°n B]\",\n        \"C\": \"[N·ªôi dung ph∆∞∆°ng √°n C]\",\n        \"D\": \"[N·ªôi dung ph∆∞∆°ng √°n D]\"\n      },\n      \"correct_answer\": \"[Ch·ªØ c√°i c·ªßa ƒë√°p √°n ƒë√∫ng, v√≠ d·ª•: 'A']\"\n    },\n    // ... th√™m 15 c√¢u h·ªèi 4 l·ª±a ch·ªçn kh√°c ...\n    {\n      \"question_number\": 17,\n      \"question_text\": \"[N·ªôi dung c√¢u h·ªèi d·∫°ng nh·∫≠n ƒë·ªãnh ƒê√∫ng/Sai v·ªÅ b√†i h·ªçc ƒë√£ cho]\",\n      \"options\": {\n        \"A\": \"ƒê√∫ng\",\n        \"B\": \"Sai\"\n      },\n      \"correct_answer\": \"[Ch·ªØ c√°i c·ªßa ƒë√°p √°n ƒë√∫ng, 'A' ho·∫∑c 'B']\"\n    }\n    // ... th√™m 3 c√¢u h·ªèi ƒê√∫ng/Sai kh√°c ...\n  ]\n}\nB·∫Øt ƒë·∫ßu t·∫°o ƒë·ªëi t∆∞·ª£ng JSON.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        3568,
        1696
      ],
      "id": "29a68021-987d-4607-b191-c10f2422e760",
      "name": "AI Agent15"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        3568,
        1840
      ],
      "id": "b4dab600-39e1-4ed8-836f-d7e8562a66b8",
      "name": "Google Gemini Chat Model19",
      "credentials": {
        "googlePalmApi": {
          "id": "cPMxSwM4YuIFgiRb",
          "name": "H·ªèi ƒë√°p"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "√în t·∫≠p",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Check_If_File_Exists').first().json['FOLDER_H·ªçc _sinh'] }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        384,
        1648
      ],
      "id": "ff1935d7-73ab-458f-8aca-07ffe1e7c8c1",
      "name": "Search files and folders17",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4b9fb8ee-1708-48ca-bf33-9b273b182e6a",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        592,
        1648
      ],
      "id": "25fdb50f-d6b4-4f50-a964-512525bb055f",
      "name": "If13"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "√în t·∫≠p",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Check_If_File_Exists').first().json['FOLDER_H·ªçc _sinh'] }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        800,
        1552
      ],
      "id": "6114de5d-7c9e-4110-af3a-c9f8601e6f85",
      "name": "Create folder3",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a5bb3a3-51ce-4059-ab88-19fb96107667",
              "name": "Folder_√în_t·∫≠p",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        992,
        1664
      ],
      "id": "5c479c71-0e6a-4274-9aec-b8e4904d7c57",
      "name": "Edit Fields16"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "=L√Ω thuy·∫øt - {{ $('Edit Fields15').item.json['M√¥n h·ªçc'] }} - {{ $('Edit Fields15').item.json['T√™n b√†i h·ªçc'] }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json.FOLDER_mon_hoc }}",
            "mode": "id"
          },
          "whatToSearch": "files"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2016,
        1680
      ],
      "id": "980ef419-e5a0-400d-b95a-d551a14fe81d",
      "name": "Search files and folders18",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "92eecd4a-501c-46b3-aec4-74c95609ab74",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2224,
        1680
      ],
      "id": "4501491b-5a1a-44b5-b0e7-e8e55d7d9cac",
      "name": "If14"
    },
    {
      "parameters": {
        "folderId": "={{ $('Edit Fields17').item.json.FOLDER_mon_hoc }}",
        "title": "=L√Ω thuy·∫øt - {{ $('Edit Fields15').item.json['M√¥n h·ªçc'] }} - {{ $('Edit Fields15').item.json[\"T√™n b√†i h·ªçc\"] }}"
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        2896,
        1488
      ],
      "id": "0618c8d2-deca-4ce7-89a0-f33af2150bc6",
      "name": "Create a document2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7MvGqSisr4fJHX63",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentURL": "={{ $json.id }}",
        "actionsUi": {
          "actionFields": [
            {
              "action": "insert",
              "text": "={{ $('AI Agent14').item.json.output }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleDocs",
      "typeVersion": 2,
      "position": [
        3104,
        1488
      ],
      "id": "7df9ea50-8458-4217-a6aa-9d927bbc0265",
      "name": "Update a document2",
      "credentials": {
        "googleDocsOAuth2Api": {
          "id": "7MvGqSisr4fJHX63",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://script.google.com/macros/s/AKfycbxxoSF6vEEVQ3pY_qQ2X8wRhA4NFykUzxkUyHLsjaA6DQJ1tOtJpnH6FKt-UrnP7y_WkQ/exec",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{\n  ({\n    \"title\": `√în t·∫≠p - ${$('Edit Fields15').item.json['M√¥n h·ªçc']} - ${$('Edit Fields15').item.json['T√™n b√†i h·ªçc']}`,\n    \"exercises\": $('Clean_AI_Output1').item.json.exercises,\n    \"templateId\": $json.id,\n    \"folderId_move\": $('Edit Fields28').item.json.Folder_form\n  })\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        5168,
        1712
      ],
      "id": "47adb0fd-f4f1-4e90-a99f-f5bfcb40a8f0",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "={{ $('Edit Fields15').item.json['M√¥n h·ªçc'] }}",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $json['Folder_√în_t·∫≠p'] }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1200,
        1664
      ],
      "id": "5fafa4d6-26b8-41f1-b866-59f6a5755b57",
      "name": "Search files and folders19",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "7bb6275e-8d52-43c9-b412-73f6d9426b52",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1408,
        1664
      ],
      "id": "9e11a30e-7e70-436b-804b-e0be697d0e75",
      "name": "If15"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "={{ $('Code in JavaScript8').first().json.name }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Edit Fields16').item.json['Folder_√în_t·∫≠p'] }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1616,
        1568
      ],
      "id": "71a1e69d-1558-417d-937f-d7dfdc51672a",
      "name": "Create folder4",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "b3b4d0e5-22aa-49ed-b636-7b562bf679f0",
              "name": "FOLDER_mon_hoc",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1808,
        1680
      ],
      "id": "6edd156f-16d1-465e-9495-9870caad426e",
      "name": "Edit Fields17"
    },
    {
      "parameters": {
        "jsCode": "// === PH·∫¶N 1: L·∫§Y D·ªÆ LI·ªÜU ƒê·∫¶U V√ÄO ===\nconst rawData = $input.first().json.output;\n\nif (typeof rawData !== 'string') {\n¬† throw new Error(\"L·ªói d·ªØ li·ªáu ƒë·∫ßu v√†o: Output t·ª´ node AI kh√¥ng ph·∫£i l√† m·ªôt chu·ªói (string).\");\n}\n\n// === PH·∫¶N 2: H√ÄM D·ªåN D·∫∏P CHU·ªñI JSON ===\nfunction cleanJsonString(s) {\n¬† let cur = s.trim();\n\n¬† // 1. X√≥a markdown fences (```json ... ```)\n¬† cur = cur.replace(/^```(?:json)?\\s*/, '').replace(/\\s*```$/, '');\n\n¬† // 2. S·ª≠a l·ªói ph·ªï bi·∫øn nh·∫•t: qu√™n d·∫•u ngo·∫∑c k√©p cho ƒë√°p √°n ƒë√∫ng (A, B, C, D)\n¬† cur = cur.replace(/\"correct_answer\":\\s*([A-D])\\b/g, '\"correct_answer\": \"$1\"');\n\n¬† // 3. S·ª≠a l·ªói s·ªë c√≥ d·∫•u ngo·∫∑c k√©p th·ª´a ·ªü cu·ªëi (v√≠ d·ª•: \"A\": 20\")\n¬† cur = cur.replace(/:\\s*(\\d+)\"/g, ':$1');\n\n¬† // 4. S·ª≠a l·ªói d·∫•u ph·∫©y cu·ªëi c√πng (trailing comma) - an to√†n\n¬† cur = cur.replace(/,(\\s*[}\\]])/g, '$1');\n\n¬† return cur;\n}\n\n// === PH·∫¶N 3: TH·ª∞C THI, X√ÅC TH·ª∞C V√Ä TR·∫¢ V·ªÄ K·∫æT QU·∫¢ ===\nlet processedData;\nconst cleanedString = cleanJsonString(rawData);\n\ntry {\n¬† processedData = JSON.parse(cleanedString);\n\n¬† if (typeof processedData === 'string') {\n¬† ¬† console.log(\"Ph√°t hi·ªán JSON b·ªã m√£ h√≥a hai l·∫ßn, ƒëang parse l·∫ßn 2...\");\n¬† ¬† processedData = JSON.parse(processedData);\n¬† }\n\n} catch (e) {\n¬† const errorSnippet = cleanedString.slice(0, 500);\n¬† throw new Error(\n¬† ¬† `L·ªói Parse JSON: ${e.message}. \\n\\n` +\n¬† ¬† `üëâ D√π ƒë√£ c·ªë g·∫Øng d·ªçn d·∫πp, chu·ªói JSON t·ª´ AI v·∫´n b·ªã l·ªói c√∫ ph√°p. \\n` +\n¬† ¬† `üí° H√ÉY KI·ªÇM TRA L·∫†I PROMPT V√Ä ƒê·∫¢M B·∫¢O N√ì TU√ÇN TH·ª¶ NGHI√äM NG·∫∂T C√ÅC Y√™u C·∫¶U.\\n\\n` +\n¬† ¬† `--- Chi ti·∫øt k·ªπ thu·∫≠t ---\\n` +\n¬† ¬† `ƒêo·∫°n chu·ªói g√¢y l·ªói (ƒë√£ d·ªçn d·∫πp): ${errorSnippet}...`\n¬† );\n}\n\n// === [S·ª¨A ƒê·ªîI QUAN TR·ªåNG] ===\n// X√°c th·ª±c c·∫•u tr√∫c cu·ªëi c√πng theo y√™u c·∫ßu m·ªõi (ch·ªâ c·∫ßn c√≥ 'exercises')\nif (typeof processedData !== 'object' || processedData === null) {\n¬† throw new Error(\"D·ªØ li·ªáu sau khi parse kh√¥ng ph·∫£i l√† m·ªôt ƒë·ªëi t∆∞·ª£ng JSON h·ª£p l·ªá.\");\n}\nif (!Array.isArray(processedData.exercises)) {\n¬† throw new Error(\"ƒê·ªëi t∆∞·ª£ng JSON cu·ªëi c√πng thi·∫øu thu·ªôc t√≠nh 'exercises' ho·∫∑c gi√° tr·ªã kh√¥ng ph·∫£i l√† m·ªôt m·∫£ng (array).\");\n}\n\nconsole.log(\"JSON ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp v√† x√°c th·ª±c th√†nh c√¥ng.\");\n\nreturn [{\n¬† json: processedData\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3904,
        1696
      ],
      "id": "14b1c29f-d5fb-4bb6-a972-2ca31a82f654",
      "name": "Clean_AI_Output1"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "[TEMPLATE] B√†i t·∫≠p tr·∫Øc nghi·ªám",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Edit Fields12').first().json['Teacher Resources'] }}",
            "mode": "id"
          },
          "whatToSearch": "files",
          "fileTypes": [
            "application/vnd.google-apps.form"
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4944,
        1712
      ],
      "id": "a0f82645-5b7f-4533-bf89-454a43567090",
      "name": "Search files and folders20",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "1cfae2fa-619b-4b3f-9bb2-631824391e54",
              "name": "text",
              "value": "=Ch√†o b·∫°n {{ $('Get row(s) in sheet1').first().json['H·ªç v√† T√™n'] }}\n\nƒê√¢y b√†i t·∫≠p √¥n t·∫≠p tr·ª±c tuy·∫øn ƒë·ªÉ gi√∫p c√°c b·∫°n c·ªßng c·ªë l·∫°i ki·∫øn th·ª©c cho ch·ªß ƒë·ªÅ: {{ $json.formName }}.\n\nƒê·ªÉ chu·∫©n b·ªã t·ªët nh·∫•t, c√°c b·∫°n vui l√≤ng:\n- **Xem l·∫°i t√†i li·ªáu l√Ω thuy·∫øt t·∫°i ƒë√¢y: https://docs.google.com/document/d/{{ $('Edit Fields27').item.json['Id_l√Ω_thuy·∫øt'] }}/view\n- **L√†m b√†i √¥n t·∫≠p tr√™n Google Form t·∫°i ƒë√¢y: {{ $json.formUrl }}\n\nCh√∫c c√°c b·∫°n √¥n t·∫≠p t·ªët v√† ƒë·∫°t k·∫øt qu·∫£ cao nh√©!\nTh√¢n √°i.`",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5392,
        1712
      ],
      "id": "71bf5da3-d531-4e46-a9a8-f97400fce7a7",
      "name": "Edit Fields26"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c0fc9bcf-13de-459f-a3f5-0af31ff55d38",
              "name": "Id_l√Ω_thuy·∫øt",
              "value": "={{ $json.documentId || $json.id}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3376,
        1696
      ],
      "id": "ec180581-6087-407a-b378-21bec2023057",
      "name": "Edit Fields27"
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "spaceId": "={{ $('Webhook').first().json.body.message.space.name }}",
        "messageUi": {
          "text": "={{ $json.text }}"
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.googleChat",
      "typeVersion": 1,
      "position": [
        5600,
        1712
      ],
      "id": "e582dd4f-579d-4498-84fb-6cf5d9d2b487",
      "name": "Create a message2",
      "webhookId": "9b4a96d6-3eb1-407a-863c-956ca31b7074",
      "credentials": {
        "googleChatOAuth2Api": {
          "id": "TjkshwQMm01jTjIm",
          "name": "duong.na.2719@aptechlearning.edu.vn"
        }
      }
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Folder_form",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Edit Fields17').item.json.FOLDER_mon_hoc }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4112,
        1696
      ],
      "id": "4a95e18f-9d3c-4edb-b5d6-9f93fdab045b",
      "name": "Search files and folders21",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "767e4119-8406-4be0-9228-a4e3e3148bd5",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        4320,
        1696
      ],
      "id": "cba7470b-58da-4245-a1b6-5710b7650ae6",
      "name": "If16"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "Folder_form",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Edit Fields17').item.json.FOLDER_mon_hoc }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        4528,
        1600
      ],
      "id": "4b368a18-2f69-4b21-8c05-e3cf9908c318",
      "name": "Create folder5",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "72d31a9d-a77e-436a-ab00-fd59f3d83b7b",
              "name": "Folder_form",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4720,
        1712
      ],
      "id": "2c13c1de-9d57-45b5-b11b-7a58fbd4b8e0",
      "name": "Edit Fields28"
    },
    {
      "parameters": {
        "content": "C·∫ßn s·ª≠a l·∫°i v·∫•n ƒë·ªÅ form ph·∫£i public m·ªõi c√≥ th·ªÉ ƒëi·ªÅn form ƒëc"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5200,
        1920
      ],
      "id": "19e94cfe-0dc2-42d6-b642-91fc1dc069f2",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "Ch·ªânh s·ª≠a th√™m nh√°nh tr√™n"
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        5536,
        1888
      ],
      "id": "d19bf3e5-8d96-4a39-97d6-8968f9636937",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "resource": "fileFolder",
        "queryString": "Folder_form",
        "filter": {
          "folderId": {
            "__rl": true,
            "value": "={{ $('Edit Fields6').item.json.FOLDER_mon_hoc }}",
            "mode": "id"
          },
          "whatToSearch": "folders"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6224,
        1392
      ],
      "id": "c3551320-c797-403a-87df-245069c070bc",
      "name": "Search files and folders22",
      "alwaysOutputData": true,
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "767e4119-8406-4be0-9228-a4e3e3148bd5",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        6432,
        1392
      ],
      "id": "9018a2ef-1d4f-4502-bee4-2ab6fdd2f7fc",
      "name": "If19"
    },
    {
      "parameters": {
        "resource": "folder",
        "name": "Folder_form",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $('Edit Fields6').item.json.FOLDER_mon_hoc }}",
          "mode": "id"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        6640,
        1296
      ],
      "id": "a0135aa1-9d2e-41a6-a167-16dd5ed39f00",
      "name": "Create folder6",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "n9HuVgvCKB2UlLed",
          "name": "duonganhdn2000@gmail.com"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "72d31a9d-a77e-436a-ab00-fd59f3d83b7b",
              "name": "Folder_form",
              "value": "={{ $json.id }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6832,
        1408
      ],
      "id": "e3abb68c-b5ce-43e8-86b3-77bdb8283e9a",
      "name": "Edit Fields29"
    },
    {
      "parameters": {
        "jsCode": "// L·∫•y d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c d·ªçn d·∫πp t·ª´ node tr∆∞·ªõc\nconst inputData = $input.first().json;\n\n// ƒê·∫£m b·∫£o d·ªØ li·ªáu ƒë·∫ßu v√†o h·ª£p l·ªá\nif (inputData && Array.isArray(inputData.exercises)) {\n  // L·∫∑p qua t·ª´ng b√†i t·∫≠p\n  inputData.exercises.forEach(exercise => {\n    // Trong m·ªói b√†i t·∫≠p, l·∫∑p qua t·ª´ng ƒë√°p √°n\n    if (exercise.options) {\n      for (const key in exercise.options) {\n        // Chuy·ªÉn ƒë·ªïi gi√° tr·ªã c·ªßa ƒë√°p √°n th√†nh chu·ªói (string)\n        exercise.options[key] = String(exercise.options[key]);\n      }\n    }\n  });\n}\n\n// Tr·∫£ v·ªÅ to√†n b·ªô ƒë·ªëi t∆∞·ª£ng d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t\nreturn [{\n  json: inputData\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        6016,
        1392
      ],
      "id": "f7d2b0b9-52e7-460f-a3ba-f198da5f10bd",
      "name": "Code in JavaScript11"
    }
  ],
  "pinData": {},
  "connections": {
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "L·ªçc m√¥n h·ªçc -  B√†i h·ªçc",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "L·ªçc m√¥n h·ªçc -  B√†i h·ªçc": {
      "main": [
        [
          {
            "node": "Code3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent4",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Create folder",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders1": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder": {
      "main": [
        [
          {
            "node": "Edit Fields21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document": {
      "main": [
        [
          {
            "node": "AI Agent4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent4": {
      "main": [
        [
          {
            "node": "Update a document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document": {
      "main": [
        [
          {
            "node": "Edit Fields9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "Search files and folders",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search files and folders3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent6": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model8": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent6",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If7": {
      "main": [
        [
          {
            "node": "Create a document",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields9": {
      "main": [
        [
          {
            "node": "Respond to Webhook9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If10": {
      "main": [
        [
          {
            "node": "Edit Fields10",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields10": {
      "main": [
        [
          {
            "node": "Respond to Webhook10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code3": {
      "main": [
        [
          {
            "node": "If10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code5": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Code5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet": {
      "main": [
        [
          {
            "node": "Code in JavaScript2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields18": {
      "main": [
        [
          {
            "node": "Respond to Webhook18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If17": {
      "main": [
        [
          {
            "node": "Edit Fields20",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields7": {
      "main": [
        [
          {
            "node": "Respond to Webhook7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent3": {
      "main": [
        [
          {
            "node": "Edit Fields7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "If9": {
      "main": [
        [
          {
            "node": "Create_Sheet_in_Root",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create_Sheet_in_Root": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Move file": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search_User_Context": {
      "main": [
        [
          {
            "node": "IF_Context_Found",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_Context_Found": {
      "main": [
        [
          {
            "node": "Check_Follow_Up",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Classify_Intent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model10": {
      "ai_languageModel": [
        [
          {
            "node": "Classify_Intent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Classify_Intent": {
      "main": [
        [
          {
            "node": "Code in JavaScript4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check_If_File_Exists": {
      "main": [
        [
          {
            "node": "Search files and folders13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get_Saved_Intent": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save_User_Context": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "L·ªçc m√¥n h·ªçc -  B√†i h·ªçc",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields25",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search files and folders1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "sensitive_topic",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "AI Agent3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model11": {
      "ai_languageModel": [
        [
          {
            "node": "Check_Follow_Up",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Check_Follow_Up": {
      "main": [
        [
          {
            "node": "IF_Is_Follow_Up",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF_Is_Follow_Up": {
      "main": [
        [
          {
            "node": "Get_Saved_Intent",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Classify_Intent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Append or update row in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append or update row in sheet": {
      "main": [
        [
          {
            "node": "Move file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model12": {
      "ai_languageModel": [
        [
          {
            "node": "sensitive_topic",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "sensitive_topic": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "Respond to Webhook1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders7": {
      "main": [
        [
          {
            "node": "Search files and folders2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code4": {
      "main": [
        [
          {
            "node": "Search files and folders7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders8": {
      "main": [
        [
          {
            "node": "Search files and folders9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders9": {
      "main": [
        [
          {
            "node": "Search files and folders10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders10": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet1": {
      "main": [
        [
          {
            "node": "Code10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders6": {
      "main": [
        [
          {
            "node": "Check_If_File_Exists",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders11": {
      "main": [
        [
          {
            "node": "Search files and folders12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code10": {
      "main": [
        [
          {
            "node": "Search files and folders11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders12": {
      "main": [
        [
          {
            "node": "Search files and folders6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders13": {
      "main": [
        [
          {
            "node": "If9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Search_User_Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Code4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields21": {
      "main": [
        [
          {
            "node": "AI Agent6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields8": {
      "main": [
        []
      ]
    },
    "Search files and folders": {
      "main": [
        [
          {
            "node": "SimplifyFileList",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders2": {
      "main": [
        [
          {
            "node": "Edit Fields12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields12": {
      "main": [
        [
          {
            "node": "Search files and folders8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "SimplifyFileList": {
      "main": [
        [
          {
            "node": "AI Agent2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent2": {
      "main": [
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Edit Fields19",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields19": {
      "main": [
        [
          {
            "node": "Respond to Webhook19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent5",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript2": {
      "main": [
        [
          {
            "node": "AI Agent5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent5": {
      "main": [
        [
          {
            "node": "Code in JavaScript3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript3": {
      "main": [
        [
          {
            "node": "If17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields20": {
      "main": [
        [
          {
            "node": "Respond to Webhook20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript4": {
      "main": [
        [
          {
            "node": "Save_User_Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet2": {
      "main": [
        [
          {
            "node": "Code in JavaScript6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields22": {
      "main": [
        [
          {
            "node": "Respond to Webhook21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If18": {
      "main": [
        [
          {
            "node": "Edit Fields24",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders3": {
      "main": [
        [
          {
            "node": "SimplifyFileList1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent7": {
      "main": [
        [
          {
            "node": "Code in JavaScript5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent7",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "SimplifyFileList1": {
      "main": [
        [
          {
            "node": "AI Agent7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Edit Fields23",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s) in sheet2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript5": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields23": {
      "main": [
        [
          {
            "node": "Respond to Webhook22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent8": {
      "main": [
        [
          {
            "node": "Code in JavaScript7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model9": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent8",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript6": {
      "main": [
        [
          {
            "node": "AI Agent8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript7": {
      "main": [
        [
          {
            "node": "If18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields24": {
      "main": [
        [
          {
            "node": "Respond to Webhook23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model13": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent9",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent9": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "If8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields11": {
      "main": [
        [
          {
            "node": "Create a message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Edit Fields11",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Search files and folders5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If8": {
      "main": [
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Respond to Webhook12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders5": {
      "main": [
        [
          {
            "node": "SimplifyFileList2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent10": {
      "main": [
        [
          {
            "node": "Code in JavaScript8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model14": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent10",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "SimplifyFileList2": {
      "main": [
        [
          {
            "node": "AI Agent10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript8": {
      "main": [
        [
          {
            "node": "Code in JavaScript9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s) in sheet3": {
      "main": [
        [
          {
            "node": "Code in JavaScript10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript9": {
      "main": [
        [
          {
            "node": "Get row(s) in sheet3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model15": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent11",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript10": {
      "main": [
        [
          {
            "node": "AI Agent11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent11": {
      "main": [
        [
          {
            "node": "Search files and folders4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model16": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent12",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model17": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent13",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent12": {
      "main": [
        [
          {
            "node": "Create a document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent13": {
      "main": [
        [
          {
            "node": "Clean_AI_Output",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders4": {
      "main": [
        [
          {
            "node": "If11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If11": {
      "main": [
        [
          {
            "node": "Create folder1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder1": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Search files and folders15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders14": {
      "main": [
        [
          {
            "node": "If12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If12": {
      "main": [
        [
          {
            "node": "AI Agent12",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document1": {
      "main": [
        [
          {
            "node": "Update a document1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document1": {
      "main": [
        [
          {
            "node": "Edit Fields14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders15": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Create folder2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder2": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Search files and folders14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean_AI_Output": {
      "main": [
        [
          {
            "node": "Code in JavaScript11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders16": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields14": {
      "main": [
        [
          {
            "node": "AI Agent13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields13": {
      "main": [
        [
          {
            "node": "Create a message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Respond to Webhook24": {
      "main": [
        [
          {
            "node": "AI Agent9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields25": {
      "main": [
        [
          {
            "node": "Respond to Webhook24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent14": {
      "main": [
        [
          {
            "node": "Create a document2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model18": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent14",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent15": {
      "main": [
        [
          {
            "node": "Clean_AI_Output1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model19": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent15",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders17": {
      "main": [
        [
          {
            "node": "If13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If13": {
      "main": [
        [
          {
            "node": "Create folder3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder3": {
      "main": [
        [
          {
            "node": "Edit Fields16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields16": {
      "main": [
        [
          {
            "node": "Search files and folders19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders18": {
      "main": [
        [
          {
            "node": "If14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If14": {
      "main": [
        [
          {
            "node": "AI Agent14",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a document2": {
      "main": [
        [
          {
            "node": "Update a document2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a document2": {
      "main": [
        [
          {
            "node": "Edit Fields27",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Edit Fields26",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders19": {
      "main": [
        [
          {
            "node": "If15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If15": {
      "main": [
        [
          {
            "node": "Create folder4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder4": {
      "main": [
        [
          {
            "node": "Edit Fields17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields17": {
      "main": [
        [
          {
            "node": "Search files and folders18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Clean_AI_Output1": {
      "main": [
        [
          {
            "node": "Search files and folders21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders20": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields26": {
      "main": [
        [
          {
            "node": "Create a message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields27": {
      "main": [
        [
          {
            "node": "AI Agent15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields15": {
      "main": [
        [
          {
            "node": "Search files and folders17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders21": {
      "main": [
        [
          {
            "node": "If16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If16": {
      "main": [
        [
          {
            "node": "Create folder5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder5": {
      "main": [
        [
          {
            "node": "Edit Fields28",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields28": {
      "main": [
        [
          {
            "node": "Search files and folders20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Search files and folders22": {
      "main": [
        [
          {
            "node": "If19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If19": {
      "main": [
        [
          {
            "node": "Create folder6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create folder6": {
      "main": [
        [
          {
            "node": "Edit Fields29",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields29": {
      "main": [
        [
          {
            "node": "Search files and folders16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript11": {
      "main": [
        [
          {
            "node": "Search files and folders22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "dc61c51d-78d5-4100-8e1a-c2e3f78c69b8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "df75f6d19da9532b87ea5a84541b4ccc1d0dd5baf896242962b0dfcbc492bcf4"
  },
  "id": "FIptvUtPIIAmoksj",
  "tags": []
}